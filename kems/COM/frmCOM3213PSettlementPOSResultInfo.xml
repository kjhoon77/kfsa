<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="292" Id="frmCOM3213PSettlementPOSResultInfo" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="현금영수증결제처리결과조회팝업" Top="8" Ver="1.0" Width="400" WorkArea="true">
		<Shape Bottom="196" Height="168" Id="shpGubunBox4" Left="4" LineColor="user15" Right="396" TabOrder="14" Top="28" Type="Rectangle" Width="392"></Shape>
		<Static Align="Center" Height="20" Id="lbPersonNm" Left="12" Style="sty_Label" TabOrder="8" Text="구매자" Top="72" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbOrderNo" Left="12" Style="sty_Label" TabOrder="9" Text="주문번호" Top="120" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edOrderNo" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="5" Top="120" UserData="S" Width="284"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edPersonNm" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="3" Top="72" UserData="S" Width="284"></Edit>
		<Static Align="Center" Height="20" Id="lbAmount" Left="12" Style="sty_Label" TabOrder="10" Text="금액" Top="168" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbSunapGubun1" Left="12" Style="sty_Label" TabOrder="11" Text="납부방법" Top="144" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edSunapGubun" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="6" Text="현금영수증" Top="144" UserData="S" Width="72"></Edit>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medAmount" Left="104" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Maskedit" TabOrder="7" Top="168" UserData="S" Width="72"></MaskEdit>
		<Static Align="Center" Height="20" Id="lbProductInfo" Left="12" Style="sty_Label" TabOrder="12" Text="상품정보" Top="96" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edProductInfo" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="4" Top="96" UserData="S" Width="284"></Edit>
		<Static Align="Center" Height="20" Id="lbSetlmtGubun" Left="12" Style="sty_Label" TabOrder="13" Text="수납구분" Top="48" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edSetlmtGubun" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="2" Top="48" UserData="S" Width="72"></Edit>
		<Static Align="Center" Height="20" Id="lbRepay" Left="16" Style="sty_LabelGruopBox" TabOrder="15" Text="결제정보" Top="20" VAlign="Middle" Width="100"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="310" OnClick="lfn_End" Style="sty_Button" TabOrder="1" ToolTipText="닫기" Top="3" Width="85"></Button>
		<Shape Bottom="284" Height="72" Id="shpGubunBox2" Left="4" LineColor="user15" Right="396" TabOrder="20" Top="212" Type="Rectangle" Width="392"></Shape>
		<Static Align="Center" Height="20" Id="lbResultLgd" Left="12" Style="sty_Label" TabOrder="18" Text="데이콤" Top="256" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edResultLgd" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="17" Top="256" UserData="S" Width="208"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edResultKems" ImeMode="native" Left="104" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="16" Top="232" UserData="S" Width="208"></Edit>
		<Static Align="Center" Height="20" Id="lbResultKems" Left="12" Style="sty_Label" TabOrder="19" Text="안전원" Top="232" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbResult" Left="20" Style="sty_LabelGruopBox" TabOrder="21" Text="처리결과" Top="204" VAlign="Middle" Width="100"></Static>
		<Static Height="20" Id="lbResultKemsText" Left="316" Style="sty_Text" TabOrder="22" Text="(단위시스템)" Top="233" VAlign="Middle" Width="76"></Static>
		<Static Height="20" Id="lbResultLgdText" Left="316" Style="sty_Text" TabOrder="23" Text="(실시간조회)" Top="257" VAlign="Middle" Width="76"></Static>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmCOM3213PSettlementPOSResultInfo.xml
 * 설명 : 현금영수증결제처리결과조회팝업
 * 작성일 : 2009.08.26
 * 작성자 : 장성호
 */

#include "LIB::COMMON.js"; // 공통 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리

    edSetlmtGubun.Text = sResultPrintSunapGubun;
    edPersonNm.Text = sResultPrintBuyerNm;
    edProductInfo.Text = sResultPrintProgramNm;
    edOrderNo.Text = sResultPrintJumunNo;
    medAmount.Text = sResultPrintProcAmount;
    edResultKems.Text = sResultPrintKemsMsg;
    edResultLgd.Text = sResultPrintLgdMsg;

    if (sResultPgmId == "21") { // 강습
        if (sPosResultCode == "1") { // 데이콤 성공, 안전원 실패
            btnChange.Visible = true;
        }
    }
}

function Form_OnUnloadCompleted(obj) {
    Close("OK");
}

function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
    switch (nChar) {
        case 27 : // 종료(Esc)
            lfn_End();
            break;
    }
}

/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close("OK");
}
/* 공통 필수 종료 */

/* 사용자 함수 */
/* 기능 : 안전원 결과를 성공으로 수정한다.
 * parameter : sResultPmyear - 영수증관리년도
 *             sResultPmmgno - 영수증관리번호
 * Return : 없음
 */
function lfn_ChangeKfsaResultOk() {
    if (sResultPgmId == "21") { // 강습
        // POS 안전원 성공으로 수정한다.
        var ls_RetRetry = gfn_ChangeKfsaResultOk(sResultPmyear, sResultPmmgno); // LGD성공이라 안전원결과를 성공으로 변경한다.
        if (ls_RetRetry <> "0") { // 실패
            gfn_Alert("변경 실패했습니다. 잠시 후 다시 실행해 주십시오.");
            return false;
        }

        // 강습결제정보 성공으로 수정한다.
        lfn_ExecuteChangeKfsaResultOk();
    }
}

/*
 * 기능 : 강습결제정보를 안전원 성공으로 저장한다.
 * parameter : sResultPmyear - 영수증관리년도
 *             sResultPmmgno - 영수증관리번호
 * return value : 없음
 */
function lfn_ExecuteChangeKfsaResultOk() {
    var sArg = "PMYEAR=" + quote(sResultPmyear); // 영수증관리년도
    sArg += " PMMGNO=" + quote(sResultPmmgno); // 영수증관리번호

    tit_clearActionInfo();
    tit_addSingleActionInfo("com:executeChangeKfsaResultOk", "", 0, "");
    // 서버 호출
    tit_callService(
        ""
        ,""
        ,"" // inDs
        ,"ds_oResultOk=ds_oResultOk" // outDs
        ,sArg // args
        ,"lfn_AfterExecuteChangeKfsaResultOk"
        ,false
        ,false
        ,true
    );
}

/*
 * 기능 : 안전원 성공 실행 후 처리해야 할 내용
 * parameter : nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterExecuteChangeKfsaResultOk(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        Close("FAIL");
    }

    if (ds_oResultOk.GetColumn(0, "RESULTCODE") <> "OK") {
        gfn_ErrorMsg(ds_oResultOk.GetColumn(0, "RESULTCODE"), ds_oResultOk.GetColumn(0, "RESULTMSG"));
        Close("FAIL");
    }

    gfn_Alert("정상적으로 처리되었습니다.");
    Close("OK");
}

/* 사용자 이벤트 함수 */
]]></Script>
</Window>