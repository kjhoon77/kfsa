<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="396" Id="frmCOM1100MOneSMSSend" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="단일문자메시지발송팝업" Top="8" Ver="1.0" Width="368" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioSmsSingle">
				<Contents></Contents>
			</Dataset>
		</Datasets>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="22" Id="btnSend" ImageID="BTN_TEXT_COM" Left="192" OnClick="lfn_Send" Style="sty_Button" TabOrder="7" Text="보내기(F4)" ToolTipText="SMS&#32;보내기" Top="4" Width="85"></Button>
		<Image Height="367" Id="imgSmsTraining" ImageID="IMG_휴대폰" Left="4" TabOrder="14" Top="24" Width="158"></Image>
		<TextArea Border="SunkenEdge" Font="굴림,11,Bold" Height="112" Id="taMessage" ImeMode="native" Left="25" MaxLength="80" OnCharChanged="taMessage_OnCharChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" TabOrder="1" Top="75" UserData="S" Width="117"></TextArea>
		<Static Align="Right" Font="Arial,9,Bold" Height="16" Id="lbLength" Left="47" TabOrder="15" Text="0" Top="192" Width="20"></Static>
		<Static Font="Arial,9,Bold" Height="16" Id="lbTotalLength" Left="71" TabOrder="2" Text="/&#32;80&#32;Byte" Top="192" Width="56"></Static>
		<Checkbox Height="20" Id="chkReseve" Left="23" OnClick="chkReseve_OnClick" OnKeyDown="gfn_EnterNextFocus" TabOrder="4" Top="295" Value="FALSE" Width="14"></Checkbox>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Height="20" Id="medReserveTime" Left="42" LeftMargin="2" Mask="##:##" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Time" TabOrder="6" Top="342" Type="STRING" UserData="S" Visible="FALSE" Width="40"></MaskEdit>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" HeaderFont="돋음,10,Bold" Height="20" Id="calReserveDate" Left="42" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="5" Top="318" UserData="S" Visible="FALSE" WeeksFont="돋음,9" Width="98"></Calendar>
		<Edit AutoSelect="TRUE" Border="Flat" Font="굴림,11,Bold" Height="20" Id="edReplyNumber" ImeMode="native" Left="23" LeftMargin="2" MaxLength="12" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="3" Top="252" UserData="S" Width="122"></Edit>
		<Static Align="Center" Height="20" Id="lbRecvNm" Left="165" Style="sty_Label" TabOrder="16" Text="수신자명" Top="84" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edRecvNm" ImeMode="native" Left="257" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="9" Top="84" UserData="S:수신자" Width="106"></Edit>
		<Static Align="Center" Height="20" Id="lbRecvTel" Left="165" Style="sty_Label" TabOrder="17" Text="수신번호" Top="108" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edRecvTel" ImeMode="native" Left="257" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="10" Top="108" UserData="I:수신번호" Width="106"></Edit>
		<Static Align="Center" Height="20" Id="lbSmsGubun" Left="165" Style="sty_Label" TabOrder="18" Text="발송구분" Top="180" VAlign="Middle" Visible="FALSE" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edSmsGubun" ImeMode="native" Left="257" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="13" Top="180" Visible="FALSE" Width="106"></Edit>
		<Static Align="Center" Height="20" Id="lbJibu" Left="165" Style="sty_Label" TabOrder="19" Text="발송지사" Top="132" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edJibu" ImeMode="native" Left="257" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="11" Top="132" Width="106"></Edit>
		<Static Align="Center" Height="20" Id="lbSabun" Left="165" Style="sty_Label" TabOrder="20" Text="발송자" Top="156" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edSabun" ImeMode="native" Left="257" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="12" Top="156" Width="106"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="279" OnClick="lfn_End" Style="sty_Button" TabOrder="8" ToolTipText="닫기" Top="4" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmCOM1100MOneSMSSend.xml
 * 설명 : 단일문자메시지발송팝업
 * 작성일 : 2009.09.20
 * 작성자 : 이창희
 */

#include "LIB::COMMON.js"; // 공통 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리

    if (IsExistVar("sRecvTel")) {
        edRecvNm.Text = sRecvNm;
        edRecvTel.Text = sRecvTel;
        edSmsGubun.Text = sSmsGubun;
    }

    if (edRecvTel.Text == "") {
        btnSend.Enable = false;
    } else {
        btnSend.Enable = true;
    }

    edJibu.Text = gds_oUserInfo.GetColumn(0, "PPERSONNM");
    edSabun.Text = gds_oUserInfo.GetColumn(0, "PDEPTNM");
    edReplyNumber.Text = gds_oUserInfo.GetColumn(0, "TEL");
}

function Form_OnUnloadCompleted(obj) {
    Close();
}

function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
    switch (nChar) {
        case 27 : // 종료(Esc)
            lfn_End();
            break;
        case 115 : // 단일문자메시지발송(F4)
            lfn_Send();
            break;
    }
}

// 단일문자메시지발송
function lfn_Send(obj)
{
  	replace(edReplyNumber.text, "-", "");
		
	taMessage.UserData = "S:전달 메세지";   // 전달 메세지와 회신 연락처 확인 위함
	edReplyNumber.UserData = "S:회신연락처";   // 전달 메세지와 회신 연락처 확인 위함

	if (!gfn_FormValidate(this)) { // 입력 Validation Check
		return false;
	}

	if (!gfn_FormValidate(this)) { // 입력 Validation Check
		return false;
	}

	var sArg = "RECVTEL=" + quote(edReplyNumber.value) // -- 회신전화번호
           +" SMMSG=" + quote(taMessage.text) //   -- 전문내용
           +" SHSENDRESVTIME1=" + quote(calReserveDate.value)// -- 발송예약날짜
           +" SHSENDRESVTIME2=" + quote(medReserveTime.text) // -- 발송예약시간
           +" TJPERSONNM=" + quote(edRecvNm.text)    // -- 수신자명
           +" TPHPTEL=" + quote(edRecvTel.text)    // -- 수신번호
           +" WORKGUBUN=" + quote(sSmsGubun) // -- 작업구분:21강습
           +" PDEPTCD=" + quote(gds_oUserInfo.GetColumn(0, "PDEPTCD")) // -- 지부
           +" PSABUN=" + quote(gds_oUserInfo.GetColumn(0, "PSABUN")) // -- 사번
           +" TOMGNO=" + quote(sTomgNo) // -- 회차관리번호
           +" TJMGNO=" + quote(sTjmgNo) // -- 접수관리번호
           +" TOHJUBSUNO=" + quote(sTohjubSuNo) // -- 접수번호
           ;

	tit_clearActionInfo();
	tit_addSingleActionInfo("training:insertSmsSingle", "", 0, "");
	// 서버 호출
	tit_callService(
		""
		,""
		,""	// inDs
		,""	// outDs
		, sArg
		,"lfn_AfterSaveSms"
		,false
	);
}

function lfn_End(obj) {
    Close();
}
/* 공통 필수 종료 */

/* 사용자 함수 */
/*
 * 기능 : 발송 후 처리해야 할 내용
 * parameter : nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterSaveSms(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

	gfn_Alert("정상적으로 발송되었습니다.");
    Close();
}

/*
 * 기능 : 문자열 길이를 계산한다.
 * parameter : obj - 컴포넌트 오브젝트
 *             sMsg - 메세지 앞부분
 *             nLength - 최대문자열수
 * return : 없음
 */
function lfn_CheckLength(obj, sMsg, nLength)
{
    obj.value = ltrim(obj.value);
    var ln_ObjLength = lfn_CheckByte(obj.value);
    if (ln_ObjLength > nLength) {
        gfn_Alert(sMsg + nLength + '자를(영문기준) 초과할 수 없습니다. 현재 ' + ln_ObjLength + '글자입니다.' + ' 80자까지만 내용이 발송됩니다.');
        return false;
    }
    return true;
}

/*
 * 기능 : 바이트수 계산한다.
 * parameter : sString - 계산할 문자열
 * return : 문자열 바이트수
 */
function lfn_CheckByte(sString)
{
    var ln_StringByte = 0;
    var ln_Len = sString.length;
    for (var i = 0; i < ln_Len; i++) {
        if (sString.CharAt(i) >= ' ' && sString.CharAt(i) <= '~' ) {
            ln_StringByte++;
        } else {
            ln_StringByte += 2;
        }
    }
    return ln_StringByte;
}

/* 사용자 이벤트 함수 */
function chkReseve_OnClick(obj,strValue)
{
    if (ChkReseve.Value = true)	{
        calReserveDate.Value = GetDate();
        medReserveTime.Value = "0000";
        calReserveDate.Visible = true;
        medReserveTime.Visible = true;
    } else {
        calReserveDate.Value = "";
        medReserveTime.Value = "";
        calReserveDate.Visible = false;
        medReserveTime.Visible = false;
    }
}

function taMessage_OnCharChanged(obj,strPreText,strPostText)
{
	lbLength.Text = lfn_CheckByte(obj.value);
	if (lfn_CheckLength(obj, "문자메시지는 ", 80) == false) {
		obj.text = strPreText;
	}
	lbLength.Text = lfn_CheckByte(obj.value);
}


]]></Script>
</Window>