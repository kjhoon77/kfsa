<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="590" Id="frmtraining0421MExamAbsentManagement" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="시험출결관리" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioExamAbsent" OnColumnChanged="ds_ioExamAbsent_OnColumnChanged" OnRowPosChanged="ds_ioExamAbsent_OnRowPosChanged">
				<Contents>
					<colinfo id="EJADDR1" size="100" summ="default" type="STRING"/>
					<colinfo id="EJADDR2" size="100" summ="default" type="STRING"/>
					<colinfo id="EJMGNO" size="22" summ="default" type="INT"/>
					<colinfo id="EJPERSONNM" size="100" summ="default" type="STRING"/>
					<colinfo id="EJBIRTHDAY" size="13" summ="default" type="STRING"/>
					<colinfo id="EOEXAMDATE" size="8" summ="default" type="STRING"/>
					<colinfo id="EOHJUBSUNO" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="BIRTHDAY" size="256" summ="default" type="STRING"/>
					<colinfo id="EOMGJIBUCD" size="256" summ="default" type="STRING"/>
					<colinfo id="EOYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="EOTCCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="EOEXAMORDER" size="256" summ="default" type="STRING"/>
					<colinfo id="SEL" size="256" summ="default" type="STRING"/>
					<colinfo id="EAGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="EA1CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="EA2CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="EJCHASUGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASUGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="EAOLDGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="EAOLD1CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="EAOLD2CHASU" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oCourse">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oJibu">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oAbsentChasuGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>1</CD>
						<DATA>1차시험</DATA>
					</record>
					<record>
						<CD>2</CD>
						<DATA>2차시험</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oExamJubsuCnt" OnColumnChanged="ds_ioExamAbsent_OnColumnChanged" OnRowPosChanged="ds_ioExamAbsent_OnRowPosChanged">
				<Contents>
					<colinfo id="TJMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="TOTCCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="TOMUNJEGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="108" Height="76" Id="shpGubunBox" Left="4" LineColor="user15" Right="796" TabOrder="26" Top="32" Type="Rectangle" Width="792"></Shape>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="182" LineColor="user14" Right="796" TabOrder="61" Top="1" Type="Rectangle" Width="614"></Shape>
		<Div BKColor="user0" Height="28" Id="divWorkFormTitle" OnLoadCompleted="Form_OnLoadCompleted" Style="sty_Form" TabOrder="18" TabStop="FALSE" Text="Div0" Url="COM::frmCOM0100SWorkFormTitle.xml" Width="180">
			<Contents></Contents>
		</Div>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btnMutilSort" ImageID="BTN_MULTI_SORT" Left="722" OnClick="btnMutilSort_OnClick" Style="sty_Button" TabOrder="16" Top="112" Transparent="TRUE" Width="74"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSearch" ImageID="BTN_COM_SEARCH" Left="185" OnClick="lfn_Search" Style="sty_Button" TabOrder="1" ToolTipText="조회" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnCancel" ImageID="BTN_COM_INIT" Left="446" OnClick="lfn_Init" Style="sty_Button" TabOrder="4" ToolTipText="입력&#32;초기화" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnToExcel" ImageID="BTN_COM_EXCEL" Left="534" OnClick="btnToExcel_OnClick" Style="sty_Button" TabOrder="5" ToolTipText="엑셀로&#32;저장" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrintScreen" ImageID="BTN_COM_SCREEN" Left="621" OnClick="lfn_PrintScreen" Style="sty_Button" TabOrder="6" ToolTipText="화면&#32;출력" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="708" OnClick="lfn_End" Style="sty_Button" TabOrder="7" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbAbsentCnt" Left="192" Style="sty_LabelStat" TabOrder="19" Text="결시자수" Top="112" VAlign="Middle" Width="88"></Static>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medAbsenCnt" Left="284" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="15" Top="112" UserData="S" Width="88"></MaskEdit>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxJibu" INDEX="0" InnerDataset="ds_oJibu" Left="99" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="8" Top="35" UserData="I:지부" Width="88"></Combo>
		<Static Align="Center" Height="20" Id="lbJibu" Left="8" Style="sty_Label" TabOrder="23" Text="지부" Top="36" UserData="S" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbCourse" Left="326" Style="sty_Label" TabOrder="20" Text="직능" Top="36" UserData="S" VAlign="Middle" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxCourse" INDEX="0" InnerDataset="ds_oCourse" Left="417" OnChanged="cbxCourse_OnChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="10" Top="35" UserData="S:직능" Width="182"></Combo>
		<Static Align="Center" Height="20" Id="lbTrainingYear" Left="192" Style="sty_Label" TabOrder="22" Text="년도" Top="36" UserData="S" VAlign="Middle" Width="88"></Static>
		<Edit Align="CENTER" AutoSelect="TRUE" Border="Flat" Height="20" Id="edExamYear" ImeMode="native" Left="284" LeftMargin="2" MaxLength="4" Number="TRUE" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="9" Top="36" UserData="I:년도" Width="36"></Edit>
		<Static Align="Center" Height="20" Id="lbTrainingOrder" Left="604" Style="sty_Label" TabOrder="21" Text="회차" Top="36" UserData="S" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbEduDate" Left="8" Style="sty_Label" TabOrder="25" Text="시험일자" Top="60" VAlign="Middle" Width="88"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="22" Id="btnSave" ImageID="BTN_TEXT_COM" Left="272" OnClick="lfn_Save" Style="sty_Button" TabOrder="2" Text="결시처리(F4)" ToolTipText="수정&#32;저장" Top="4" Width="85"></Button>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medExamDate" Left="100" LeftMargin="2" Mask="####-##-##" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Time" TabOrder="13" Top="60" Type="STRING" UserData="S" Width="78"></MaskEdit>
		<Static Align="Center" Height="20" Id="lbAbsentDateGubun" Left="8" Style="sty_Label" TabOrder="27" Text="결시구분" Top="84" VAlign="Middle" Width="88"></Static>
		<Radio Border="Flat" CodeColumn="CD" ColumnCount="5" DataColumn="DATA" Height="20" Id="radAbsentChasuGubun" INDEX="0" InnerDataset="ds_oAbsentChasuGubun" Left="102" OnChanged="radAbsentChasuGubun_OnChanged" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="14" Top="84" Width="242"></Radio>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_ioExamAbsent" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="584" ColSelect="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="448" Id="gdExamAbsent" InputPanel="FALSE" Left="3" LineColor="default" MinWidth="100" Right="795" RowHeight="20" Style="sty_Grid" TabOrder="17" TabStop="true" Top="136" UseDBuff="true" UsePopupMenu="true" UserData="시험출결자목록" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="792">
			<contents>
				<format id="Default">
					<columns>
						<col width="40"/>
						<col width="61"/>
						<col width="70"/>
						<col width="70"/>
						<col width="70"/>
						<col width="200"/>
						<col width="143"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" text="결강"/>
						<cell align="center" col="1" display="text" text="접수구분"/>
						<cell align="center" col="2" display="text" text="접수번호"/>
						<cell align="center" col="3" display="text" text="성명"/>
						<cell align="center" col="4" display="text" text="생년월일"/>
						<cell align="center" col="5" display="text" text="주소1"/>
						<cell align="center" col="6" display="text" text="주소2"/>
					</head>
					<body>
						<cell align="center" col="0" colid="SEL" display="checkbox" edit="checkbox" text="0"/>
						<cell align="center" col="1" colid="CHASUGUBUN" display="combo"/>
						<cell align="center" col="2" colid="EOHJUBSUNO" display="combo"/>
						<cell align="center" col="3" colid="EJPERSONNM" display="text"/>
						<cell align="center" col="4" colid="BIRTHDAY" display="combo"/>
						<cell align="left" col="5" colid="EJADDR1" display="text"/>
						<cell align="left" col="6" colid="EJADDR2" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="22" Id="btnCancelAbsent" ImageID="BTN_TEXT_COM" Left="359" OnClick="btnCancelAbsent_OnClick" Style="sty_Button" TabOrder="3" Text="결시취소" ToolTipText="결시취소" Top="4" Width="85"></Button>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edExamOrder" ImeMode="native" Left="696" LeftMargin="2" MaxLength="3" Number="TRUE" OnChanged="lfn_SearchExamAbsent" OnFocus="gfn_ComponentOnFocus" OnKeyDown="edExamOrder_OnKeyDown" OnKillFocus="edExamOrder_OnKillFocus" Style="sty_Edit" TabOrder="11" Top="36" UserData="S:회차" Width="28"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnAttendance" ImageID="BTN_TEXT_08" Left="605" OnClick="lfn_SaveAttendance" Style="sty_Button" TabOrder="12" Text="출결자료&#32;생성" Top="59" Transparent="TRUE" Width="120"></Button>
		<Static Align="Center" Height="20" Id="lbTotalCnt" Left="8" Style="sty_LabelStat" TabOrder="29" Text="전체인원수" Top="112" VAlign="Middle" Width="88"></Static>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medTotalCnt" Left="100" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="28" Top="112" UserData="S" Width="88"></MaskEdit>
	</Form>
	<Script><![CDATA[/*

 * 프로그램명 : frmtraining0421MExamAbsentManagement.xml

 * 설명 : 시험출결관리

 * 작성일 : 2012.10.16

 * 작성자 : 정현호 

 */    



#include "LIB::training.js"; // 공통업무 관련



/* 공통 필수 시작 */

function Form_OnLoadCompleted(obj) {     

    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리


    // 폼 환경설정

    ls_SystemGubun = gs_SystemGubun;

    ls_SystemMenuId = gs_SystemMenuId;

    var ls_FormId = split(sFormUrl, "::");

    ls_FormId = split(ls_FormId[1], ".");

    obj.Title = sFormTitle + "(" + ls_FormId[0] + ")";



    gfn_MakeRequiredInputMark(this); // 필수 입력란을 설정한다.



    ms_FormAuth = gfn_GetFormAuth(this); // 권한을 조회한다.

    if (ms_FormAuth == "W") { // 권한에 따른 버튼 설정

        lfn_SetFormAuth(true); // 저장 권한

    } else if (ms_FormAuth == "R") {

        lfn_SetFormAuth(false); // 읽기 권한

    } else {

        gfn_Alert(MSGI00080);

        close();

    }

	// 결시구분(특급만 보이도록)
	lbAbsentDateGubun.Visible = false;
	radAbsentChasuGubun.Visible = false;
	radAbsentChasuGubun.Value = "";


    // 공통 코드 조회

    gfn_SearchTrainingCourse("E", ds_oCourse, "Y", "선택"); // 직능 코드 조회
    
	// 직능을 특급,1급,2급,3급만 남김
	for(i = 0; i < ds_oCourse.RowCount(); i++) {

	trace(ds_oCourse.GetColumn(i, "CD"));
	
        if (ds_oCourse.GetColumn(i, "CD") == "20" ||
            ds_oCourse.GetColumn(i, "CD") == "24" ||
            ds_oCourse.GetColumn(i, "CD") == "28" ||
            ds_oCourse.GetColumn(i, "CD") == "29" ||
            ds_oCourse.GetColumn(i, "CD") == "50" ||
            ds_oCourse.GetColumn(i, "CD") == "51" ||
            ds_oCourse.GetColumn(i, "CD") == "53" ||
            ds_oCourse.GetColumn(i, "CD") == "30" ||
            ds_oCourse.GetColumn(i, "CD") == "31" ) {
		
			ds_oCourse.DeleteRow(i);
			i = i - 1;
		}

	}

    cbxCourse.Value = "22";
    
    gfn_SearchJibu(cbxJibu, "Y", "선택"); // 지부 코드 조회

    edExamYear.Text = left(GetDate(), 4);

    edExamOrder.SetFocus();
    
    
}



function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {

    // to do



    gfn_Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam); // 공통 키 이벤트 처리

}



function Form_OnSize(obj,nCx,nCy,nState) {

    if (gs_IsResizingForm == "Y") {

        gdExamAbsent.Height = nCy - gdExamAbsent.Top - 4;

        //gdExamAbsent.Width = nCx - gdExamAbsent.Left - 4;

    }

}



/*

 * 기능 : 조회

 */

function lfn_Search(obj) {

    medAbsenCnt.Value = ""; // 결시자수 카운트 초기화

    medExamDate.Value = "";
	
    if (!gfn_FormValidate(this)) { // 조회 Validation Check

        return false;

    }   



    ds_ioExamAbsent.ClearData(); // 데이타셋 초기화

    

    // 조회이력을 저장한다.  

    ls_HistoryArg = "지부=" + quote(cbxJibu.Text)

                + ",직능=" + quote(cbxCourse.Text)

                + ",년도=" + quote(edExamYear.Text)

                + ",회차=" + quote(edExamOrder.Text)

                + ",결시구분=" + quote(radAbsentChasuGubun.Value);

    gfn_InsertSearchPrintHistory(

        "S"

        , this.ID

        , global.mnuLeft.cbxOpenForm.Text

        , ls_HistoryArg

    );



    tit_clearActionInfo();

	tit_addCsvSearchActionInfo("training:searchExam0421Absent", false);

	// 서버 호출 

	tit_callService(

		""

		,""

		,""	// inDs

		,"ds_ioExamAbsent=ds_oExamAbsent"	// outDs

		,"EOMGJIBUCD=" + quote(cbxJibu.Value)

            + " TCCOURSECD=" + quote(cbxCourse.Value)

            + " EOYEAR=" + quote(edExamYear.Text)

            + " EOEXAMORDER=" + quote(edExamOrder.Text)
            
            + " ABSENTCHASU=" + quote(iif(cbxCourse.Value=="10", radAbsentChasuGubun.Value, ""))
            // args 

		,"lfn_AfterSearchExamAbsent"

		,false

	);

}



/*

 * 기능 : 저장

 */

function lfn_Save(obj) {

	if (cbxCourse.Value == "10") {	// 특급만

		if (gfn_isNull(radAbsentChasuGubun.Value)) {
	
			gfn_Alert("차수를 선택해 주십시오.");
	
			return false;
	
		}

	}
    

    if (!gfn_CheckChangedGrid(this)) { //선택한것이 있는지 체크 메세지 보임

        gfn_Alert("결시대상자를 선택해 주십시오.");      

        return false;

    }

    

    if (!gfn_Confirm("결시처리를 하시겠습니까?")) {

        return false;

	}

	

	lfn_SaveModifyHistory("U"); // 변경이력을 저장한다.

    

    tit_clearActionInfo();

	tit_addMultiActionInfo("training:updateExam0421Absent", "", 0, "", "N");

	// 서버 호출 

	tit_callService(

		""

		,""

		,"ds_iExamAbsent=ds_ioExamAbsent:U"	// inDs

		,""	// outDs

		,""	// args 

		,"lfn_AfterUpdateExamAbsent"

		,false

	);

}



/*

 * 기능 : 최초 출석부 생성저장

 */

var flag = 0;

function lfn_SaveAttendance(obj) {

    if (!gfn_FormValidate(this)) { // 조회 Validation Check

        return false;

    }    

    

    ds_oExamJubsuCnt.ClearData(); // 데이타셋 초기화    

    // 조회이력을 저장한다.  

    ls_HistoryArg = "지부=" + quote(cbxJibu.Text)

                + ",직능=" + quote(cbxCourse.Text)

                + ",년도=" + quote(edExamYear.Text)

                + ",회차=" + quote(edExamOrder.Text);

    gfn_InsertSearchPrintHistory(

        "S"

        , this.ID

        , global.mnuLeft.cbxOpenForm.Text

        , ls_HistoryArg

    );

    tit_clearActionInfo();

	tit_addCsvSearchActionInfo("training:searchExam0421JubsuPersonCnt", false);

	// 서버 호출 

	tit_callService(

		""

		,""

		,""	// inDs

		,"ds_oExamJubsuCnt=ds_oExamJubsuCnt"	// outDs

		,"EOMGJIBUCD=" + quote(cbxJibu.Value)

            + " TCCOURSECD=" + quote(cbxCourse.Value)

            + " EOYEAR=" + quote(edExamYear.Text)

            + " EOEXAMORDER=" + quote(edExamOrder.Text)// args 

		,""

		,false

		,""

		,true

	);	

	if (ds_oExamJubsuCnt.GetCount() < 1) {

        gfn_Alert("해당회차에 접수자가 존재하지 않습니다.");

        return;

	}

	

	if (ds_ioExamAbsent.GetCount() < 1) {

        if (!gfn_Confirm("출결자료를 생성 하시겠습니까?")) {

            return false;

        }

	}

	

	if (ds_ioExamAbsent.GetCount() >= 1) {

        if (!gfn_Confirm("출결자료를 추가생성 하시겠습니까?")) {

            return false;

        }

	}


    tit_clearActionInfo();

	tit_addSingleActionInfo("training:insertExam0421Absent"

        , ""

        , 0

        , ""

    );

	// 서버 호출 

	tit_callService(

		""

		,""

		,""	// inDs

		,""	// outDs

		,"EOMGJIBUCD=" + quote(cbxJibu.Value)

            + " TCCOURSECD=" + quote(cbxCourse.Value)

            + " EOYEAR=" + quote(edExamYear.Text)

            + " EOEXAMORDER=" + quote(edExamOrder.Text)	// args 

		,"lfn_AfterSaveExamAbsent"

		,false

	);

}

/* 공통 필수 종료 */



/* 사용자 함수 */

/*

 * 기능 : 결시자 조회 후 처리해야 할 내용

 * parameter : nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterSearchExamAbsent(nErrorCode, strErrorMsg) {

    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }

	medTotalCnt.Value = ds_ioExamAbsent.GetCount();

    medExamDate.Value = ds_ioExamAbsent.GetColumn(0, "EOEXAMDATE");
    
    gfn_SearchMessage(gdExamAbsent); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.

}



/*

 * 기능 : Transaction 서비스 호출 후 처리해야 할 내용

 * parameter : strSvcID - 서비스ID

 *             nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterUpdateExamAbsent(nErrorCode, strErrorMsg) {

    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }   

    

    gfn_SaveMessage(); // 저장 메세지를 처리한다.    

    gfn_SearchMessage(gdExamAbsent);

    lfn_Search(); // 결시자 조회   

}



/*

 * 기능 : Transaction 서비스 호출 후 처리해야 할 내용

 * parameter : strSvcID - 서비스ID

 *             nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterSaveExamAbsent(nErrorCode, strErrorMsg) {

    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }

    

    gfn_SaveMessage(); // 저장 메세지를 처리한다.

    lfn_Search(); // 결시자 조회

}



/*

 * 기능 : 버튼 활성/비활성시킨다.

 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)

 * return : 없음

 */

function lfn_SetFormAuth(bStatus) {

    btnCancelAbsent.Enable = bStatus; // 결시취소

    btnSave.Enable = bStatus; // 결시처리

    //gdExamAbsent.Editable = bStatus;

}



/* 사용자 이벤트 함수 */

function btnMutilSort_OnClick(obj) {

	gfn_GridMultiSort(gdExamAbsent, 1); // 멀티 정렬을 실행한다.

}



function ds_ioExamAbsent_OnRowPosChanged(obj,nOldRow,nRow) {

    // 그리드의 값을 입력란에 복사한다. 추가상태인 경우 복사 후 저장을 하기 위해 제외한다.

    if (obj.GetRowType(nRow) <> "insert" && nRow <> -1) {

        

        gfn_MakeKeyMark(this); // 키값 수정 금지 설정

	}

	mb_IsNewData = false; // 저장버튼이 클릭 초기화

}



/* 회차 포커스 아웃될때 자동 0 입력 */

function edExamOrder_OnKillFocus(obj) {

	gfn_ComponentOnKillFocus(obj);



    obj.Text = iif(gfn_IsNull(obj.Text), "", lpad(obj.Text, "0", 3));    

}



function btnCancelAbsent_OnClick(obj) {

    var sArg = "";

    return Dialog("training::frmtraining0422PExamAbsentCancel.xml", sArg, 292, 160, "", -1, -1);

}





function radAbsentChasuGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)

{  

	medAbsenCnt.Value = 0;

	ds_ioExamAbsent.Reset();

}



function ds_ioExamAbsent_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)

{

	if (cbxCourse.Value == "10") {	// 특급만

		if (radAbsentChasuGubun.Value == 0) {
	
			gfn_Alert("결시구분을 선택해 주십시오.");
	
			ds_ioExamAbsent.Reset();
	
			return false;
	
		}

	}

    var cnt = 0; // 결시자수

	for(i = 0; i < ds_ioExamAbsent.RowCount(); i++) {

        if (ds_ioExamAbsent.GetColumn(i, "SEL") == 1) {

            cnt += 1; // 결시자수 카운트

        }

    }

    medAbsenCnt.Value = cnt;

    
	if (cbxCourse.Value == "10") {	// 특급이면

		if (radAbsentChasuGubun.Value == 1) {	//1차 결시
	
			if (ds_ioExamAbsent.GetColumn(nRow, "SEL") == 1) { // 결시체크를 할 경우
	
				if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "0") { // 1,2차 접수한 응시자이면
	
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "N");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "N");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "N");
				
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "1") { // 1차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "N");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "N");
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "X");
					
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "2") { // 2차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "X");
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD2CHASU"));
							
				}
	
			} else {
			
				if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "0") { // 1,2차 접수한 응시자이면
	
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "Y");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD2CHASU"));
				
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "1") { // 1차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "Y");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "Y");
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "X");
					
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "2") { // 2차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "X");
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD2CHASU"));
							
				}
			
			}
	
		} else if (radAbsentChasuGubun.Value == 2) {	//2차 결시
	
			if (ds_ioExamAbsent.GetColumn(nRow, "SEL") == 1) { // 결시체크를 할 경우
			
				if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "0") { // 1,2차 접수한 응시자이면
	
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "N");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD1CHASU"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "N");
	
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "1") { // 1차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD1CHASU"));
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "X");
					
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "2") { // 2차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "N");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "X");
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "N");
							
				}
	
			} else {
	
				if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "0") { // 1,2차 접수한 응시자이면
	
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD1CHASU"));
		
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "Y");
				
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "1") { // 1차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));
	
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", ds_ioExamAbsent.GetColumn(nRow, "EAOLD1CHASU"));
			
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "X");
					
				} else if (ds_ioExamAbsent.GetColumn(nRow, "EJCHASUGUBUN") == "2") { // 2차만 접수한 응시자이면
				
					ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "Y");
		
					ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "X");
				
					ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "Y");
							
				}
	
			}
	
		}

	} else {	// 1,2,3급이면

		if (ds_ioExamAbsent.GetColumn(nRow, "SEL") == 1) { // 결시체크를 할 경우

			ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", "N");
	
			ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "");
	
			ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "");
			
		} else {
		
			ds_ioExamAbsent.SetColumn(nRow, "EAGUBUN", ds_ioExamAbsent.GetColumn(nRow, "EAOLDGUBUN"));

			ds_ioExamAbsent.SetColumn(nRow, "EA1CHASU", "");
	
			ds_ioExamAbsent.SetColumn(nRow, "EA2CHASU", "");
		
		}
	
	}

}



function lfn_SearchExamAbsent() {    

    if (gfn_IsNull(cbxJibu.Value)

            || gfn_IsNull(cbxCourse.Value)

            || gfn_IsNull(edExamYear.Text)

            || gfn_IsNull(edExamOrder.Text)) {

        return false;

    }

    edExamOrder.Text = iif(gfn_IsNull(edExamOrder.Text), "", lpad(edExamOrder.Text, "0", 3));    

    lfn_Search();

}



function btnToExcel_OnClick(obj) {

    if (ds_ioExamAbsent.GetRowCount() < 1) {

        gfn_Alert("출력할 데이터가 존재하지 않습니다.");

        return false;

    }

	// 개인정보 다운로드 사유 등록
	var parValue = "sCode=1206";	// COMMON.PERSONALDOWNLOADH
		parValue += " sRowCnt=" + ds_ioExamAbsent.GetRowCount();
		parValue += " sTitle=" + quote(gdExamAbsent.UserData);
	ls_IsRemark = Dialog("COM::frmCOM2100PDownloadRemark.xml", parValue, "", "", "", -1, -1);	

	if (ls_IsRemark == "" || ls_IsRemark == null || ls_IsRemark == "FAIL") {
		return false;
	}
	lfn_Excel(obj);

}



function cbxCourse_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)

{
	// 결시구분(특급만 보이도록)
	if (strCode = "10") {
		lbAbsentDateGubun.Visible = true;
		radAbsentChasuGubun.Visible = true;	
	
	} else {
		lbAbsentDateGubun.Visible = false;
		radAbsentChasuGubun.Visible = false;	
	}
	
	

	edExamOrder.Text = "";

	edExamOrder.SetFocus();

}



/*

 * 기능 : 업무 변경이력을 저장한다.

 * parameter : sGubun - 변경구분. 예) I, U, D

 * return : 없음

 */

function lfn_SaveModifyHistory(sGubun) {    

    for(var i = 0; i < ds_ioExamAbsent.RowCount(); i++) {

        if (ds_ioExamAbsent.GetColumn(i, "SEL") == 1) {

            gds_iModifyHistory.InsertRow(0);                 // 데이터셋 row 추가            

            gds_iModifyHistory.SetColumn(0, "MHWORKGUBUN", "시험출결관리_결시처리"); // 업무구분

            gds_iModifyHistory.SetColumn(0, "MHGUBUN", sGubun); // 변경구분

            gds_iModifyHistory.SetColumn(0, "MHKEY", ds_ioExamAbsent.GetColumn(i, "EJMGNO")); // KEY값

            gds_iModifyHistory.SetColumn(0, "MHCOLUMN", "출결"); // 변경 컬럼명

            gds_iModifyHistory.SetColumn(0, "MHBEFOREDATA", "Y"); // 변경 전 값

            gds_iModifyHistory.SetColumn(0, "MHAFTERDATA", "N"); // 변경 후 값

        }

    }



    gfn_InsertModifyHistory(); // 업무 변경이력을 저장한다.

}
function edExamOrder_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if (nChar == 13) {
		obj.Text = iif(gfn_IsNull(obj.Text), "", lpad(obj.Text, "0", 3));
		lfn_Search();
	}
}


function lfn_Init(obj)
{
	cbxCourse.Value = "22";
    
    edExamOrder.Text = "";

	medExamDate.Text = "";
	
	radAbsentChasuGubun.Value = "";
	
	medTotalCnt.Text = "";
	
	medAbsenCnt.Text = "";

    ds_ioExamAbsent.ClearData();
    
    edExamOrder.SetFocus();		
}

function Form_OnActivate(obj)
{
	gs_SysID = "[stm_01,bsn_4000,dsc_0007]";	// 개인정보접속기록 시스템ID 
}
]]></Script>
</Window>