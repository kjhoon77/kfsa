<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="412" Id="frmtraining0259PSettlementPOS" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="통합영수증발급(POS)시스템팝업" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_oRecieptYn">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>Y</CD>
						<DATA>출력</DATA>
					</record>
					<record>
						<CD>N</CD>
						<DATA>미출력</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oPosProgramId"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioSetlm">
				<Contents>
					<colinfo id="LSLLCSNO" size="19" summ="default" type="STRING"/>
					<colinfo id="LSLHSEQ" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSSEQ" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSSETLMTYN" size="1" summ="default" type="STRING"/>
					<colinfo id="LSGUBUNCD" size="2" summ="default" type="STRING"/>
					<colinfo id="LSGUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="LSPROCAMOUNT" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSPROCDATE" size="8" summ="default" type="STRING"/>
					<colinfo id="LSPONYGUBUN" size="1" summ="default" type="STRING"/>
					<colinfo id="LSPONYDATE" size="8" summ="default" type="STRING"/>
					<colinfo id="LSPROCGTMGNO" size="4" summ="default" type="STRING"/>
					<colinfo id="LSPMYEAR" size="4" summ="default" type="STRING"/>
					<colinfo id="LSPMMGNO" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSREPAYREF" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSACTIVEYN" size="1" summ="default" type="STRING"/>
					<colinfo id="LSREGDATE" size="7" summ="default" type="STRING"/>
					<colinfo id="LSREGSABUN" size="8" summ="default" type="STRING"/>
					<colinfo id="LSMODDATE" size="7" summ="default" type="STRING"/>
					<colinfo id="LSMODSABUN" size="8" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oSunapGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>0</CD>
						<DATA>현금</DATA>
					</record>
					<record>
						<CD>1</CD>
						<DATA>카드</DATA>
					</record>
					<record>
						<CD>2</CD>
						<DATA>현금영수증</DATA>
					</record>
					<record>
						<CD>3</CD>
						<DATA>가상계좌</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oBankSunapGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>0</CD>
						<DATA>방문(직납)</DATA>
					</record>
					<record>
						<CD>4</CD>
						<DATA>방문(은납)</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oProcGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>01</CD>
						<DATA>수납</DATA>
					</record>
					<record>
						<CD>02</CD>
						<DATA>환불</DATA>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="92" Height="28" Id="shpGubunBox2" Left="4" LineColor="user15" Right="796" TabOrder="6" Top="64" Type="Rectangle" Width="792"></Shape>
		<Shape Bottom="196" Height="100" Id="shpGubunBox3" Left="4" LineColor="user15" Right="796" TabOrder="9" Top="96" Type="Rectangle" Width="792"></Shape>
		<Shape Bottom="60" Height="28" Id="shpGubunBox1" Left="4" LineColor="user15" Right="796" TabOrder="8" Top="32" Type="Rectangle" Width="792"></Shape>
		<Shape Bottom="28" Height="28" Id="shpBtnBox" Left="572" LineColor="user14" Right="796" TabOrder="7" Top="0" Type="Rectangle" Width="224"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPosResultList" ImageID="BTN_TEXT_09" Left="575" OnClick="btnPosResultList_OnClick" Style="sty_Button" TabOrder="1" Text="영수증처리결과조회" Top="3" Transparent="TRUE" Width="131"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="708" OnClick="lfn_End" Style="sty_Button" TabOrder="2" ToolTipText="닫기" Top="3" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbProgramId" Left="8" Style="sty_Label" TabOrder="4" Text="단위프로그램" Top="36" UserData="S" VAlign="Middle" Width="100"></Static>
		<Static Align="Center" Height="20" Id="lbJibuMgId" Left="400" Style="sty_Label" TabOrder="3" Text="지부관리ID" Top="36" VAlign="Middle" Width="100"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrintScreen" ImageID="BTN_COM_SCREEN" Left="4" OnClick="lfn_PrintScreen" Style="sty_Button" TabOrder="5" ToolTipText="화면&#32;출력" Top="4" Visible="FALSE" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbTotalSunapFee" Left="8" Style="sty_Label" TabOrder="11" Text="수납금액" Top="68" VAlign="Middle" Width="100"></Static>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medTotalSunapFee" Left="112" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Maskedit" TabOrder="10" Top="68" Width="72"></MaskEdit>
		<Edit Align="CENTER" AutoSelect="TRUE" BKColor="#568eb7" Border="None" Cursor="HELP" DisableColor="white" Height="20" Id="edPonyDate" ImeMode="native" Left="224" LeftMargin="2" OnFocus="edPonyDate_OnFocus" Readonly="TRUE" Style="sty_Label" TabOrder="16" Text="정산일자" ToolTipText="방문(직납&#32;OR&#32;은납(통장))에&#32;돈을&#32;입금받은&#32;날짜" Top="148" Width="100"></Edit>
		<Checkbox FalseValue="N" Height="20" Id="chkPonyDate" Left="328" OnClick="chkPonyDate_OnClick" OnKeyDown="gfn_EnterNextFocus" Style="sty_Checkbox" TabOrder="13" Text="수납일과&#32;틀린&#32;경우" Top="148" TrueValue="Y" Value="FALSE" Width="134"></Checkbox>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" Enable="FALSE" HeaderFont="돋음,10,Bold" Height="20" Id="calPonyDate" Left="468" OnFocus="gfn_ComponentOnFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="14" Top="148" UserData="I:정산일자" WeeksFont="돋음,9" Width="98"></Calendar>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" HeaderFont="돋음,10,Bold" Height="20" Id="calSunapDate" Left="112" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="12" Top="148" UserData="I:처리일자" WeeksFont="돋음,9" Width="98"></Calendar>
		<Static Align="Center" Height="20" Id="lbSunapDate" Left="8" Style="sty_Label" TabOrder="15" Text="처리일자" Top="148" VAlign="Middle" Width="100"></Static>
		<Static Align="Center" Height="20" Id="lbProcGubun" Left="8" Style="sty_Label" TabOrder="17" Text="결제구분" Top="100" VAlign="Middle" Width="100"></Static>
		<Static Align="Center" Height="20" Id="lbProcAmount" Left="8" Style="sty_Label" TabOrder="18" Text="결제금액" Top="124" VAlign="Middle" Width="100"></Static>
		<Static Align="Center" Height="20" Id="lbRecieptYn" Left="8" Style="sty_Label" TabOrder="20" Text="영수증출력여부" Top="172" VAlign="Middle" Width="100"></Static>
		<Radio Border="None" CodeColumn="CD" ColumnCount="2" DataColumn="DATA" Height="18" Id="radRecieptYn" INDEX="0" InnerDataset="ds_oRecieptYn" Left="114" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="19" Top="173" Value="N" Width="150"></Radio>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edProcAmount" ImeMode="native" Left="188" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="21" Top="124" Visible="FALSE" Width="604"></Edit>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Height="20" Id="medProcAmount" Left="112" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Maskedit" TabOrder="22" Top="124" UserData="I:결제금액" Width="72"></MaskEdit>
		<Button BKColor="user17" ButtonStyle="TRUE" Cursor="HAND" Font="굴림,10,Bold" Height="44" Id="btnSetlmt" Left="300" OnClick="btnSetlmt_OnClick" Style="sty_Button" TabOrder="23" Text="결제처리" Top="360" Width="200"></Button>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edBizGubunNm" ImeMode="native" Left="712" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="24" Top="36" Width="80"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edJibuMgId" ImeMode="native" Left="504" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="25" Top="36" Width="204"></Edit>
		<Div BKColor="user0" Height="24" Id="divPos" Left="92" OnLoadCompleted="Form_OnLoadCompleted" OnTimer="frmCOM3010SPOS_OnTimer" OnUnloadCompleted="frmCOM3010SPOS_OnUnloadCompleted" Style="sty_Form" TabOrder="26" TabStop="FALSE" Text="Div0" Top="4" Url="COM::frmCOM3010SPOS.xml" Visible="FALSE" Width="84">
			<Contents></Contents>
		</Div>
		<Radio Border="None" CodeColumn="CD" ColumnCount="4" DataColumn="DATA" Height="20" Id="radProcGubun" INDEX="0" InnerDataset="ds_oProcGubun" Left="112" Style="sty_Radio" TabOrder="27" Top="100" Value="01" Width="148"></Radio>
		<Shape Bottom="352" Height="144" Id="shpGubunBox5" Left="4" LineColor="user15" Right="796" TabOrder="31" Top="208" Type="Rectangle" Width="792"></Shape>
		<Static Align="Center" Height="20" Id="lbBankSunapGubun" Left="8" Style="sty_Label" TabOrder="30" Text="수납방법" Top="224" VAlign="Middle" Width="100"></Static>
		<Static Align="Center" Height="20" Id="lbSunapGubun" Left="8" Style="sty_Label" TabOrder="32" Text="납부방법" Top="248" VAlign="Middle" Width="100"></Static>
		<Radio Border="None" CodeColumn="CD" ColumnCount="4" DataColumn="DATA" Height="18" Id="radSunapGubun" INDEX="0" InnerDataset="ds_oSunapGubun" Left="114" OnChanged="radSunapGubun_OnChanged" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="29" Top="249" Value="0" Width="500"></Radio>
		<Static Align="Center" Height="20" Id="lbSunab" Left="16" Style="sty_LabelGruopBox" TabOrder="33" Text="결제&#32;(수납)" Top="200" VAlign="Middle" Width="100"></Static>
		<Radio Border="None" CodeColumn="CD" ColumnCount="2" DataColumn="DATA" Height="20" Id="radBankSunapGubun" INDEX="0" InnerDataset="ds_oBankSunapGubun" Left="114" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="28" Top="225" Value="0" Width="208"></Radio>
		<Div BKColor="user0" Border="Flat" BorderColor="#aab6c7" Height="76" Id="divSunabDtl" Left="8" OnLoadCompleted="Form_OnLoadCompleted" Style="sty_Form" TabOrder="34" TabStop="FALSE" Text="Div0" Top="272" Url="training::frmtraining3101SSettlementPOSSunap.xml" Width="784">
			<Contents></Contents>
		</Div>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edProgramIdStart" ImeMode="native" Left="112" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="35" Top="36" Width="284"></Edit>
	</Form>
	<Script><![CDATA[/*
 * 강습접수정보명 : frmtraining0259PSettlementPOS.xml
 * 설명 : 통합영수증발급(POS)시스템팝업
 * 작성일 : 2009.09.15
 * 작성자 : 김동현
 */

#include "LIB::COMMON.js"; // 공통 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
    
    trace(sPmMgno+" " +sPmYear);
    
    if(length(sPmMgno)<1 && length(sPmYear)<1 ) {
        ds_oProcGubun.Filter("CD=='01'");
    } else {
        ds_oProcGubun.Filter("CD=='02'");
        radProcGubun.Value = "02";
    }
    
    edProgramIdStart.Text = "수첩관리[수첩발급]";
    if (sGubun == "L") {
        medTotalSunapFee.Value = 10000;
    } else if (sGubun == "T") {
    
    } else if (sGubun == "E") {
    
    } else {
        close(false);
    }
    radProcGubun.Value = "01";
    medProcAmount.Value = medTotalSunapFee.Value;
    calSunapDate.Value = getDate();
    radRecieptYn.Value = "N";
    divSunabDtl.medAmount.Value = medProcAmount.Value;

}

function radSunapGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {

	if (strCode == "0") { // 현금
        divSunabDtl.Url = "training::frmtraining3101SSettlementPOSSunap.xml";
        radBankSunapGubun.Enable = true;
	} else if (strCode == "1") { // 카드
        divSunabDtl.Url = "training::frmtraining3102SSettlementPOSSunap.xml";
        radBankSunapGubun.Value = "0";
        radBankSunapGubun.Enable = false;

        for (var i = 0; i < 1000; i++) { // loading time delay용
            idle();
        }
        
        if (medProcAmount.Value < 50000) { // 5만원 미만 할부불가
            divSunabDtl.cbxInstallment.Enable = false;
        } else {
            divSunabDtl.cbxInstallment.Enable = true;
        }
	} else if (strCode == "2") { // 현금영수증
        divSunabDtl.Url = "training::frmtraining3103SSettlementPOSSunap.xml";
        radBankSunapGubun.Enable = true;
	} else if (strCode == "3") { // 가상계좌
        divSunabDtl.Url = "training::frmtraining3104SSettlementPOSSunap.xml";
        radBankSunapGubun.Value = "0";
        radBankSunapGubun.Enable = false;
    }
}

function btnPosResultList_OnClick(obj) {
    var ls_SetlmtGubun = ""; // 결제구분
    var sArg = ""; // 팝업파라메터
    var ls_RetReult = ""; // 결제처리결과팝업 리턴값용
	if (ls_SetlmtGubun == "0") { // 현금
        sArg = "";//"sPosId=" + quote(sPosId);
        ls_RetReult = Dialog("training::frmtraining3211PSettlementPOSResultInfo.xml", sArg, 500, 268, "", -1, -1);
	} else if (ls_SetlmtGubun == "1") { // 카드
        sArg = "";//"sPosId=" + quote(sPosId);
        ls_RetReult = Dialog("training::frmtraining3212PSettlementPOSResultInfo.xml", sArg, 500, 292, "", -1, -1);
	} else if (ls_SetlmtGubun == "2") { // 현금영수증
        sArg = "";//"sPosId=" + quote(sPosId);
        ls_RetReult = Dialog("training::frmtraining3213PSettlementPOSResultInfo.xml", sArg, 500, 292, "", -1, -1);
	}
}

function btnSetlmt_OnClick(obj) {

    var nRow = 0;

    if (radProcGubun.Value == "01") {
        ds_ioSetlm.InsertRow(0);
        nRow = 0;
    } else {
        nRow = ds_ioSetlm.currow;
    }
    
    var ls_SunapGubun = "1" + (ToNumber(radBankSunapGubun.Value) + ToNumber(radSunapGubun.Value));
    
    ds_ioSetlm.SetColumn(nRow, "LSLLCSNO", sLcnNo);
	ds_ioSetlm.SetColumn(nRow, "LSLHSEQ", sSeq);
	ds_ioSetlm.SetColumn(nRow, "LSSETLMTYN", "Y");
	ds_ioSetlm.SetColumn(nRow, "LSGUBUNCD", radProcGubun.Value);
	ds_ioSetlm.SetColumn(nRow, "LSGUBUN", ls_SunapGubun);
	ds_ioSetlm.SetColumn(nRow, "LSPROCAMOUNT", medProcAmount.Value);
	ds_ioSetlm.SetColumn(nRow, "LSPROCDATE", left(calSunapDate.Value,8));
	ds_ioSetlm.SetColumn(nRow, "LSPONYGUBUN", iif(chkPonyDate=="Y","1","0"));
	ds_ioSetlm.SetColumn(nRow, "LSPONYDATE", iif(chkPonyDate=="Y",left(calPonyDate.Value,8),left(calSunapDate.Value,8)));
	ds_ioSetlm.SetColumn(nRow, "LSPROCGTMGNO", substr(gds_oUserInfo.GetColumn(0, "PDEPTCD"),1,2));
	ds_ioSetlm.SetColumn(nRow, "LSPMYEAR", iif(sPmYear == "", left(getDate(),4), sPmYear));
	ds_ioSetlm.SetColumn(nRow, "LSPMMGNO", sPmMgno);
	ds_ioSetlm.SetColumn(nRow, "LSACTIVEYN", "Y");
	
	tit_clearActionInfo();
    tit_addSingleActionInfo("training:insertLicenseSettlement", "", 0, "");
    tit_callService(
        ""
        ,""
        ,"ds_iLicenseSettlement=ds_ioSetlm:U" // inDs
        ,""	// outDs
        ,""	// args
        ,"lfn_AfterSaveLicense"
        ,false
    );
    
    Close();
}

function lfn_AfterSaveLicense(nErrorCode, strErrorMsg) {

    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    var sRlt = false;

    if (radSunapGubun.value == "0") {
        sRlt = Dialog("training::frmtraining3211PSettlementPOSResultInfo.xml", sArg, 800, 412, "", -1, -1);
    } else if (radSunapGubun.value == "1") {
        sRlt = Dialog("training::frmtraining3212PSettlementPOSResultInfo.xml", sArg, 800, 412, "", -1, -1);
    } else if (radSunapGubun.value == "2") {
//        sRlt = Dialog("training::frmtraining3000PSettlementPOS.xml", sArg, 800, 412, "", -1, -1);
    }

}

function lfn_End(obj) {
	Close(false);
}

function chkPonyDate_OnClick(obj,strValue) {
	if (chkPonyDate == "Y") {
        calPonyDate.Value = calSunapDate.Value;
        calPonyDate.Enable = true;
	} else {
        calPonyDate.Value = "";
        calPonyDate.Enable = false;
	}
}
]]></Script>
</Window>