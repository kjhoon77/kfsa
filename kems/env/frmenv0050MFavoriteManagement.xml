<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="590" Id="frmenv0050MFavoriteManagement" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="즐겨찾기관리" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioFavorites">
				<Contents>
					<colinfo id="FORDERSEQ" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="MENUAAUTH" size="10" summ="default" type="STRING"/>
					<colinfo id="MENULEVEL" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="MMENUID" size="20" summ="default" type="STRING"/>
					<colinfo id="MMENUNM" size="50" summ="default" type="STRING"/>
					<colinfo id="MPARENTMENUID" size="20" summ="default" type="STRING"/>
					<colinfo id="MREMARK" size="1000" summ="default" type="STRING"/>
					<colinfo id="MSYSGUBUN" size="30" summ="default" type="STRING"/>
					<colinfo id="MURL" size="100" summ="default" type="STRING"/>
					<colinfo id="MURLTYPE" size="1" summ="default" type="STRING"/>
					<colinfo id="USE_YN" size="1" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oMenuTree">
				<Contents>
					<colinfo id="MORDERSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="MMENUID" size="256" summ="default" type="STRING"/>
					<colinfo id="MENULEVEL" size="256" summ="default" type="STRING"/>
					<colinfo id="MPARENTMENUID" size="256" summ="default" type="STRING"/>
					<colinfo id="MMENUNM" size="256" summ="default" type="STRING"/>
					<colinfo id="FORDERSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="MURL" size="256" summ="default" type="STRING"/>
					<colinfo id="MENU_REMARK" size="256" summ="default" type="STRING"/>
					<colinfo id="MURLTYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="MSYSGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_iDelFavorites">
				<Contents>
					<colinfo id="PSABUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div BKColor="user0" Height="28" Id="divWorkFormTitle" OnLoadCompleted="Form_OnLoadCompleted" Style="sty_Form" TabOrder="4" TabStop="FALSE" Text="Div0" Url="COM::frmCOM0100SWorkFormTitle.xml" Width="300">
			<Contents></Contents>
		</Div>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="22" Id="btnSave" ImageID="BTN_COM_SAVE" Left="536" OnClick="lfn_Save" Style="sty_Button" TabOrder="3" ToolTipText="수정&#32;저장" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrintScreen" ImageID="BTN_COM_SCREEN" Left="623" OnClick="lfn_PrintScreen" Style="sty_Button" TabOrder="1" ToolTipText="화면&#32;출력" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="710" OnClick="lfn_End" Style="sty_Button" TabOrder="2" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_ioFavorites" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="584" ColSizing="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="528" Id="gdFavorites" InputPanel="FALSE" Left="444" LineColor="default" MinWidth="100" OnCellDBLClick="gdFavorites_OnCellDblClick" OnHeadClick="gdFavorites_OnHeadClick" Right="794" RowHeight="20" Style="sty_Grid" TabOrder="5" TabStop="true" Top="56" UseDBuff="true" UsePopupMenu="true" UserData="즐겨찾기목록" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="350">
			<contents>
				<format id="Default">
					<columns>
						<col width="60"/>
						<col width="287"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" text="정렬순서"/>
						<cell align="center" col="1" display="text" text="메뉴명"/>
					</head>
					<body>
						<cell align="center" col="0" colid="CCCD" display="number" expr="currow+1"/>
						<cell align="left" col="1" colid="MMENUNM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnMoveUp" ImageID="BTN_TEXT_01" Left="444" OnClick="btnMoveUp_OnClick" TabOrder="6" Text="▲" Top="32" Width="30"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnMoveDown" ImageID="BTN_TEXT_01" Left="476" OnClick="btnMoveDown_OnClick" TabOrder="7" Text="▼" Top="32" Width="30"></Button>
		<TreeView BindDataset="ds_oMenuTree" Border="Flat" Height="552" Id="tvMenu" Left="4" LevelColumn="MENULEVEL" OnDblClick="tvMenu_OnDblClick" Style="sty_TextArea" TabOrder="8" TEXTColumn="MMENUNM" Top="32" Width="350"></TreeView>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnDel" ImageID="BTN_TEXT_04" Left="367" OnClick="btnDel_OnClick" Style="sty_Button" TabOrder="9" Text="◀&#32;삭제" Top="308" Transparent="TRUE" Width="66"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnAdd" ImageID="BTN_TEXT_04" Left="367" OnClick="btnAdd_OnClick" Style="sty_Button" TabOrder="10" Text="추가&#32;▶" Top="264" Transparent="TRUE" Width="66"></Button>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="532" LineColor="user14" Right="798" TabOrder="61" Top="1" Type="Rectangle" Width="266"></Shape>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmenv0050MFavoriteManagement.xml
 * 설명 : 즐겨찾기관리
 * 작성일 : 2009.07.06
 * 작성자 : 장성호
 */

#include "LIB::sys.js"; // 공통업무 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리

    // 폼 환경설정
    ls_SystemGubun = gs_SystemGubun;
    ls_SystemMenuId = gs_SystemMenuId;
    var ls_FormId = split(sFormUrl, "::");
    ls_FormId = split(ls_FormId[1], ".");
    obj.Title = sFormTitle + "(" + ls_FormId[0] + ")";

    gfn_MakeRequiredInputMark(this); // 필수 입력란을 설정한다.

    ms_FormAuth = gfn_GetFormAuth(this); // 권한을 조회한다.
    if (ms_FormAuth == "W") { // 권한에 따른 버튼 설정
        lfn_SetFormAuth(true); // 저장 권한
    } else if (ms_FormAuth == "R") {
        lfn_SetFormAuth(false); // 읽기 권한
    } else {
        gfn_Alert(MSGI00080);
        close();
    }

    lfn_Search();
}

function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
    // to do

    gfn_Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam); // 공통 키 이벤트 처리
}

function Form_OnSize(obj,nCx,nCy,nState)
{
    if (gs_IsResizingForm == "Y") {
        gdFavorites.Height = nCy - gdFavorites.Top - 4;
    }
}

/*
 * 기능 : 조회
 */
function lfn_Search(obj) {
    lfn_SearchMenuTree(); // 메뉴 조회
    lfn_SearchFavorites(); // 즐겨찾기 조회
}

/*
 * 기능 : 저장
 */
function lfn_Save(obj) {
	if (!gfn_Confirm(MSGW00040)) { // 정말로 수정 저장 하시겠습니까?
        return false;
	}

    var ln_RowCnt = ds_ioFavorites.GetCount();
    for (var i = 0; i < ln_RowCnt; i++) {
        ds_ioFavorites.SetColumn(i, "FORDERSEQ", i + 1);
    }

	tit_clearActionInfo();
	tit_addSingleActionInfo("env:deleteFavorites", "", 0, "");
	// 서버 호출 
	tit_callService(
		""
		,""
		,""	// inDs
		,""	// outDs
		,""	// args 
		,"lfn_AfterDeleteFavorites"
		,false
	);
}
/* 공통 필수 종료 */

/* 사용자 함수 */
/*
 * 기능 : 즐겨찾기 조회 후 처리해야 할 내용
 * parameter : nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
 /*
 * 기능 : 메뉴 조회
 */
function lfn_SearchMenuTree(obj) {
    ds_oMenuTree.ClearData(); // 데이타셋 초기화

    tit_clearActionInfo();
	tit_addSearchActionInfo("sys:searchMenu", false);
	// 서버 호출 
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_oMenuTree=ds_oMenu"	// outDs
		,"USE_YN='Y'"	// args 
		,"lfn_AfterSearchMenu"
		,false
	);
}

/*
 * 기능 : 메뉴 조회 후 처리해야 할 내용
 * parameter : nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterSearchMenu(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    gfn_SearchMessage(); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
}

/*
 * 기능 : 조회
 */
function lfn_SearchFavorites(obj) {
    ds_ioFavorites.ClearData(); // 데이타셋 초기화

    tit_clearActionInfo();
	tit_addSearchActionInfo("env:searchFavorites", false);
	// 서버 호출 
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_ioFavorites=ds_oFavorites"	// outDs
		,""	// args 
		,"lfn_AfterSearchFavorites"
		,false
	);
}

function lfn_AfterDeleteFavorites(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

	tit_clearActionInfo();
	tit_addSaveActionInfo(
		"env:insertFavorites"	// insert
		, "env:insertFavorites"	// update
		, ""	// delete
		, ""	// flag column 명
		, ""	// key sql id
		, 0	// key 증가 값
		, "" 
		, 0 
		, "N"	// 실행타입
	);
	// 서버 호출 
	tit_callService(
		""
		,""
		,"ds_iFavorites=ds_ioFavorites:U"	// inDs
		,""	// outDs
		,""	// args 
		,"lfn_AfterSaveFavorites"
		,false
	);
}

function lfn_AfterSearchFavorites(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    gfn_SearchMessage(gdFavorites); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
}

/*
 * 기능 : Transaction 서비스 호출 후 처리해야 할 내용
 * parameter : strSvcID - 서비스ID
 *             nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterSaveFavorites(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    gfn_SaveMessage(); // 저장 메세지를 처리한다.
    lfn_SearchFavorites(); // 즐겨찾기 조회
}

/*
 * 기능 : 버튼 활성/비활성시킨다.
 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)
 * return : 없음
 */
function lfn_SetFormAuth(bStatus) {
    btnSave.Enable = bStatus; // 수정&저장 버튼
    btnMoveUp.Enable = bStatus;
    btnMoveDown.Enable = bStatus;
    btnAdd.Enable = bStatus;
    btnDel.Enable = bStatus;
}

/* 사용자 이벤트 함수 */
/*
 * 기능 : ▲ 버튼의 OnClick 이벤트를 처리하는 함수
 */
function btnMoveUp_OnClick(obj) {
    gfn_GridSortMarkClear(gdFavorites); // Head Sort 마크 제거한다.
	ds_ioFavorites.MoveRow(ds_ioFavorites.currow, ds_ioFavorites.currow - 1);
	ds_ioFavorites.row = ds_ioFavorites.currow - 1;
}

/*
 * 기능 : ▼ 버튼의 OnClick 이벤트를 처리하는 함수
 */
function btnMoveDown_OnClick(obj) {
    gfn_GridSortMarkClear(gdFavorites); // Head Sort 마크 제거한다.
	ds_ioFavorites.MoveRow(ds_ioFavorites.currow, ds_ioFavorites.currow + 1);
	ds_ioFavorites.row = ds_ioFavorites.currow + 1;
}

function gdFavorites_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {
    var lobj_Dataset = object(obj.BindDataset);
    // 데이터가 있는 경우 해당 컬럼을 기준으로 정렬한다.
    if (lobj_Dataset.GetRowCount() > 1) {
        if (nCell <> 0) {
            gfn_GridCellSort(obj, nCell); // 해당 셀정렬을 호출한다.
        }
    }
}

function tvMenu_OnDblClick(obj,nRow)
{
	btnAdd_OnClick();
}

function gdFavorites_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	btnDel_OnClick();
}

function btnAdd_OnClick(obj)
{
	if (gfn_IsDuplicatedDataset(ds_ioFavorites, "MMENUID", ds_oMenuTree.GetColumn(ds_oMenuTree.currow, "MMENUID"))) {
        gfn_Alert("이미 등록하신 화면입니다.");
        return false;
	}
    if (gfn_IsNull(ds_oMenuTree.GetColumn(ds_oMenuTree.currow, "MURL"))) {
        gfn_Alert("실행할 수 있는 화면 메뉴가 아닙니다.");
        return false;
    }

    var ln_RowNo = ds_ioFavorites.AddRow();
    ds_ioFavorites.SetColumn(ln_RowNo, "MMENUID", ds_oMenuTree.GetColumn(ds_oMenuTree.currow, "MMENUID"));
    ds_ioFavorites.SetColumn(ln_RowNo, "MMENUNM", ds_oMenuTree.GetColumn(ds_oMenuTree.currow, "MMENUNM"));
}

function btnDel_OnClick(obj)
{
    if (ds_ioFavorites.currow < 0) {
        gfn_Alert(MSGI00030); // 삭제할 레코드가 없습니다.
        return false;
    }

	ds_ioFavorites.DeleteRow(ds_ioFavorites.currow);
}
]]></Script>
</Window>