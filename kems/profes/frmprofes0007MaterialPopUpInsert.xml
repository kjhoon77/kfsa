<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="656" Id="frmprofes0007MaterialPopUpInsert" Left="8" OnLoadCompleted="frmPFM0007MaterialPopUpInsert_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="교안등록&#32;수정" Top="8" Ver="1.0" Width="676" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_TecProg">
				<Contents>
					<colinfo id="TPMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="TPNO" size="256" summ="default" type="STRING"/>
					<colinfo id="TPEDUGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPEDUGUBUNNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="TPCOURS" size="256" summ="default" type="STRING"/>
					<colinfo id="TPCOURSNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSUBJECT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSUBJECTNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPEDUTIME" size="256" summ="default" type="STRING"/>
					<colinfo id="TPREQUSER" size="256" summ="default" type="STRING"/>
					<colinfo id="NAME_DETAIL" size="256" summ="default" type="STRING"/>
					<colinfo id="NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="PROFGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPGOAL" size="256" summ="default" type="STRING"/>
					<colinfo id="TPPLAN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDATA" size="256" summ="default" type="STRING"/>
					<colinfo id="TPCONTENT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPETC" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSTATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="TPUSEDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPOKDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPUSE_YY" size="256" summ="default" type="STRING"/>
					<colinfo id="TPUSE_MM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPUSE_DD" size="256" summ="default" type="STRING"/>
					<colinfo id="TPREQDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="GTDEPTNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPOK_YY" size="256" summ="default" type="STRING"/>
					<colinfo id="TPOK_MM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPOK_DD" size="256" summ="default" type="STRING"/>
					<colinfo id="TPPPT" size="256" summ="default" type="STRING"/>
					<colinfo id="CMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="CGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="CCD" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFSAVENM" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFREALNM" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFFILESIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFDIRPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_TpEduGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>B</CD>
						<DATA>실무교육</DATA>
					</record>
					<record>
						<CD>T</CD>
						<DATA>강습교육</DATA>
					</record>
					<record>
						<CD>3</CD>
						<DATA>기타</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_CmbCours_old">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_CmbSubject">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioTeaching">
				<Contents>
					<colinfo id="TPEDUGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="TPCOURS" size="256" summ="default" type="STRING"/>
					<colinfo id="TPCOURSNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSUBJECT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSUBJECTNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPEDUTIME" size="256" summ="default" type="STRING"/>
					<colinfo id="TPPROFGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPGOAL" size="256" summ="default" type="STRING"/>
					<colinfo id="TPPLAN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDATA" size="256" summ="default" type="STRING"/>
					<colinfo id="TPCONTENT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPETC" size="256" summ="default" type="STRING"/>
					<colinfo id="TPUSEDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPSTATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="TPREQDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDEL" size="256" summ="default" type="STRING"/>
					<colinfo id="TPPPT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPREQUSER" size="256" summ="default" type="STRING"/>
					<colinfo id="TPJIBU" size="256" summ="default" type="STRING"/>
					<colinfo id="TPREQUSERNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TPREGSABUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFSAVENM" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFREALNM" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFFILESIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFDIRPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="BSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="CAFGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="SMGNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_Movie">
				<Contents>
					<colinfo id="TMSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="TMMOVIE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_MovieSingle">
				<Contents>
					<colinfo id="TMSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="TMMOVIE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_TecProgMAX">
				<Contents>
					<colinfo id="TPMGNOMAX" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_CmbCours">
				<Contents>
					<colinfo id="TCCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="TCCOURSENM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_Search">
				<Contents>
					<colinfo id="TCCOURSECDYN" size="256" summ="default" type="STRING"/>
					<colinfo id="TCCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="TCCOURSENM" size="256" summ="default" type="STRING"/>
					<colinfo id="TCSEARCHGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TCMUNJEGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oCourse">
				<Contents>
					<colinfo id="CD" size="2" summ="default" type="STRING"/>
					<colinfo id="DATA" size="30" summ="default" type="STRING"/>
					<colinfo id="PCMGNO" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="PCTCMUNJEGUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="PCTCSEARCHGUBUN" size="1" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oAllCourse">
				<Contents>
					<colinfo id="CD" size="2" summ="default" type="STRING"/>
					<colinfo id="DATA" size="30" summ="default" type="STRING"/>
					<colinfo id="PCMGNO" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="PCTCMUNJEGUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="PCTCSEARCHGUBUN" size="1" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oAllSubject">
				<Contents>
					<colinfo id="CD" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="DATA" size="200" summ="default" type="STRING"/>
					<colinfo id="PSPCMGNO" size="22" summ="default" type="DECIMAL"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oSubject">
				<Contents>
					<colinfo id="CD" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="DATA" size="200" summ="default" type="STRING"/>
					<colinfo id="PSPCMGNO" size="22" summ="default" type="DECIMAL"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oYear">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="640" Height="608" Id="Shape3" Left="0" LineColor="user15" Right="668" TabOrder="24" Top="32" Type="Rectangle" Width="668"></Shape>
		<Static Height="20" Id="lbText" Left="132" Style="sty_Text" TabOrder="12" Text="시간" Top="108" VAlign="Middle" Width="60"></Static>
		<Static Align="Center" Height="52" Id="Static7" Left="8" Style="sty_Label" TabOrder="12" Text="강의목표" Top="132" UserData="S" VAlign="Middle" Width="88"></Static>
		<Shape Bottom="28" Height="28" Id="shpBtnBox" Left="320" LineColor="user14" Right="672" TabOrder="16" Top="0" Type="Rectangle" Width="352"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnCancel" ImageID="BTN_COM_INIT" Left="410" OnClick="lfn_Cancel" Style="sty_Button" TabOrder="14" ToolTipText="입력&#32;초기화" Top="3" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrintScreen" ImageID="BTN_COM_SCREEN" Left="497" OnClick="lfn_PrintScreen" Style="sty_Button" TabOrder="14" ToolTipText="화면&#32;출력" Top="3" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="584" OnClick="lfn_End" Style="sty_Button" TabOrder="15" ToolTipText="닫기" Top="3" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="22" Id="btnSave" ImageID="BTN_COM_SAVE" Left="323" OnClick="lfn_Save" Style="sty_Button" TabOrder="17" ToolTipText="수정&#32;저장" Top="3" Width="85"></Button>
		<Static Align="Center" Height="20" Id="Static2" Left="8" Style="sty_Label" TabOrder="18" Text="강의시간" Top="108" VAlign="Middle" Width="88"></Static>
		<Edit Align="RIGHT" AutoSelect="TRUE" Border="Flat" DisableBKColor="user0" Height="20" Id="edTPEDUTIME" ImeMode="native" Left="100" LeftMargin="2" MaxLength="3" Number="TRUE" Style="sty_Edit" TabOrder="4" Top="108" UserData="S" Width="28"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" DisableBKColor="user4" Enable="FALSE" Height="20" Id="edNAME_DETAIL" ImeMode="native" Left="412" LeftMargin="2" Readonly="TRUE" Style="sty_Edit" TabOrder="5" Top="108" UserData="S" Width="248"></Edit>
		<Static Align="Center" Height="20" Id="Static3" Left="320" Style="sty_Label" TabOrder="19" Text="소속/성명" Top="108" VAlign="Middle" Width="88"></Static>
		<TextArea Border="Flat" DisableBKColor="user0" Height="52" Id="taTPGOAL" Left="100" Style="sty_TextArea" TabOrder="6" Top="132" VScroll="TRUE" Width="568"></TextArea>
		<Static Align="Center" Height="52" Id="Static4" Left="8" Style="sty_Label" TabOrder="20" Text="강의방법" Top="188" UserData="S" VAlign="Middle" Width="88"></Static>
		<TextArea Border="Flat" DisableBKColor="user0" Height="52" Id="taTPPLAN" Left="100" Style="sty_TextArea" TabOrder="7" Top="188" VScroll="TRUE" Width="568"></TextArea>
		<Static Align="Center" Height="52" Id="Static5" Left="8" Style="sty_Label" TabOrder="21" Text="강의자료/&#13;&#10;활용기자재" Top="244" UserData="S" VAlign="Middle" Width="88"></Static>
		<TextArea Border="Flat" DisableBKColor="user0" Height="52" Id="taTPDATA" Left="100" Style="sty_TextArea" TabOrder="8" Top="244" VScroll="TRUE" Width="568"></TextArea>
		<TextArea Border="Flat" DisableBKColor="user0" Height="80" Id="taTPCONTENT" Left="100" Style="sty_TextArea" TabOrder="9" Top="300" VScroll="TRUE" Width="568"></TextArea>
		<Static Align="Center" Height="80" Id="Static6" Left="8" Style="sty_Label" TabOrder="22" Text="주&#32;&#32;&#32;&#32;요&#13;&#10;강의내용" Top="300" UserData="S" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="52" Id="Static8" Left="8" Style="sty_Label" TabOrder="23" Text="비고&#13;&#10;(강의자료관련)" Top="384" UserData="S" VAlign="Middle" Width="88"></Static>
		<TextArea Border="Flat" DisableBKColor="user0" Height="52" Id="taTPETC" Left="100" Style="sty_TextArea" TabOrder="10" Top="384" VScroll="TRUE" Width="568"></TextArea>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edTPMGNO" ImeMode="native" Left="96" LeftMargin="2" Style="sty_Edit" TabOrder="25" Top="32" UserData="S" Visible="FALSE" Width="56"></Edit>
		<Static Align="Center" Height="20" Id="Static9" Left="8" Style="sty_Label" TabOrder="26" Text="교안&#32;첨부파일" Top="440" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="Static12" Left="8" Style="sty_Label" TabOrder="27" Text="교안&#32;동영상1" Top="464" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="Static0" Left="182" Style="sty_Label" TabOrder="28" Text="교육구분" Top="60" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="Static1" Left="354" Style="sty_Label" TabOrder="29" Text="교육과정" Top="60" VAlign="Middle" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxCours" INDEX="0" InnerDataset="ds_oCourse" Left="447" OnChanged="cbxCours_OnChanged" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="30" Top="59" UserData="I" Width="217"></Combo>
		<Static Align="Center" Height="20" Id="Static10" Left="9" Style="sty_Label" TabOrder="31" Text="강의명" Top="84" VAlign="Middle" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxTpEduGubun" ImeMode="native" INDEX="0" InnerDataset="ds_TpEduGubun" Left="273" OnChanged="cbxTpEduGubun_OnChanged" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="1" Top="59" UserData="I" Width="77"></Combo>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxSubject" INDEX="0" InnerDataset="ds_oSubject" Left="101" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="32" Top="83" UserData="I" Width="561"></Combo>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edCours" ImeMode="native" Left="446" LeftMargin="2" MaxLength="10" Style="sty_Edit" TabOrder="2" Top="60" UserData="S" Width="200"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edSubject" ImeMode="native" Left="101" LeftMargin="2" MaxLength="10" Style="sty_Edit" TabOrder="3" Top="84" UserData="S" Width="542"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnButton" ImageID="BTN_TEXT_15" Left="100" OnClick="btnButton_OnClick" Style="sty_Button" TabOrder="33" Text="교안&#32;동영상&#32;작성&#32;도움말" Top="465" Transparent="TRUE" Width="209"></Button>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edInsUpdateFalg" ImeMode="native" Left="184" LeftMargin="2" Style="sty_Edit" TabOrder="60" Top="32" UserData="S" Visible="FALSE" Width="56"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnAdd" ImageID="BTN_TEXT_03" Left="554" OnClick="btnAdd_OnClick" Style="sty_Button" TabOrder="36" Text="행&#32;추가" Top="465" Transparent="TRUE" Width="52"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnDel" ImageID="BTN_TEXT_03" Left="608" OnClick="btnDel_OnClick" Style="sty_Button" TabOrder="37" Text="행&#32;삭제" Top="465" Transparent="TRUE" Width="52"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_Movie" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="632" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="142" Id="gdProfSeminar" InputPanel="FALSE" Left="12" LineColor="default" MinWidth="100" OnHeadClick="gdProfSeminar_OnHeadClick" Right="662" RowHeight="20" Style="sty_Grid" TabOrder="35" TabStop="true" Top="490" UseDBuff="true" UsePopupMenu="true" UserData="학술&#32;및&#32;세미나발표목록" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="650">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="607"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" text="순번"/>
						<cell align="center" col="1" display="text" text="경로"/>
					</head>
					<body>
						<cell align="center" col="0" display="text" expr="currow+1"/>
						<cell align="left" col="1" colid="TMMOVIE" display="text" edit="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Font="굴림,12,Bold" Height="20" Id="lbProcMsg1" Left="44" Style="sty_Text" TabOrder="41" Text="교안등록&#32;수정" Top="8" VAlign="Middle" Width="180"></Static>
		<File Bottom="481" Height="24" Id="fiAttachFile" Left="184" Right="208" TabOrder="42" Top="457" Width="24"></File>
		<FileDialog Bottom="481" Height="24" Id="fdAttachFile" Left="214" Right="238" TabOrder="41" Top="457" Width="24"></FileDialog>
		<HttpFile Height="24" Id="hfAttachFile" Left="244" Top="457" Width="24"></HttpFile>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnUploadFile" ImageID="BTN_TEXT_04" Left="471" OnClick="btnUploadFile_OnClick" Style="sty_Button" TabOrder="40" Text="업로드" ToolTipText="다운로드" Top="440" Transparent="TRUE" Width="66"></Button>
		<Edit AutoSelect="TRUE" BKColor="user4" Border="Flat" Cursor="HAND" Height="20" Id="edAttachFile" ImeMode="native" Left="100" LeftMargin="2" OnClick="lfn_DownloadFile" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_EditReadOnly" TabOrder="39" TabStop="FALSE" Top="441" UserData="S" Width="368"></Edit>
		<Static Height="20" Id="lbFileSize" Left="540" Style="sty_Text" TabOrder="41" Top="441" UserData="S" VAlign="Middle" Width="116"></Static>
		<Static Align="Center" Height="20" Id="lbJibu" Left="10" Style="sty_Label" TabOrder="43" Text="년도" Top="60" VAlign="Middle" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Height="20" Id="cbxYear" ImeMode="none" INDEX="0" InnerDataset="ds_oYear" Left="101" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="42" Top="59" UserData="I" Width="77"></Combo>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : 
 * 설명 : 
 * 작성일 : 
 * 작성자 : 
 */

#include "LIB::profes.js"; // 공통업무 관련

var G_TPMGNO;
var G_TPSTATUS;
var G_TPMGNOMAX;

var lb_FileUpload = false;
var ls_FileUploadPath = "/TEACHPLAN"; //교수관리니까
var ls_UploadFileName = "TEACHPLAN"; //서버에 저장될 파일 명(이력서)
var ls_CAFGUBUN       = "T"; //구분자를 교안관리대장은 T로 한다.
var ls_BoardGubun = "N";
var ls_RealFileName = "";




function frmPFM0007MaterialPopUpInsert_OnLoadCompleted(obj)
{	
	gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
       
    // 폼 환경설정
    ls_SystemGubun = gs_SystemGubun;
    ls_SystemMenuId = gs_SystemMenuId;
    var ls_FormId = split(sFormUrl, "::");
    ls_FormId = split(ls_FormId[1], ".");
    //obj.Title = sFormTitle + "(" + ls_FormId[0] + ")";

    gfn_MakeRequiredInputMark(this); // 필수 입력란을 설정한다.

    ms_FormAuth = gfn_GetFormAuth(this); // 권한을 조회한다.
    //alert("ms_FormAuth:"+ms_FormAuth);
    G_AUTH = ms_FormAuth;
    
    if (ms_FormAuth == "W") { // 권한에 따른 버튼 설정
        lfn_SetFormAuth(true); // 저장 권한
        //btnSave.Enable = true;
    } else if (ms_FormAuth == "R") {
        lfn_SetFormAuth(false); // 읽기 권한
    } else {
        gfn_Alert(MSGI00080);
        close();
    }
    
    // 공통 코드 조회
    
    var strYear = left(GetDate(), 4);
    strYear = ToNumber(strYear);
    ds_oYear.AddRow(); ds_oYear.SetColumn(0, "CD", strYear);   ds_oYear.SetColumn(0, "DATA", strYear); 
    
    ds_oYear.AddRow(); ds_oYear.SetColumn(1, "CD", strYear-1); ds_oYear.SetColumn(1, "DATA", strYear-1);
    
    ds_oYear.AddRow(); ds_oYear.SetColumn(2, "CD", strYear-2); ds_oYear.SetColumn(2, "DATA", strYear-2);
    
        
    lfn_SearchProfesCourseCode();	//교수관리 직능 조회
    lfn_SearchProfesSubjectCode();	//교수관리 과목 조회
    lfn_FilterProfesCourseCode(cbxTpEduGubun.Value, ds_oCourse);	//교수관리 직능 필터링
    cbxCours.Index = 0;
    lfn_FilterProfesSubjectCode(ds_oCourse.GetColumn(ds_oCourse.FindRow("DATA", cbxCours.Text), "PCMGNO"), ds_oSubject);	//교수관리 과목 필터링
    cbxSubject.Index = 0;
    
    //교안작성시 [소속/성명]은 작성자의 소속성명이 default로 나오게 한다.
    if (InsUpdateFalg == "작성") {
        edNAME_DETAIL.Text = PGTMGNO_NM +"  "+ PNM ;
    }
    
    
    G_TPMGNO = TPMGNO;
    edTPMGNO.Text = TPMGNO;
    edInsUpdateFalg.Text = InsUpdateFalg; 
    G_TPSTATUS = TPSTATUS;
    
    if (InsUpdateFalg == "수정") {
        btnSearch_OnClick();
        Search_Movie();//교안동영상 조회한다.
    }else if (InsUpdateFalg == "작성"){
        cbxTpEduGubun_OnChanged();
    }
    

}

/*
 * 기능 : 교수관리 직능 조회
 */
function lfn_SearchProfesCourseCode(obj) {
	
	tit_clearActionInfo();
	tit_addCsvSearchActionInfo("profes:searchProfesCourseCode", false);
	
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_oAllCourse=ds_oPFCourse"	// outDs
		,""	// args
		,""
		,true
		,true
		,true
	);
}

/*
 * 기능 : 교수관리 과목 조회
 */
function lfn_SearchProfesSubjectCode(obj) {
	
	tit_clearActionInfo();
	tit_addCsvSearchActionInfo("profes:searchProfesSubjectCode", false);
	
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_oAllSubject=ds_oPFSubject"	// outDs
		,""	// args
		,""
		,true
		,true
		,true
	);
}

/*
 * 기능 : 교수관리 직능 필터링
 * parameter : sSearchGubun - 조회구분(그룹직능코드)
 *             objDataset - 리턴받을 데이타셋
 *             sOpt - "전체" 또는 "선택" 또는 " " 포함여부
 */
function lfn_FilterProfesCourseCode(sSearchGubun, objDataset, sOpt) {
	objDataset.ClearData();

    var nRow = -1;
    var ls_FilterExpr = "";
    if (!gfn_IsNull(sSearchGubun)) {
        ls_FilterExpr += "PCTCSEARCHGUBUN=='" + trim(sSearchGubun) + "'";
    }
    
	ds_oAllCourse.Filter(ls_FilterExpr);
	
    for (var i = 0; i < ds_oAllCourse.GetCount(); i++) {
        nRow = objDataset.AddRow();
        objDataset.SetColumn(nRow, "CD", ds_oAllCourse.GetColumn(i, "CD"));
        objDataset.SetColumn(nRow, "DATA", ds_oAllCourse.GetColumn(i, "DATA"));
        objDataset.SetColumn(nRow, "PCMGNO", ds_oAllCourse.GetColumn(i, "PCMGNO"));
		objDataset.SetColumn(nRow, "PCTCMUNJEGUBUN", ds_oAllCourse.GetColumn(i, "PCTCMUNJEGUBUN"));
		objDataset.SetColumn(nRow, "PCTCSEARCHGUBUN", ds_oAllCourse.GetColumn(i, "PCTCSEARCHGUBUN"));
    }

    if (length(sOpt) > 0) {
        objDataset.InsertRow(0);
        objDataset.SetColumn(0, "CD", "");
        objDataset.SetColumn(0, "DATA", sOpt);
        objDataset.SetColumn(0, "PCMGNO", "");
		objDataset.SetColumn(0, "PCTCMUNJEGUBUN", "");
		objDataset.SetColumn(0, "PCTCSEARCHGUBUN", "");
    }
    objDataset.row = 0;

    ds_oAllCourse.UnFilter();
}

/*
 * 기능 : 교수관리 과목 필터링
 * parameter : sSearchGubun - 조회구분(그룹과목관리번호)
 *             objDataset - 리턴받을 데이타셋
 *             sOpt - "전체" 또는 "선택" 또는 " " 포함여부
 */
function lfn_FilterProfesSubjectCode(sSearchGubun, objDataset, sOpt) {
	objDataset.ClearData();

    var nRow = -1;
    var ls_FilterExpr = "";
    if (!gfn_IsNull(sSearchGubun)) {
        ls_FilterExpr += "PSPCMGNO=='" + trim(sSearchGubun) + "'";
    }
    
	ds_oAllSubject.Filter(ls_FilterExpr);
	
    for (var i = 0; i < ds_oAllSubject.GetCount(); i++) {
        nRow = objDataset.AddRow();
        objDataset.SetColumn(nRow, "CD", ds_oAllSubject.GetColumn(i, "CD"));
        objDataset.SetColumn(nRow, "DATA", ds_oAllSubject.GetColumn(i, "DATA"));
        objDataset.SetColumn(nRow, "PSPCMGNO", ds_oAllSubject.GetColumn(i, "PSPCMGNO"));
    }

    if (length(sOpt) > 0) {
        objDataset.InsertRow(0);
        objDataset.SetColumn(0, "CD", "");
        objDataset.SetColumn(0, "DATA", sOpt);
        objDataset.SetColumn(0, "PSPCMGNO", "");
    }
    objDataset.row = 0;

    ds_oAllSubject.UnFilter();
}

/*--------------------------------------------------------
 *  교육구분 콤보가 바뀔경우 교육과정 콤보를 체운다.
 *--------------------------------------------------------*/
function cbxTpEduGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
    if (strCode == "3") { //교육구분이 기타이면 text입력 처리
        cbxCours.Visible   = false;
        cbxSubject.Visible = false;
        edCours.Visible    = true;
        edSubject.Visible  = true;
        
        edCours.text    = "";
        edSubject.text  = "";

    } else {
        cbxCours.Visible   = true;
        cbxSubject.Visible = true;
        edCours.Visible    = false;
        edSubject.Visible  = false;
    	
		lfn_FilterProfesCourseCode(cbxTpEduGubun.Value, ds_oCourse);
		cbxCours.Index = 0;
		lfn_FilterProfesSubjectCode(ds_oCourse.GetColumn(ds_oCourse.FindRow("DATA", cbxCours.Text), "PCMGNO"), ds_oSubject);
		cbxSubject.Index = 0;
	}
}

/*--------------------------------------------------------
 *  교육과정 콤보가 바뀔경우 강의명을 체운다.
 *--------------------------------------------------------*/
function cbxCours_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	lfn_FilterProfesSubjectCode(ds_oCourse.GetColumn(ds_oCourse.FindRow("DATA", strText), "PCMGNO"), ds_oSubject);
	cbxSubject.Index = 0;
}

/*--------------------------------------------------------*
 *  조회 시                                               *
 *--------------------------------------------------------*/
function btnSearch_OnClick(obj)
{

	ds_TecProg.ClearData(); // 데이타셋 초기화
	tit_clearActionInfo();
	
	
	tit_addSearchActionInfo("profes:searchPFM0007PopUp", false);  
		                        
	var sParm = "";
	sParm  = " TPMGNO=" + quote(G_TPMGNO);   
	 
	//alert("조회1111:"+sParm);
	// 서버 호출
	tit_callService( ""
		            ,""
		            ,""	// inDs
		            ,"ds_TecProg=ds_oTecProg" // outDs
		            ,sParm
		            ,"lfn_AfterSearchProfFirst"
		            ,false
		            ,false
		            ,true     );	
		                        
		                        
}
function lfn_AfterSearchProfFirst(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    
    if (ds_TecProg.rowcount <> 1) {
        alert("확인요망");
        return false;
    }
    
    edTPNO.Text         = ds_TecProg.GetColumn(0, "TPNO");
	edTPREQDATE.Text    = ds_TecProg.GetColumn(0, "TPREQDATE");
	//cbxTpEduGubun.Value = ds_TecProg.GetColumn(0, "TPEDUGUBUN");//교육구분콤보
	
	switch(ds_TecProg.GetColumn(0, "TPEDUGUBUN"))
	{
		case 1 :	//실무
			cbxTpEduGubun.Value = "B";
		break;
		case 2 :	//강습
			cbxTpEduGubun.Value = "T";
		break;
		default :	//실무
			cbxTpEduGubun.Value = ds_TecProg.GetColumn(0, "TPEDUGUBUN");
		break;
	}
	
    if (cbxTpEduGubun.Value == 3) { //교육구분이 기타이면 text입력 처리
        cbxCours.Visible   = false;
        cbxSubject.Visible = false;
        edCours.Visible    = true;
        edSubject.Visible  = true;
    } else {
        cbxCours.Visible   = true;
        cbxSubject.Visible = true;
        edCours.Visible    = false;
        edSubject.Visible  = false;
        
        lfn_FilterProfesCourseCode(cbxTpEduGubun.Value, ds_oCourse);
	}
	cbxCours.Value      = ds_oCourse.GetColumn(ds_oCourse.FindRow("PCMGNO", ds_TecProg.GetColumn(0, "TPCOURS")), "CD"); //교육과정
	//cbxCours.Value      = ds_TecProg.GetColumn(0, "TPCOURS");//교육과정
	lfn_FilterProfesSubjectCode(ds_oCourse.GetColumn(ds_oCourse.FindRow("DATA", cbxCours.Text), "PCMGNO"), ds_oSubject);
	
	edCours.Text        = ds_TecProg.GetColumn(0, "TPCOURSNM");//교육과정 한글명
	cbxSubject.Value    = ds_TecProg.GetColumn(0, "TPSUBJECT");//강의명 아이디
	edSubject.Text      = ds_TecProg.GetColumn(0, "TPSUBJECTNM");
	edTPEDUTIME.Text    = ds_TecProg.GetColumn(0, "TPEDUTIME");
	edNAME_DETAIL.Text  = ds_TecProg.GetColumn(0, "NAME_DETAIL");
	taTPGOAL.Text       = ds_TecProg.GetColumn(0, "TPGOAL");
	taTPPLAN.Text       = ds_TecProg.GetColumn(0, "TPPLAN");
	taTPDATA.Text       = ds_TecProg.GetColumn(0, "TPDATA");
	taTPCONTENT.Text    = ds_TecProg.GetColumn(0, "TPCONTENT");
	taTPETC.Text        = ds_TecProg.GetColumn(0, "TPETC");
	edAttachFile.Text   = ds_TecProg.GetColumn(0, "TPPPT");
	edTPOKDATE.Text     = ds_TecProg.GetColumn(0, "TPOKDATE");
	edTPUSEDATE.Text    = ds_TecProg.GetColumn(0, "TPUSEDATE");
	
	edTPYEAR.Text       = ds_TecProg.GetColumn(0, "TPYEAR");
	edTPSEQ.Text        = ds_TecProg.GetColumn(0, "TPSEQ");
	
	calUseDate.Value    = ds_TecProg.GetColumn(0, "CAL_TPUSEDATE");
	calOKDate.Value     = ds_TecProg.GetColumn(0, "CAL_TPOKDATE");


    ls_RealFileName      = ds_TecProg.GetColumn(0, "TPPPT"); //교안 첨부파일
    
    
    if(length(ls_RealFileName) >= 1) {
            lbFileSize.text = NumFormat(obj.GetColumn(nRow, "AFFILESIZE")) + " Byte";
    } else {
            lbFileSize.text = "";
    }
        
    lb_FileUpload = false;
	lfn_FileDownCheck();    
    
    
    
}


/*--------------------------------------------------------*
 *  교안동영상 조회                                       *
 *--------------------------------------------------------*/
function Search_Movie()
{

	ds_Movie.ClearData(); // 데이타셋 초기화
	tit_clearActionInfo();
	tit_addSearchActionInfo("profes:searchPFM0007PopUpMovie", false);  
      
	var sParm = "";
	sParm  = " TPMGNO=" + quote(edTPMGNO.Text);   
	//sParm  = " TPMGNO=" + quote("630");   
	tit_callService( ""
		            ,""
		            ,""	// inDs
		            ,"ds_Movie=ds_oMovie" // outDs
		            ,sParm
		            ,"lfn_AfterSearchProfMovie"
		            ,false
		            ,false
		            ,true     );		                        
}
function lfn_AfterSearchProfMovie(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    
	//var rowCnt  = ds_Movie.GetRowCount();
	//for(var i =0; i < rowCnt; i++){
	//	edMove0 = trim(ds_Movie.getColumn(i,"TMMOVIE"));
	//}    
}


/*---------------------------------------------------
 * 기능 : 행추가
 *---------------------------------------------------*/
 function btnAdd_OnClick(obj) {
	ds_Movie.AddRow(); // Dataset에 빈 Record한줄 추가
	ds_Movie.SetColumn(ds_Movie.currow, "TMMOVIE", "웹하드시스템:공유폴더/kfsa/" );
}

/*------------------------------------------------------
 * 기능 : 행삭제
 *-------------------------------------------------------*/
function btnDel_OnClick(obj) {
	ds_Movie.DeleteRow(ds_Movie.currow); // Dataset에 한줄 삭제
}

/*------------------------------------------------------
 * 기능 : 교안동영상 입력/수정/삭제 처리
 *-------------------------------------------------------*/
function lfn_SaveMovie(obj) {
	
	for (var j=0; j<ds_Movie.GetRowCount(); j++) {
		if (ds_Movie.GetRowType(j) == "insert") {
			ds_MovieSingle.AddRow();
			ds_MovieSingle.CopyRow(ds_MovieSingle.row, ds_Movie, j);
			lfn_InsMovie(); //
			ds_MovieSingle.ClearData();
		}
    }
	
	tit_clearActionInfo();
    tit_AddSaveActionInfo(	
          "" // insert  		
        , "profes:updatePFM0007Movie" // update  
        , "profes:deletePFM0007Movie" // delete
        , "" // flag column 명
        , "" // key sql id
        , 0	// key 증가 값
        , "" 
        , 0 
        , "N" // 실행타입
    );
	
	var sParm = "";
	if (Length(trim(G_TPMGNO)) != 0) {
	    sParm  = " G_TPMGNOMAX=" + quote(G_TPMGNO); //수정에서 넘어왔다.
	} else {
	    sParm  = " G_TPMGNOMAX=" + quote(G_TPMGNOMAX); //신규 등록이면 
	}	
	
	//alert("동영상저장시(수정/삭제):"+sParm);
	 // 서버 호출 
    tit_callService(
         ""
        ,""
        ,"ds_iMovie=ds_Movie:U" // inDs		
        ,""	// outDs
        ,sParm 
        ,"lfn_AfterSaveMovie"
        ,false
        ,false
		,true
    );
}
function lfn_AfterSaveMovie(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    gfn_SaveMessage(); // 저장 메세지를 처리한다.
    close();
}


/*------------------------------------------------------
 * 기능 : 교안동영상 입력/수정/삭제 처리  Single
 *-------------------------------------------------------*/
function lfn_InsMovie(obj) {

	tit_clearActionInfo();
    tit_AddSingleActionInfo("profes:insertPFM0007Movie" , "", 0, "", "N");
    
    
	var sParm = "";
	if (Length(trim(G_TPMGNO)) != 0) {
	    sParm  = " G_TPMGNOMAX=" + quote(G_TPMGNO); //수정에서 넘어왔다.
	} else {
	    sParm  = " G_TPMGNOMAX=" + quote(G_TPMGNOMAX); //신규 등록이면 
	}
	
	//alert("동영상추가시:"+sParm);
	 // 서버 호출 
    tit_callService(
         ""
        ,""
        ,"ds_iMovie=ds_MovieSingle:A" // inDs		
        ,""	// outDs
        ,sParm 
        ,"lfn_AfterSaveMovieSingle"
        ,false
        ,false
		,true
    );
}
function lfn_AfterSaveMovieSingle(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
}




/*--------------------------------------------------------*
 *  저장버튼 선택 시                                      *
 *--------------------------------------------------------*/
function lfn_Save(obj)
{

    
    if (Length(trim(edTPEDUTIME.Text)) == 0) {
        alert("강의시간을 입력하세요.");
        edTPEDUTIME.SetFocus(); 
        return false;
    //} else if (Length(trim(edNAME_DETAIL.Text)) == 0) {
    //    alert("소속/성명을 입력하세요.");
    //    edNAME_DETAIL.SetFocus(); 
    //    return false;
    } else if (Length(trim(taTPGOAL.Text)) == 0) {
        alert("강의목표를 입력하세요.");
        taTPGOAL.SetFocus(); 
        return false;    
    } else if (Length(trim(taTPPLAN.Text)) == 0) {
        alert("강의방법을 입력하세요.");
        taTPPLAN.SetFocus(); 
        return false;   
    } else if (Length(trim(taTPDATA.Text)) == 0) {
        alert("강의자료/활용기자재를 입력하세요.");
        taTPDATA.SetFocus(); 
        return false;   
    } else if (Length(trim(taTPCONTENT.Text)) == 0) {
        alert("주요강의내용을 입력하세요.");
        taTPCONTENT.SetFocus(); 
        return false;   
    }
     
    //alert(edInsUpdateFalg.Text);
    //return false;

    if (edInsUpdateFalg.Text == "수정") {
        lfn_Update();
        lfn_SaveMovie();
        Parent.btnSearch_OnClick();
        Parent.Search_Movie();       
    } else if (edInsUpdateFalg.Text == "작성"){
        lfn_SearchTeachMAX();//동영상넣을때 teachingplan 테이블 관리번호(max) 필요해서
        lfn_Insert();
        lfn_SaveMovie();    
        Parent.lfn_Search();
    }
    close();
}

/*--------------------------------------------------------*
 *  저장시 데이터셋을 셋팅한다.                           *
 *--------------------------------------------------------*/
 function lfn_DatasetSetting(){

    // 입력된 값을 그리드로 복사한다.
    ds_ioTeaching.InsertRow(0);
    ds_ioTeaching.SetColumn(0, "TPEDUGUBUN", cbxTpEduGubun.Value);//교육구분
    ds_ioTeaching.SetColumn(0, "TPYEAR", cbxYear.Value );//작성년도
    ds_ioTeaching.SetColumn(0, "TPREQUSER", gds_oUserInfo.GetColumn(0, "PSABUN"));//작성자사번
    //ds_ioTeaching.SetColumn(0, "TPCOURS", cbxCours.Value);//과정코드
    ds_ioTeaching.SetColumn(0, "TPCOURS", ds_oCourse.GetColumn(ds_oCourse.FindRow("DATA", cbxCours.Text), "PCMGNO"));//과정코드
    
    if (cbxTpEduGubun.Value <> "3") {
        ds_ioTeaching.SetColumn(0, "TPCOURSNM", cbxCours.Text);//과정명칭
    }else{
        ds_ioTeaching.SetColumn(0, "TPCOURSNM", edCours.Text);//과정명칭
        ds_ioTeaching.SetColumn(0, "TPCOURS",   "99");//기타를 나태내는 임의코드
    }
    
        
    ds_ioTeaching.SetColumn(0, "TPSUBJECT", cbxSubject.Value);//과목코드
    
    if (cbxTpEduGubun.Value <> "3") {
        ds_ioTeaching.SetColumn(0, "TPSUBJECTNM", cbxSubject.Text);//과목명칭
    } else {
        ds_ioTeaching.SetColumn(0, "TPSUBJECTNM", edSubject.Text);//과목명칭
        ds_ioTeaching.SetColumn(0, "TPSUBJECT", "99");//기타를 나태내는 임의코드
    }
    
    ds_ioTeaching.SetColumn(0, "TPEDUTIME", edTPEDUTIME.Text);//교육시간
    ds_ioTeaching.SetColumn(0, "TPPROFGUBUN", "");//강사구분(확인필요)
    ds_ioTeaching.SetColumn(0, "TPJIBU", gds_oUserInfo.GetColumn(0, "PDEPTCD"));//지부코드(작성당시의 지부)
    ds_ioTeaching.SetColumn(0, "TPGOAL", taTPGOAL.Text);//강의목표
    ds_ioTeaching.SetColumn(0, "TPPLAN", taTPPLAN.Text);//강의방법
    ds_ioTeaching.SetColumn(0, "TPDATA", taTPDATA.Text);//강의자료
    ds_ioTeaching.SetColumn(0, "TPCONTENT", taTPCONTENT.Text);//강의내용
    ds_ioTeaching.SetColumn(0, "TPETC", taTPETC.Text);//비고
    ds_ioTeaching.SetColumn(0, "TPUSEDATE", "");//유효기간(확인필요)
    
    //alert("G_TPSTATUS:"+G_TPSTATUS);
    
    if (Length(trim(G_TPSTATUS)) == 0) {
        ds_ioTeaching.SetColumn(0, "TPSTATUS", "1");       //신규
    } else {
        ds_ioTeaching.SetColumn(0, "TPSTATUS", G_TPSTATUS);//수정
    }
    
    ds_ioTeaching.SetColumn(0, "TPREQUSERNM", gds_oUserInfo.GetColumn(0, "PPERSONNM"));//작성자 성명(확인필요)
    ds_ioTeaching.SetColumn(0, "TPDEL", "");//
    ds_ioTeaching.SetColumn(0, "TPPPT", edAttachFile.Text);//강의계획서
                        
    ds_ioTeaching.SetColumn(0, "TPREGSABUN", gds_oUserInfo.GetColumn(0, "PSABUN")); //로그인한 사번
    ds_ioTeaching.SetColumn(0, "TPMGNO", edTPMGNO.Text);//
    ds_ioTeaching.SetColumn(0, "SMGNO", edTPMGNO.Text);//첨부파일때문에 추가
    
    ds_ioTeaching.SetColumn(0, "CAFSAVENM"  , ds_TecProg.GetColumn(0, "CAFSAVENM"));//
    ds_ioTeaching.SetColumn(0, "CAFREALNM"  , ds_TecProg.GetColumn(0, "CAFREALNM"));//
    ds_ioTeaching.SetColumn(0, "CAFFILESIZE", ds_TecProg.GetColumn(0, "CAFFILESIZE"));//
    ds_ioTeaching.SetColumn(0, "CAFDIRPATH" , ds_TecProg.GetColumn(0, "CAFDIRPATH"));//
    ds_ioTeaching.SetColumn(0, "CAFGUBUN"   , ds_TecProg.GetColumn(0, "CAFGUBUN"));//
    
    

}

/*========================================================*
 *  저장(입력)버튼 선택 시  MAX값을 구해온다.             *
 *========================================================*/
function lfn_SearchTeachMAX(obj){

    if (!gfn_Confirm(MSGW00020)) { // 정말로 추가 저장 하시겠습니까?
        return false;
    }
            
	ds_TecProgMAX.ClearData(); // 데이타셋 초기화
	tit_clearActionInfo();
	tit_addSearchActionInfo("profes:searchPFM0007SelMAX", false);  
		                        
	// 서버 호출
	tit_callService( ""
		            ,""
		            ,""	// inDs
		            ,"ds_TecProgMAX=ds_oTecProgMAX" // outDs
		            ,""
		            ,"lfn_AfterInsertMAX"
		            ,false
		            ,false
		            ,true     );	
		                        
	
}
function lfn_AfterInsertMAX(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    G_TPMGNOMAX = ds_TecProgMAX.GetColumn(0, "TPMGNOMAX");
    //alert("G_TPMGNOMAX_new:"+G_TPMGNOMAX);
}




/*
	ds_TecProg.ClearData(); // 데이타셋 초기화
	tit_clearActionInfo();
	
	
	tit_addSearchActionInfo("profes:searchPFM0007PopUp", false);  
		                        
	var sParm = "";
	sParm  = " TPMGNO=" + quote(edTPMGNO.Text);   
	//alert(sParm);
	// 서버 호출
	tit_callService( ""
		            ,""
		            ,""	// inDs
		            ,"ds_TecProg=ds_oTecProg" // outDs
		            ,sParm
		            ,"lfn_AfterSearchProfFirst"
		            ,false
		            ,false
		            ,true     );	

*/






/*========================================================*
 *  저장(입력)버튼 선택 시                                *
 *========================================================*/
function lfn_Insert(obj){

    var ls_FileUploadService = ""; //파일 업로드일 경우 사용되는 변수
    var ls_UploadRealName = "";


    lfn_DatasetSetting();
    
    ds_ioTeaching.SetColumn(0, "SMGNO", G_TPMGNOMAX);//첨부파일때문에 추가  
   
    gfn_FormInit(this); // 입력란 초기화
    
    
    //기타를 넣을 경우 과정코드 과목코드에 기타를 의미하는 99를 넣는다.
    if(cbxTpEduGubun.Value == 3) {
        ds_ioTeaching.SetColumn(0, "TPCOURS",   "99");
        ds_ioTeaching.SetColumn(0, "TPSUBJECT", "99");    
    }
    
    tit_clearActionInfo();
    tit_addSaveActionInfo(
        "profes:insertPFM0007TeachingPlan"	// insert
        , ""	// update
        , ""	// delete
        , ""	// flag column 명
        , ""	// key sql id
        , 0	// key 증가 값
        , "" 
        , 0 
        , "N"  );
 
        
    if(lb_FileUpload) { //파일 업로드일 경우
        ls_UploadRealName = ls_UploadFileName + "_" + getDate() + right(timem(),3) + gfn_GetFileExtensionName(fdAttachFile.FileName);
        
        //ds_ioTeaching.SetColumn(0, "TPPPT", fdAttachFile.FileName);
        //ds_ioTeaching.SetColumn(0, "AFSAVENM", fdAttachFile.FileName);      //차트모양.pptx
        //ds_ioTeaching.SetColumn(0, "AFREALNM", ls_UploadRealName);          //NOTIS_20091120145487.pptx
        //ds_ioTeaching.SetColumn(0, "AFFILESIZE", StripNum(lbFileSize.text));//681234
        //ds_ioTeaching.SetColumn(0, "AFDIRPATH", ls_FileUploadPath);         //MATERAL
        

        ds_ioTeaching.SetColumn(0, "TPPPT"      , fdAttachFile.FileName);  
        ds_ioTeaching.SetColumn(0, "CAFSAVENM"  , fdAttachFile.FileName);      //차트모양.pptx
        ds_ioTeaching.SetColumn(0, "CAFREALNM"  , ls_UploadRealName);          //NOTIS_20091120145487.pptx
        ds_ioTeaching.SetColumn(0, "CAFFILESIZE", StripNum(lbFileSize.text));  //681234
        ds_ioTeaching.SetColumn(0, "CAFDIRPATH" , ls_FileUploadPath);          //MATERAL
        ds_ioTeaching.SetColumn(0, "CAFGUBUN" , ls_CAFGUBUN);                  //profes
        
        
        
        
        tit_addSaveActionInfo(
            "profes:insertCustAttachFile" // insert
            , "" // update
            , "" // delete
            , "" // flag column 명
            , "" // key sql id
            , 0	// key 증가 값
            , "" 
            , 0 
            , "N" // 실행타입
        );
        
        ls_FileUploadService = " ds_iAttachFile=ds_ioTeaching:U";
        
    }        

    //gfn_FormInit(this); // 입력란 초기화
       
    var sParm = "";
	sParm  = " G_TPMGNOMAX=" + quote(G_TPMGNOMAX);   
    tit_callService(
         ""
        ,""
        ,"ds_iTeaching=ds_ioTeaching:U"	+ ls_FileUploadService    // inDs
        ,""	// outDs
        ,sParm	// args 
        ,"lfn_AfterInsertTrainingOrder"
        ,false  );	
        
 /*       
alert("lb_FileUpload = "+lb_FileUpload                       //  
  + " \n Length(FileName) = "+Length(fdAttachFile.FileName)  //  
  + " \n ls_FileUploadPath = "+ls_FileUploadPath         //  /RESUME
  + " \n fdAttachFile.FilePath = "+fdAttachFile.FilePath //  D:\노트북백업20090822
  + " \n fdAttachFile.FileName = "+fdAttachFile.FileName //  쿼리.txt
  + " \n ls_UploadRealName = "+ls_UploadRealName);       //  RESUME_20091208205017890.txt
*/
    //alert("lb_FileUpload:"+lb_FileUpload);  
      
    if (lb_FileUpload) { //파일 변경일 경우
        //alert("bbbbbb");
        if (Length(fdAttachFile.FileName) < 1) { //삭제 일 경우
            tit_FileDelete( ls_FileUploadPath
                          , ls_RealFileName
                          , false
                          );
        } else { //변경일 경우
            //alert("tit_FileWrite를 샐행한다.");
            tit_FileWrite( hfAttachFile
                         , ls_FileUploadPath
                         , fdAttachFile.FilePath
                         , fdAttachFile.FileName
                         , ls_UploadRealName
                         , "U"
                         , ls_RealFileName
                         );
            hfAttachFile.CloseFile();
        }
    }
    mb_IsNewData = false;        
}
function lfn_AfterInsertTrainingOrder(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    //lb_FileUpload = false; //업로드 구분을 해지시킨다.
}


/*--------------------------------------------------------*
 *  저장(수정)버튼 선택 시                                *
 *--------------------------------------------------------*/
function lfn_Update(obj){

    var ls_FileUploadService = ""; //파일 업로드일 경우 사용되는 변수
    var ls_UploadRealName = "";


    if (!gfn_Confirm(MSGW00020)) { // 정말로 추가 저장 하시겠습니까?
        return false;
    }
    //alert("수정처리");
            
    lfn_DatasetSetting();

    //gfn_FormInit(this); // 입력란 초기화
    
    tit_clearActionInfo();
    tit_addSaveActionInfo(
          "profes:updatePFM0007TeachingPlan" // insert(원래는 update인데 InsertRow를 하니 insert로 간다.
        , ""	// update
        , ""	// delete
        , ""	// flag column 명
        , ""	// key sql id
        , 0	// key 증가 값
        , "" 
        , 0 
        , "N"  );

        
    if(lb_FileUpload) { //파일 업로드일 경우
        ls_UploadRealName = ls_UploadFileName + "_" + getDate() + right(timem(),3) + gfn_GetFileExtensionName(fdAttachFile.FileName);

        
        ds_ioTeaching.SetColumn(0, "TPPPT"      , fdAttachFile.FileName);  
        ds_ioTeaching.SetColumn(0, "CAFSAVENM"  , fdAttachFile.FileName);      //차트모양.pptx
        ds_ioTeaching.SetColumn(0, "CAFREALNM"  , ls_UploadRealName);          //NOTIS_20091120145487.pptx
        ds_ioTeaching.SetColumn(0, "CAFFILESIZE", StripNum(lbFileSize.text));  //681234
        ds_ioTeaching.SetColumn(0, "CAFDIRPATH" , ls_FileUploadPath);          //MATERAL
        ds_ioTeaching.SetColumn(0, "CAFGUBUN" , ls_CAFGUBUN);                  //profes
        
        //alert("aaaaaaa");
        
        tit_addSaveActionInfo(
            "profes:updateCustAttachFile" // insert(원래는 update인데 InsertRow를 하니 insert로 간다.
            , "" // update
            , "" // delete
            , "" // flag column 명
            , "" // key sql id
            , 0	// key 증가 값
            , "" 
            , 0 
            , "N" // 실행타입
        );
        
        ls_FileUploadService = " ds_iAttachFile=ds_ioTeaching:U";
       
        
    }        
            
    // 서버 호출 
    tit_callService(
         ""
        ,""
        ,"ds_iTeaching=ds_ioTeaching:U" + ls_FileUploadService// inDs
        ,""	// outDs
        ,""	// args 
        ,"lfn_AfterUpdateTrainingOrder"
        ,false  );	

/*
alert("===========UPDATE=================="                //  
  + " \n lb_FileUpload = "+lb_FileUpload  //  
  + " \n Length(FileName) = "+Length(fdAttachFile.FileName)  //  
  + " \n ls_FileUploadPath = "+ls_FileUploadPath         //  /RESUME
  + " \n fdAttachFile.FilePath = "+fdAttachFile.FilePath //  D:\노트북백업20090822
  + " \n fdAttachFile.FileName = "+fdAttachFile.FileName //  쿼리.txt
  + " \n ls_UploadRealName = "+ls_UploadRealName);       //  RESUME_20091208205017890.txt

*/

    if (lb_FileUpload) { //파일 변경일 경우
        //alert("ccccc");
        if (Length(fdAttachFile.FileName) < 1) { //삭제 일 경우
            tit_FileDelete( ls_FileUploadPath
                          , ls_RealFileName
                          , false
                          );
        } else { //변경일 경우
            //alert("tit_FileWrite update 를 샐행한다.");
            tit_FileWrite( hfAttachFile
                         , ls_FileUploadPath
                         , fdAttachFile.FilePath
                         , fdAttachFile.FileName
                         , ls_UploadRealName
                         , "U"
                         , ls_RealFileName
                         );
            hfAttachFile.CloseFile();
        }
    }
    
    mb_IsNewData = false;        
	
}
function lfn_AfterUpdateTrainingOrder(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    //gfn_SaveMessage(); // 저장 메세지를 처리한다.
    
}


function Form_OnUnloadCompleted(obj)
{
	Close();
}

function lfn_End(obj)
{
	/*
	if (ds_ioProfBasicInfo.GetUpdate()) {
		if (!gfn_Confirm("변경된 내용이 있습니다. 그래도 [" + title + "] 창을 닫으시겠습니까?")) {
			return false;
		} else {
			Close();
		}
	}*/	
	Close();
	
}



/*--------------------------------------------------------*
 *  찾아보기      미사용                                  *
 *--------------------------------------------------------*/
 function btn_Append_OnClick(obj)
{

}


//var lb_FileUpload = false;
//var ls_FileUploadPath = "/BBSDATA";
//var ls_BoardGubun = "N";
//var ls_RealFileName = "";
//var ls_UploadFileName = "MATERAL"; //서버에 저장될 파일 명



/*--------------------------------------------------------*
 *  초기화                                                *
 *--------------------------------------------------------*/
function lfn_Cancel(obj)
{
   gfn_FormInit(this);
   ls_RealFileName = "";
   lbFileSize.Text = "";
   lfn_FileDownCheck();
}


/*
 * 기능 : 버튼 활성/비활성시킨다.
 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)
 * return : 없음
 */
function lfn_SetFormAuth(bStatus) {
    btnInput.Enable = bStatus; // 추가 버튼
    btnDelete.Enable = bStatus; // 삭제 버튼
    btnSave.Enable = bStatus; // 수정&저장 버튼
}





//////////////////////////////////////////////////////////
/* 사용자 함수 */
//////////////////////////////////////////////////////////

/**
 * 버튼 정보 변경
 */
function lfn_FileDownCheck(){

    if (length(ls_RealFileName) > 0 && !lb_FileUpload) {
        btnUploadFile.Text = "삭제";
    } else {
        btnUploadFile.Text = "업로드";
    }
}

/*--------------------------------------------------------*
 *  업로드                                                *
 *--------------------------------------------------------*/
 function btnUploadFile_OnClick(obj)
{
    if (btnUploadFile.Text == "삭제") {
            lbFileSize.text = "";
        edAttachFile.text = "";
        btnUploadFile.Text = "업로드";
        lb_FileUpload = true;

    } else {

        fdAttachFile.Type = "OPEN";
        
        if (fdAttachFile.open()) {
            //alert(fdAttachFile.FilePath + "\\" + fdAttachFile.FileName); => (D:\한국소방\보고문서\화면.ppt)
            fiAttachFile.FileName = fdAttachFile.FilePath + "\\" + fdAttachFile.FileName;
                        edAttachFile.text = fdAttachFile.FileName;
            
            
            lbFileSize.text = Round(fiAttachFile.GetLength() / 1024 / 1024, 2) + " MByte";
           
            fiAttachFile.Close();
			if (fiAttachFile.GetLength() > 104857600) {	// 100MB가 넘으면
										   
				gfn_Alert(" 파일 사이즈 : " + Round(fiAttachFile.GetLength() / 1024 / 1024, 2) + " MB" + 
				
				          "\n\n 100MB가 넘는 파일은 업로드하실 수 없습니다.");
				lb_FileUpload = false;
				
				edAttachFile.Text = "";
				
				lbFileSize.Text = "";
				
				return;
							} else {
			
				lb_FileUpload = true;
				
			}
        }
    }

}


/**
 * 파일 다운로드
 */
function lfn_DownloadFile(obj) {

    if (length(ls_RealFileName) > 0) {

        fdAttachFile.Type = "SAVE";
        fdAttachFile.FileName = edAttachFile.text;

        if (fdAttachFile.open()) {
            var arrRtn = tit_fileRead(
                hfAttachFile
                , ls_FileUploadPath
                , ls_RealFileName
                , fdAttachFile.FilePath
                , fdAttachFile.FileName
            );

            gfn_Alert(MSGI00060); //다운로드 완료 메시지
        }
    }
	
}


/**
 * 교안동영상 선택시
 */
function btnButton_OnClick(obj)
{
	
    ExecBrowser("http://172.19.1.17:7001/kems/help/professor/move_help.htm");
                
	
	
}
]]></Script>
</Window>