<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="352" Id="frmcust3040PLicenseList" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="자격정보확인팝업" Top="8" Ver="1.0" Width="776" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_oTrainingList">
				<Contents>
					<colinfo id="SEL" size="256" summ="default" type="STRING"/>
					<colinfo id="GTTEAMNM" size="256" summ="default" type="STRING"/>
					<colinfo id="TOMGGTMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="TCCOURSENM" size="256" summ="default" type="STRING"/>
					<colinfo id="TOHJUBSUNO" size="256" summ="default" type="DECIMAL"/>
					<colinfo id="TJREGDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TOSTARTDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TOENDDATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oExamList">
				<Contents>
					<colinfo id="SEL" size="256" summ="default" type="STRING"/>
					<colinfo id="GTTEAMNM" size="256" summ="default" type="STRING"/>
					<colinfo id="EOMGGTMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="TCCOURSENM" size="256" summ="default" type="STRING"/>
					<colinfo id="EOHJUBSUNO" size="256" summ="default" type="DECIMAL"/>
					<colinfo id="EJREGDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="EOEXAMDATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_iGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>T</CD>
						<DATA>강습교육</DATA>
					</record>
					<record>
						<CD>E</CD>
						<DATA>시험접수</DATA>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="338" Height="136" Id="Shape0" Left="100" LineColor="user15" Right="772" TabOrder="12" Top="202" Type="Rectangle" Width="672"></Shape>
		<Shape Bottom="186" Height="136" Id="Shape1" Left="100" LineColor="user15" Right="772" TabOrder="1" Top="50" Type="Rectangle" Width="672"></Shape>
		<Static Align="Center" Height="20" Id="Static0" Left="116" Style="sty_LabelGruopBox" TabOrder="2" Text="강습교육" Top="42" VAlign="Middle" Width="112"></Static>
		<Static Align="Center" Height="20" Id="Static2" Left="116" Style="sty_LabelGruopBox" TabOrder="3" Text="시험접수" Top="196" VAlign="Middle" Width="112"></Static>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="588" LineColor="user14" Right="772" TabOrder="6" Top="1" Type="Rectangle" Width="184"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="684" OnClick="lfn_End" Style="sty_Button" TabOrder="5" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="24" Id="btnSelect" ImageID="BTN_TEXT_06" Left="590" OnClick="btnSelect_OnClick" Style="sty_Button" TabOrder="4" Text="확인" Top="4" Width="92"></Button>
		<Static Font="굴림,12,Bold" Height="20" Id="lbWorkFormTitle" Left="28" TabOrder="7" Text="접수한&#32;유형을&#32;선택해주세요" Top="4" VAlign="Middle" Width="244"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edsPNM" ImeMode="native" Left="336" LeftMargin="2" Style="sty_Edit" TabOrder="8" Top="8" Visible="FALSE" Width="58"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edsPIHIDNUM" ImeMode="native" Left="400" LeftMargin="2" Style="sty_Edit" TabOrder="9" Top="8" Visible="FALSE" Width="66"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edsPersonkey" ImeMode="native" Left="472" LeftMargin="2" Style="sty_Edit" TabOrder="10" Top="8" Visible="FALSE" Width="106"></Edit>
		<Grid AutoEnter="TRUE" AutoSelect="TRUE" BindDataset="ds_oTrainingList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="178" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="108" Id="gdTraining" InputPanel="FALSE" Left="104" LineColor="default" Right="768" RowHeight="20" Style="sty_Grid" TabOrder="11" TabStop="true" Top="70" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="664">
			<contents>
				<format id="Default">
					<columns>
						<col width="28"/>
						<col width="40"/>
						<col width="165"/>
						<col width="90"/>
						<col width="112"/>
						<col width="93"/>
						<col width="17"/>
						<col width="92"/>
					</columns>
					<head>
						<cell col="0" display="normal" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="순번"/>
						<cell col="2" display="text" text="직능"/>
						<cell col="3" display="text" text="접수번호"/>
						<cell align="center" col="4" display="text" text="접수일자"/>
						<cell col="5" colspan="3" display="text" text="교육기간"/>
					</head>
					<body>
						<cell col="0" colid="SEL" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="number" expr="row+1"/>
						<cell align="left" col="2" colid="TCCOURSENM" combodisplayrowcnt="0" display="combo"/>
						<cell col="3" colid="TOHJUBSUNO" display="text"/>
						<cell align="center" col="4" colid="TJREGDATE" display="date"/>
						<cell align="center" col="5" colid="TOSTARTDATE" display="date"/>
						<cell col="6" display="text" text="~"/>
						<cell align="center" col="7" colid="TOENDDATE" display="date"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoEnter="TRUE" AutoSelect="TRUE" BindDataset="ds_oExamList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="330" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="108" Id="gdExam" InputPanel="FALSE" Left="104" LineColor="default" Right="768" RowHeight="20" Style="sty_Grid" TabOrder="13" TabStop="true" Top="222" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="664">
			<contents>
				<format id="Default">
					<columns>
						<col width="28"/>
						<col width="40"/>
						<col width="189"/>
						<col width="90"/>
						<col width="108"/>
						<col width="189"/>
					</columns>
					<head>
						<cell col="0" display="normal" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="순번"/>
						<cell col="2" display="text" text="직능"/>
						<cell col="3" display="text" text="응시번호"/>
						<cell align="center" col="4" display="text" text="접수일자"/>
						<cell col="5" display="text" text="시험일"/>
					</head>
					<body>
						<cell col="0" colid="SEL" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="number" expr="row+1"/>
						<cell align="left" col="2" colid="TCCOURSENM" combodisplayrowcnt="0" display="combo"/>
						<cell col="3" colid="EOHJUBSUNO" display="text"/>
						<cell align="center" col="4" colid="EJREGDATE" display="date"/>
						<cell align="left" col="5" colid="EOEXAMDATE" display="combo"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Radio Border="Flat" CodeColumn="CD" DataColumn="DATA" Height="292" Id="rdGubun" INDEX="1" InnerDataset="ds_iGubun" Left="8" LeftMargin="4" OnChanged="rdGubun_OnChanged" OnKeyDown="gfn_EnterNextFocus" RightMargin="4" Style="sty_Radio" TabOrder="14" Top="49" UserData="S" Width="88"></Radio>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmcust3040PLicenseList
 * 설명 : 자격정보확인팝업
 * 작성일 : 2022.11
 * 작성자 : jjh
 */

#include "LIB::cust.js"; // 공통업무 관련

var ls_sPNM = ""; // 이름 
var ls_sPIHIDNUM = ""; // 주민번호(생년월일)
var ls_sPersonkey = ""; // personkey


/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
    	
    if (IsExistVar("sPNM")) {
        ls_sPNM = sPNM; 
    }
    if (IsExistVar("sPIHIDNUM")) {
        ls_sPIHIDNUM = sPIHIDNUM; 
    }
    if (IsExistVar("sPersonkey")) {
        ls_sPersonkey = sPersonkey; 
    }
    
	edsPNM.Text = ls_sPNM;
	edsPIHIDNUM.Text = sPIHIDNUM;
	edsPersonkey.Text = sPersonkey;
	
    lfn_Search();
}

function Form_OnUnloadCompleted(obj) {
    Close();
}

/*
 * 기능 : 조회
 */
function lfn_Search(obj) {

    ds_oTrainingList.ClearData(); // 데이타셋 초기화
    ds_oExamList.ClearData(); // 데이타셋 초기화
        
    // personkey로 자격정보, 교육정보 조회 
    if(ls_sPersonkey <> ""){			
		tit_clearActionInfo();
		tit_addCsvSearchActionInfo("cust:searchCust3040PTrainingList", false);
		tit_addCsvSearchActionInfo("cust:searchCust3040PEdupassList", false);
		tit_callService(
			""
			,""
			,""	// inDs
			,"ds_oTrainingList=ds_oTrainingList ds_oExamList=ds_oExamList"	// outDs
			,"PPERSONKEY=" + quote(ls_sPersonkey) // args 
			,""
			,false
			,false
			,true
		);		
		gfn_SearchMessage(gdTraining); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
		gfn_SearchMessage(gdExam); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
		
		rdGubun.Value = "";
		if(ds_oExamList.GetRowCount() > 0) {
			rdGubun.Value = "E"; // 강습(T), 시험 (E)
		}
		if(ds_oTrainingList.GetRowCount() > 0) {
			rdGubun.Value = "T"; // 강습(T), 시험 (E)
		}
		rdGubun_OnChanged(); 
		
    }else{    
		gdTraining.Enable = false;
		gdExam.Enable = false;		
     }
}


// 확인 선택 시
function btnSelect_OnClick(obj)
{
	var ls_reGubun = rdGubun.Value; // 강습(T), 시험 (E)
	var ls_regDate = ""; 
	var ls_rJubsuno = "";
	var ls_rStartdate = "";	
	var ls_rEnddate = "";
	var ls_rJibu = "";
		
    if(rdGubun.Value == ""){	
		alert("강습교육, 시험접수를 선택해 주십시오.");      
		return false;
    }
    
    if(rdGubun.Value == "T"){		
		//강습정보 확인 
		var li_cnt = 0;	
		var li_row = 0;
		for(i = 0; i < ds_oTrainingList.RowCount(); i++) {
			if(ds_oTrainingList.GetColumn(i, "SEL") == '1') {
				li_cnt++;
				li_row = i;
			}
		}	
		if(li_cnt > 1){
			alert("강습교육정보를 한건만 선택해 주십시오.");      
			return false;
		}	
		if(li_cnt = 0){
			alert("강습교육정보를 선택해 주십시오.");      
			return false;
		}
		ls_regDate = left(ds_oTrainingList.GetColumn(li_row,"TJREGDATE"),8);
		ls_rJubsuno = ds_oTrainingList.GetColumn(li_row,"TOHJUBSUNO");
		ls_rStartdate = ds_oTrainingList.GetColumn(li_row,"TOSTARTDATE");
		ls_rEnddate = ds_oTrainingList.GetColumn(li_row,"TOENDDATE");
		ls_rJibu = ds_oTrainingList.GetColumn(li_row,"TOMGGTMGNO"); 		
    }else{	
		//시험정보 확인 
		var li_cnt = 0;	
		var li_row = 0;
		for(i = 0; i < ds_oExamList.RowCount(); i++) {
			if(ds_oExamList.GetColumn(i, "SEL") == '1') {
				li_cnt++;
				li_row = i;
			}
		}	
		if(li_cnt > 1){
			alert("시험접수정보를 한건만 선택해 주십시오.");      
			return false;
		}	
		if(li_cnt = 0){
			alert("시험접수정보를 선택해 주십시오.");      
			return false;
		}
		
		ls_regDate = left(ds_oExamList.GetColumn(li_row,"EJREGDATE"),8);
		ls_rJubsuno = ds_oExamList.GetColumn(li_row,"EOHJUBSUNO");
		ls_rStartdate = ds_oExamList.GetColumn(li_row,"EOEXAMDATE");
		ls_rEnddate = "";
		ls_rJibu = ds_oExamList.GetColumn(li_row,"EOMGGTMGNO");
		
		
    }
		 
    var arrArg = Array(5);
    arrArg[0] = ls_reGubun; // 강습(T), 시험 (E)
    arrArg[1] = ls_rJibu; // 접수지부
    arrArg[2] = ls_rJubsuno; // 접수번호 
    arrArg[3] = ls_regDate; // 접수일자
    arrArg[4] = ls_rStartdate; // 시작일자
    arrArg[5] = ls_rEnddate; // 종료일자 
    Close(arrArg);    
}
 

/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close();
}

function rdGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	
    if(rdGubun.Value == "T"){
		gdTraining.Enable = true;
		gdExam.Enable = false;		
		
		for(i = 0; i < ds_oExamList.RowCount(); i++) {
			ds_oExamList.SetColumn(i, "SEL", '');
		}
    }
    if(rdGubun.Value == "E"){
		gdTraining.Enable = false;
		gdExam.Enable = true;
					
		for(i = 0; i < ds_oTrainingList.RowCount(); i++) {
			ds_oTrainingList.SetColumn(i, "SEL", '');
		}
    }
}
]]></Script>
</Window>