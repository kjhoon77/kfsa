<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="480" Id="frmcust3030PLicenseList" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="소방안전관리보조자&#32;선임유형" Top="8" Ver="1.0" Width="680" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_oFireManagerList">
				<Contents>
					<colinfo id="BILD_SN" size="201" summ="default" type="STRING"/>
					<colinfo id="OBJ_NM" size="2" summ="default" type="STRING"/>
					<colinfo id="CRQFC_CODE" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="CRQFC_NM" size="40" summ="default" type="STRING"/>
					<colinfo id="APNT_DE" size="13" summ="default" type="STRING"/>
					<colinfo id="BUILDADRES" size="20" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oLicenseList">
				<Contents>
					<colinfo id="SEL" size="1" summ="default" type="STRING"/>
					<colinfo id="LTCCOURSENM" size="256" summ="default" type="STRING"/>
					<colinfo id="LLCSNO" size="256" summ="default" type="STRING"/>
					<colinfo id="LISSUEDATE" size="256" summ="default" type="DECIMAL"/>
					<colinfo id="LORGGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="LORGGUBUNNMM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_iGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>L</CD>
						<DATA>자격</DATA>
					</record>
					<record>
						<CD>T</CD>
						<DATA>강습수료</DATA>
					</record>
					<record>
						<CD>K</CD>
						<DATA>경력기간</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oEdupassList">
				<Contents>
					<colinfo id="SEL" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="201" summ="default" type="STRING"/>
					<colinfo id="TCCOURSENM" size="2" summ="default" type="STRING"/>
					<colinfo id="GTTEAMNM" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="TOENDDATE" size="40" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="168" Height="128" Id="Shape0" Left="4" LineColor="user15" Right="676" TabOrder="2" Top="40" Type="Rectangle" Width="672"></Shape>
		<Static Align="Center" Height="20" Id="Static1" Left="20" Style="sty_LabelGruopBox" TabOrder="1" Text="선임정보" Top="32" VAlign="Middle" Width="112"></Static>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="492" LineColor="user14" Right="676" TabOrder="5" Top="1" Type="Rectangle" Width="184"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="588" OnClick="lfn_End" Style="sty_Button" TabOrder="4" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="24" Id="btnSelect" ImageID="BTN_TEXT_06" Left="494" OnClick="btnSelect_OnClick" Style="sty_Button" TabOrder="3" Text="확인" Top="4" Width="92"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_oFireManagerList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="164" ColSizing="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="108" Id="gdFireManager" InputPanel="FALSE" Left="8" LineColor="default" MinWidth="100" Right="672" RowHeight="20" Style="sty_Grid" TabOrder="6" TabStop="true" Top="56" UseDBuff="true" UsePopupMenu="true" UserData="대상물(업체)정보" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="664">
			<contents>
				<format id="Default">
					<columns>
						<col width="40"/>
						<col width="152"/>
						<col width="120"/>
						<col width="87"/>
						<col width="242"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" text="순번"/>
						<cell align="center" col="1" display="text" text="대상물명"/>
						<cell align="center" col="2" display="text" text="등급"/>
						<cell col="3" display="text" text="선임일자"/>
						<cell col="4" display="text" text="소재지"/>
					</head>
					<body>
						<cell align="center" col="0" display="number" expr="row+1"/>
						<cell align="left" col="1" colid="OBJ_NM" display="text"/>
						<cell align="left" col="2" colid="CRQFC_NM" combocol="CD" combodataset="ds_oBizGubun" combotext="DATA" display="combo"/>
						<cell align="left" col="3" colid="APNT_DE" display="date"/>
						<cell align="left" col="4" colid="BUILDADRES" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Font="굴림,12,Bold" Height="20" Id="lbWorkFormTitle" Left="28" TabOrder="7" Text="소방안전관리보조자&#32;선임유형" Top="4" VAlign="Middle" Width="244"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edsPNM" ImeMode="native" Left="264" LeftMargin="2" Style="sty_Edit" TabOrder="8" Top="8" Visible="FALSE" Width="58"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edsPIHIDNUM" ImeMode="native" Left="328" LeftMargin="2" Style="sty_Edit" TabOrder="9" Top="8" Visible="FALSE" Width="58"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edsPersonkey" ImeMode="native" Left="392" LeftMargin="2" Style="sty_Edit" TabOrder="10" Top="8" Visible="FALSE" Width="90"></Edit>
		<Radio Border="Flat" CodeColumn="CD" DataColumn="DATA" Height="292" Id="rdGubun" INDEX="1" InnerDataset="ds_iGubun" Left="5" LeftMargin="4" OnChanged="rdGubun_OnChanged" OnKeyDown="gfn_EnterNextFocus" RightMargin="4" Style="sty_Radio" TabOrder="12" Top="174" UserData="S" Width="88"></Radio>
		<Shape Bottom="463" Height="288" Id="Shape1" Left="97" LineColor="user15" Right="673" TabOrder="11" Top="175" Type="Rectangle" Width="576"></Shape>
		<Grid AutoEnter="TRUE" AutoSelect="TRUE" BindDataset="ds_oLicenseList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="278" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="100" Id="gdLicense" InputPanel="FALSE" Left="104" LineColor="default" Right="664" RowHeight="20" Style="sty_Grid" TabOrder="13" TabStop="true" Top="178" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="560">
			<contents>
				<format id="Default">
					<columns>
						<col width="28"/>
						<col width="40"/>
						<col width="151"/>
						<col width="143"/>
						<col width="79"/>
						<col width="96"/>
					</columns>
					<head>
						<cell col="0" display="normal" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="순번"/>
						<cell col="2" display="text" text="자격등급"/>
						<cell align="center" col="3" display="text" text="자격번호"/>
						<cell col="4" display="text" text="취득일자"/>
						<cell col="5" display="text" text="발급기관"/>
					</head>
					<body>
						<cell align="center" col="0" colid="SEL" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="number" expr="row+1"/>
						<cell align="left" col="2" colid="LTCCOURSENM" display="text"/>
						<cell align="center" col="3" colid="LLCSNO" display="text"/>
						<cell align="center" col="4" colid="LISSUEDATE" display="date"/>
						<cell align="left" col="5" colid="LORGGUBUNNMM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoEnter="TRUE" AutoSelect="TRUE" BindDataset="ds_oEdupassList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="394" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="108" Id="gdEdupass" InputPanel="FALSE" Left="104" LineColor="default" Right="664" RowHeight="20" Style="sty_Grid" TabOrder="14" TabStop="true" Top="286" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="560">
			<contents>
				<format id="Default">
					<columns>
						<col width="28"/>
						<col width="40"/>
						<col width="45"/>
						<col width="189"/>
						<col width="90"/>
						<col width="143"/>
					</columns>
					<head>
						<cell col="0" display="normal" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="순번"/>
						<cell col="2" display="text" text="구분"/>
						<cell col="3" display="text" text="등급"/>
						<cell align="center" col="4" display="text" text="교육일자"/>
						<cell col="5" display="text" text="지부"/>
					</head>
					<body>
						<cell col="0" colid="SEL" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="number" expr="row+1"/>
						<cell align="center" col="2" colid="GUBUN" display="text"/>
						<cell align="left" col="3" colid="TCCOURSENM" combodisplayrowcnt="0" display="combo"/>
						<cell align="center" col="4" colid="TOENDDATE" display="date"/>
						<cell align="left" col="5" colid="GTTEAMNM" display="combo"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Center" Height="20" Id="lbPersonNm2" Left="107" Style="sty_Label" TabOrder="16" Text="경력기간" Top="414" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edLicenseDate" ImeMode="native" Left="199" LeftMargin="2" Style="sty_Edit" TabOrder="15" Top="414" Width="106"></Edit>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmcust3030PLicenseList
 * 설명 : 자격정보확인팝업
 * 작성일 : 2022.11
 * 작성자 : jjh    
 */

#include "LIB::cust.js"; // 공통업무 관련

var ls_sPNM = ""; // 이름 
var ls_sPIHIDNUM = ""; // 주민번호(생년월일)
var ls_sPersonkey = ""; // personkey


/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
    	
    if (IsExistVar("sPNM")) {
        ls_sPNM = sPNM; 
    }     
    if (IsExistVar("sPIHIDNUM")) {
        ls_sPIHIDNUM = sPIHIDNUM; 
    }
    if (IsExistVar("sPersonkey")) {
        ls_sPersonkey = sPersonkey; 
    }
    /*
	trace("ls_sPNM : " + ls_sPNM);
	trace("ls_sPIHIDNUM : " + ls_sPIHIDNUM);
	trace("ls_sPersonkey : " + ls_sPersonkey);
	*/
	edsPNM.Text = ls_sPNM;
	edsPIHIDNUM.Text = sPIHIDNUM;
	edsPersonkey.Text = sPersonkey;
	
    lfn_Search();
}

function Form_OnUnloadCompleted(obj) {
    Close();
}

// 선택 시  
function rdGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex){ 
	  
	// 자격(L), 강습수료(T), 경력기간(K)
    if(rdGubun.Value == "L"){
		gdLicense.Enable = true;
		gdEdupass.Enable = false;
		edLicenseDate.Enable = false;		
		
		for(i = 0; i < ds_oEdupassList.RowCount(); i++) {
			ds_oEdupassList.SetColumn(i, "SEL", '');
		}
    }
    if(rdGubun.Value == "T"){
		gdLicense.Enable = false;
		gdEdupass.Enable = true;
		edLicenseDate.Enable = false;
					
		for(i = 0; i < ds_oLicenseList.RowCount(); i++) {
			ds_oLicenseList.SetColumn(i, "SEL", '');
		}
    }
    if(rdGubun.Value == "K"){
		gdLicense.Enable = false;
		gdEdupass.Enable = false;
		edLicenseDate.Enable = true;	
		for(i = 0; i < ds_oEdupassList.RowCount(); i++) {
			ds_oEdupassList.SetColumn(i, "SEL", '');
		}
		for(i = 0; i < ds_oLicenseList.RowCount(); i++) {
			ds_oLicenseList.SetColumn(i, "SEL", '');
		}
    }
}

/*
 * 기능 : 조회
 */
function lfn_Search(obj) {

    ds_oFireManagerList.ClearData(); // 데이타셋 초기화
    ds_oLicenseList.ClearData(); // 데이타셋 초기화
    ds_oEdupassList.ClearData(); // 데이타셋 초기화
        
    //이름, 주민번호(생년월일)로 선임정보 조회 
    if(ls_sPNM <> "" && ls_sPIHIDNUM <> ""){			
		tit_clearActionInfo();
		tit_addCsvSearchActionInfo("cust:searchCust3030PFireManagerList", false);
		tit_callService(
			""
			,""
			,""	// inDs
			,"ds_oFireManagerList=ds_oFireManagerList"	// outDs
			,"PNM=" + quote(ls_sPNM)
				+ " PIHIDNUM=" + quote(ls_sPIHIDNUM) // args 
			,""
			,false
			,false
			,true
		);
    }    
    gfn_SearchMessage(gdFireManager); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
       
    // personkey로 자격정보, 교육정보 조회 
    if(ls_sPersonkey <> ""){			
		tit_clearActionInfo();
		tit_addCsvSearchActionInfo("cust:searchCust3030PLicenseList", false);
		tit_addCsvSearchActionInfo("cust:searchCust3030PEdupassList", false);
		tit_callService(
			""
			,""
			,""	// inDs
			,"ds_oLicenseList=ds_oLicenseList ds_oEdupassList=ds_oEdupassList"	// outDs
			,"PPERSONKEY=" + quote(ls_sPersonkey) // args 
			,""
			,false
			,false
			,true
		);		
		gfn_SearchMessage(gdLicense); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
		gfn_SearchMessage(gdEdupass); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
		 
    }
    
    
	rdGubun.Value = "";
	// 자격(L), 강습수료(T), 경력기간(K)
	if(ds_oLicenseList.GetRowCount() == 0 && ds_oEdupassList.GetRowCount() == 0 ) {
		rdGubun.Value = "K";
	}else{
		if(ds_oEdupassList.GetRowCount() > 0) {
			rdGubun.Value = "T";
		}
		if(ds_oLicenseList.GetRowCount() > 0) {
			rdGubun.Value = "L";
		}
	}
	rdGubun_OnChanged(); 
		
    
}


// 확인 선택 시
function btnSelect_OnClick(obj)
{
	var ls_reGubun = rdGubun.Value; // 자격(L), 강습수료(T), 경력기간(K)
	var ls_rLicenseNm = ""; 
	var ls_rLicenseNo = "";
	var ls_rEduDate = "";	
	var ls_rLicenseDate = "";
	var is_qualfuser_sn = "";
		
    if(rdGubun.Value == ""){	
		alert("자격, 강습수료, 경력기간 중 선택해 주십시오.");      
		return false;
    }
    
    if(rdGubun.Value == "L"){		
		//자격정보 확인 
		var li_cnt = 0;	
		var li_row = 0;
		for(i = 0; i < ds_oLicenseList.RowCount(); i++) {
			if(ds_oLicenseList.GetColumn(i, "SEL") == '1') {
				li_cnt++;
				li_row = i;
			}
		}	
		if(li_cnt > 1){
			alert("자격정보를 한건만 선택해 주십시오.");      
			return false;
		}	
		if(li_cnt = 0){
			alert("자격정보를 선택해 주십시오.");      
			return false;
		}
		ls_rLicenseNm = ds_oLicenseList.GetColumn(li_row,"LTCCOURSENM");
		ls_rLicenseNo = ds_oLicenseList.GetColumn(li_row,"LLCSNO");	
		
    }else if(rdGubun.Value == "T"){		
		//강습정보 확인 
		var li_cnt = 0;	
		var li_row = 0;
		for(i = 0; i < ds_oEdupassList.RowCount(); i++) {
			if(ds_oEdupassList.GetColumn(i, "SEL") == '1') {
				li_cnt++;
				li_row = i;
			}
		}	
		if(li_cnt > 1){
			alert("강습수료정보를 한건만 선택해 주십시오.");      
			return false;
		}	
		if(li_cnt = 0){
			alert("강습수료정보를 선택해 주십시오.");      
			return false;
		}
		
		ls_rEduDate = ds_oEdupassList.GetColumn(li_row,"TOENDDATE");
		
	}else {
	
		ls_rLicenseDate = edLicenseDate.Text;
		if(ls_rLicenseDate == ""){
			alert("경력기간을 입력해 주십시오.");    
			edLicenseDate.SetFocus();
			return false;
		}
		
    }
    
    is_qualfuser_sn = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "QUALFUSER_SN");
		 
    var arrArg = Array(23);
    arrArg[0] = ls_reGubun; 		// 자격(L), 강습수료(T), 경력기간(K)
    arrArg[1] = ls_rLicenseNm; 		// 자격등급 
    arrArg[2] = ls_rLicenseNo; 		// 자격번호 
    arrArg[3] = ls_rEduDate; 		// 교육일자 
    arrArg[4] = ls_rLicenseDate; 	// 경력기간
    arrArg[5] = is_qualfuser_sn; 	// 선임자 자격 일련번호
    arrArg[6] = ls_sPersonkey; 		// 고유 KEY
    arrArg[7] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "ZIP");			// 우편번호
    arrArg[8] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "CTRD_CODE");		// 시도코드
    arrArg[9] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "SIGNGU_CODE");	// 시군구코드
	arrArg[10] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "DONG_CODE");	// 동 코드
	arrArg[11] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "LI_CODE");		// 리 코드 
	arrArg[12] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "MNTN_LNBR_AT");	// 산번지 여부
	arrArg[13] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "MAIN_LNBR");	// 본 번지
	arrArg[14] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "SEC_LNBR");		// 부 번지
	arrArg[15] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "BASS_ADRES");	// 기본 주소
	arrArg[16] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "ETC_ADRES");	// 기타 주소
	arrArg[17] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "ROAD_NM");		// 도로명
	arrArg[18] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "MAIN_BDNBR");	// 본 건물 번호
	arrArg[19] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "SEC_BDNBR");	// 부 건물 번호
	arrArg[20] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "BULD_NM");		// 건물 명
	arrArg[21] = ds_oFireManagerList.GetColumn(ds_oFireManagerList.currow, "BULD_NM_ETC");	// 건물 명 기타
	arrArg[22] = rdGubun.Value;																// 선임유형
	arrArg[23] = edLicenseDate.Text;

    Close(arrArg);    
	               
}
 


/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close();
}]]></Script>
</Window>