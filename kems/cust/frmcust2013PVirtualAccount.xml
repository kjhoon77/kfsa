<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="220" Id="frmcust2013PVirtualAccount" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="가상계좌정보" TooltipFont="Default,0" Top="8" Ver="1.0" Width="400" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioVirtualInfo">
				<Contents>
					<colinfo id="PCPMYEAR" size="4" summ="default" type="STRING"/>
					<colinfo id="PCPMMGNO" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="PCCLOSEDATE" size="14" summ="default" type="STRING"/>
					<colinfo id="PCFLAG" size="5" summ="default" type="STRING"/>
					<colinfo id="PCACCOUNT" size="15" summ="default" type="STRING"/>
					<colinfo id="PCBANKCD" size="10" summ="default" type="STRING"/>
					<colinfo id="PCBANKNM" size="20" summ="default" type="STRING"/>
					<colinfo id="PCAMOUNT" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="PCBANKDATE" size="14" summ="default" type="STRING"/>
					<colinfo id="PCTRANSACTION" size="24" summ="default" type="STRING"/>
					<colinfo id="PMPIID" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_ioPosInput">
				<Contents>
					<colinfo id="PMYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="PMMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="PMPIID" size="256" summ="default" type="STRING"/>
					<colinfo id="PCTRANSACTION" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioPosOutputJVM">
				<Contents>
					<colinfo id="MI_PMYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_PMMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_PRMGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_RESPCODE" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_CASHRECEIPTNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_RESPMSG" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_OID" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_TID" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_AMOUNT" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_ACCOUNTNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_FINANCECODE" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_CASFLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_FINANCENAME" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_RSCODE" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_RSMSG" size="256" summ="default" type="STRING"/>
					<colinfo id="LGD_TAXFREEAMOUNT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="218" LineColor="user14" Right="396" TabOrder="18" Top="1" Type="Rectangle" Width="178"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="308" OnClick="lfn_End" Style="sty_Button" TabOrder="1" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Shape Bottom="216" Height="184" Id="shpGubunBox4" Left="4" LineColor="user15" Right="396" TabOrder="13" Top="32" Type="Rectangle" Width="392"></Shape>
		<Static Align="Center" Height="20" Id="lbProcGubun" Left="8" Style="sty_Label" TabOrder="7" Text="입금여부" Top="72" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbBankCd" Left="8" Style="sty_Label" TabOrder="8" Text="은행코드" Top="120" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edBankCd" ImeMode="native" Left="100" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="4" Top="120" UserData="S" Width="72"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edProcGubun" ImeMode="native" Left="100" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="2" Top="72" UserData="S" Width="72"></Edit>
		<Static Align="Center" Height="20" Id="lbAmount" Left="8" Style="sty_Label" TabOrder="9" Text="입금액" Top="168" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbBankNm" Left="8" Style="sty_Label" TabOrder="10" Text="은행명" Top="144" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edBankNm" ImeMode="native" Left="100" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="5" Top="144" UserData="S" Width="168"></Edit>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medAmount" Left="100" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Maskedit" TabOrder="6" Top="168" UserData="S" Width="72"></MaskEdit>
		<Static Align="Center" Height="20" Id="lbAccountNo" Left="8" Style="sty_Label" TabOrder="11" Text="계좌번호" Top="96" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="edAccountNo" ImeMode="native" Left="100" LeftMargin="2" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="3" Top="96" UserData="S" Width="292"></Edit>
		<Static Align="Center" Height="20" Id="lbCloseDate" Left="8" Style="sty_Label" TabOrder="12" Text="유효기간" Top="48" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbRepay" Left="20" Style="sty_LabelGruopBox" TabOrder="14" Text="가상계좌정보" Top="24" VAlign="Middle" Width="120"></Static>
		<Static Align="Center" Height="20" Id="lbProcDate" Left="8" Style="sty_Label" TabOrder="15" Text="처리일자" Top="192" VAlign="Middle" Width="88"></Static>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medProcDate" Left="100" Mask="####.##.##&#32;##:##:##" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Maskedit" TabOrder="16" Top="192" Type="STRING" UserData="S" Width="128"></MaskEdit>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medCloseDate" Left="100" Mask="####.##.##&#32;##:##:##" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Maskedit" TabOrder="17" Top="48" Type="STRING" UserData="S" Width="128"></MaskEdit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="22" Id="btnDelete" ImageID="BTN_COM_DEL" Left="221" OnClick="lfn_Delete" Style="sty_Button" TabOrder="19" ToolTipText="삭제&#32;저장" Top="4" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmcust2013PVirtualAccount.xml
 * 설명 : 가상계좌정보
 * 작성일 : 2009.12.20
 * 작성자 : 김동현
 */

#include "LIB::cust.js"; // 공통 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리

    if (IsExistVar("sPmYear") && IsExistVar("sPmMgno")) {
        lfn_Search();
    } else {
        gfn_Alert("결제 정보가 없습니다.");
        lfn_Cancel();
    }
    
}

/**
 * 조회
 */
function lfn_Search() {

    ds_ioVirtualInfo.ClearData();

    tit_clearActionInfo();
    tit_addCsvSearchActionInfo("cust:searchCust2013VirtualAccount", false);
    tit_callService(
        ""
        ,""
        ,"" // inDs
        ,"ds_ioVirtualInfo=ds_oVirtualAccount"	// outDs
        ,"SPMYEAR=" + quote(sPmYear)
            + " SPMMGNO=" + quote(sPmMgno) // args 
        ,""
        ,false
        ,""
        ,true
    );

    medCloseDate.Value = ds_ioVirtualInfo.GetColumn(0, "PCCLOSEDATE");
    edProcGubun.Text = ds_ioVirtualInfo.GetColumn(0, "PCFLAG");
    edAccountNo.Text = ds_ioVirtualInfo.GetColumn(0, "PCACCOUNT");
    edBankCd.Text = ds_ioVirtualInfo.GetColumn(0, "PCBANKCD");
    edBankNm.Text = ds_ioVirtualInfo.GetColumn(0, "PCBANKNM");
    medAmount.Value = ds_ioVirtualInfo.GetColumn(0, "PCAMOUNT");
    medProcDate.Value = ds_ioVirtualInfo.GetColumn(0, "PCBANKDATE");
    
    if (edProcGubun.Text <> "입금") {
        btnDelete.Enable = true;
    } else {
        btnDelete.Enable = false;
    }

}

function Form_OnUnloadCompleted(obj) {
    Close("END");
}

function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
    switch (nChar) {
        case 27 : // 종료(Esc)
            lfn_End();
            break;
    }
}

/*
 * 기능 : 삭제
 */
function lfn_Delete(obj) {

    if (!gfn_confirm("가상계좌를 삭제 하시겠습니까?")) {
        return;
    }

	Https.Sync = true;
	ds_ioPosOutputJVM.ClearData();	//가비지 데이타 제거

	var params = "ROW='0'";
	params += " PMREGSABUN="+gds_oUserInfo.GetColumn(0,"PSABUN");
	//params += " PMREGSABUN=TEST001";

	ds_ioPosInput.ClearData();
	ds_ioPosInput.InsertRow(0);

	ds_ioPosInput.SetColumn(0, "PMYEAR", ds_ioVirtualInfo.GetColumn(0, "PCPMYEAR"));
	ds_ioPosInput.SetColumn(0, "PMMGNO", ds_ioVirtualInfo.GetColumn(0, "PCPMMGNO"));
	ds_ioPosInput.SetColumn(0, "PMPIID", ds_ioVirtualInfo.GetColumn(0, "PMPIID"));
	ds_ioPosInput.SetColumn(0, "PCTRANSACTION", ds_ioVirtualInfo.GetColumn(0, "PCTRANSACTION"));
		
	Transaction("PosRun", "http://172.19.1.17:7001/kems/pos/ServiceBiz/PosReqCyberAccountCancel.jsp", "ioPosInput=ds_ioPosInput", "ds_ioPosOutputJVM=ioPosOutput", params, "");
	Https.Sync = false;


    tit_clearActionInfo();
    tit_addSingleActionInfo("cust:deleteCust2013VirtualAccount", "", 0, "");
    tit_callService(
        ""
        ,""
        ,"ds_iVirtualAccount=ds_ioVirtualInfo" // inDs
        ,""	// outDs
        ,""
        ,"lfn_AfterDelete"
        ,false
    );

}


/**
 * 기타 TRANSACTION 처리 후
 */
function lfn_AfterDelete(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return "Transaction Error!";
    }
    
    gfn_Alert("가상계좌 삭제가 완료 되었습니다.");
    Close("OK");
}

/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close("END");
}
/* 공통 필수 종료 */

/* 사용자 함수 */

/* 사용자 이벤트 함수 */

]]></Script>
</Window>