<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="235" Id="frmprofes0005S03LecHistory" Left="8" OnActivate="frmprofes0005S03LecHistory_OnActivate" OnLoadCompleted="Form_OnLoadCompleted" PidAttrib="7" Style="sty_Form" Title="강의실적_교수배정" Top="8" Ver="1.0" Width="782" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_code">
				<Contents>
					<colinfo id="code" size="10" summ="default" type="STRING"/>
					<colinfo id="name" size="30" summ="default" type="STRING"/>
					<record>
						<code>M</code>
						<name>정교수</name>
					</record>
					<record>
						<code>S</code>
						<name>보조교수</name>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oEdutype">
				<Contents>
					<colinfo id="EDUTYPE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Static Align="Center" Height="20" Id="Static8" Left="-144" Style="sty_LabelGruopBox" TabOrder="1" Text="안전원&#32;교수&#32;관리" Top="63" VAlign="Middle" Width="120"></Static>
		<Shape Bottom="230" Height="214" Id="Shape1" Left="4" LineColor="user15" Right="776" TabOrder="2" Top="16" Type="Rectangle" Width="772"></Shape>
		<Static Align="Center" Height="20" Id="lblTabTitle" Left="32" Style="sty_LabelGruopBox" TabOrder="3" Text="위험물&#32;안전관리자&#32;교수등록" Top="8" VAlign="Middle" Width="208"></Static>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_ioProfesAssign" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="226" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="182" Id="gdProfesAssign" InputPanel="FALSE" Left="8" LineColor="default" MinWidth="100" OnCellClick="gdProfesAssign_OnCellClick" Right="772" RowHeight="20" Style="sty_Grid" TabOrder="4" TabStop="true" Top="44" UseDBuff="true" UsePopupMenu="true" UserData="교수등록리스트" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="764">
			<contents>
				<format id="Default">
					<columns>
						<col width="35"/>
						<col width="52"/>
						<col width="195"/>
						<col width="28"/>
						<col width="70"/>
						<col width="60"/>
						<col width="28"/>
						<col width="80"/>
						<col width="60"/>
						<col width="90"/>
						<col width="60"/>
						<col width="60"/>
						<col width="35"/>
						<col width="35"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" text="일차"/>
						<cell align="center" col="1" display="text" text="교시"/>
						<cell col="2" colspan="2" display="text" text="과목"/>
						<cell col="4" display="text" text="직책"/>
						<cell col="5" colspan="2" display="text" text="교수명"/>
						<cell align="center" col="7" display="text" text="직위"/>
						<cell align="center" col="8" display="text" text="구분"/>
						<cell align="center" col="9" display="text" text="교육시간"/>
						<cell align="center" col="10" display="text" text="지부명"/>
						<cell align="center" col="11" display="text" text="강사료"/>
						<cell align="center" col="12" colspan="2" display="text" text="교수추가"/>
					</head>
					<body>
						<cell align="center" col="0" colid="LTEDUDAYS" display="text"/>
						<cell align="center" col="1" colid="TSTIME" display="text" expr='TSTIME+&quot;교시&quot;'/>
						<cell align="left" col="2" colid="PSTITLE" display="text"/>
						<cell bkimageid="IMG_SEARCH" col="3" display="image" edit="button"/>
						<cell col="4" colid="PSTN" combocol="code" combodataset="ds_code" combotext="name" display="combo" edit="combo"/>
						<cell align="left" col="5" colid="LPPFNM" display="text"/>
						<cell bkimageid="IMG_SEARCH" col="6" display="image" edit="button"/>
						<cell align="left" col="7" colid="LPPFJIKWINM" display="text"/>
						<cell align="center" col="8" colid="LPPFGUBUN" display="text"/>
						<cell align="center" col="9" colid="EDUTIME" display="text"/>
						<cell align="center" col="10" colid="EDUTEAMNM" display="text"/>
						<cell align="right" col="11" colid="LPSPEAKERPAY" display="number" edit="expr:iif(LPPFGUBUNCD&#32;==&#32;&apos;3&apos;,&#32;&apos;number&apos;,&#32;&apos;none&apos;)"/>
						<cell align="center" col="12" display="button" edit="button" text="추가"/>
						<cell align="center" col="13" display="button" edit="button" text="삭제"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Center" Height="20" Id="Static1" Left="245" Style="sty_Label" TabOrder="5" Text="일차" Top="20" VAlign="Middle" Width="44"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxDays" INDEX="0" InnerDataset="ds_oSelectDays" Left="292" OnChanged="cbxDays_OnChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="6" Top="19" UserData="I" Width="77"></Combo>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSave" ImageID="BTN_TEXT_03" Left="372" OnClick="btnSave_OnClick" Style="sty_Button" TabOrder="7" Text="저장" Top="19" Transparent="TRUE" Width="53"></Button>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmPFM0005S03LecHistory.xml
 * 설명 : 강의실적_교수배정
 * 작성일 : 2009.11.09
 * 작성자 : 김은규
 */
 
 
#include "LIB::COMMON.js"; // 공통 관련

var returnval = 0;
 
 
 
var dsParentObj = parent.ds_ioStudyCourse;

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
     tit_createActionInfo(); // X-Framework용
}

function inf_edutypecheck()
{
	var nRow = parent.ds_ioStudyCourse.GetCurrow();
	var EDUMGNO = parent.ds_ioStudyCourse.GetColumn(nRow, "EDUMGNO");
	lfn_searchEduType(EDUMGNO);
	
	if(ds_oEdutype.GetRowCount() > 0)
	{
		if(ds_oEdutype.GetColumn(0, "EDUTYPE") == "20") // edutype:20 ==> 실무일정의 교육유형이 : 대리자/교육희망자
		{
			gfn_Alert(" 선택한 교육의 교육유형이 \n\n '대리자/교육희망자' 이면 시간배정 및 \n\n 교수배정을 할 수 없습니다. ");
		}
	}
}

function lfn_searchEduType(EDUMGNO)
{
	tit_clearActionInfo();
    tit_addSearchActionInfo("profes:searchProfes0005Edutype", false);
    // 서버 호출
    tit_callService(
        ""
        ,""
        ,""    // inDs
        ,"ds_oEdutype=ds_oEdutype"    // outDs
        ,"EDUMGNO=" + quote(EDUMGNO)
        ,"ifn_oEdutype"
        ,false
        ,false
        ,true
    );
}

function ifn_oEdutype(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
    }
    
    if(ds_oEdutype.GetRowCount() > 0)
    {
		returnval = 1;
    }else {
        returnval = 0;    
    }
}


/*
 * 기능 : TAB 이름표 변경
 * parameter : 없음
 * Return : 없음
 */
function frmprofes0005S03LecHistory_OnActivate(obj)
{
	parent.curTabPage = tabTab.tabpgTabPage3;	//current TabPage	
	lblTabTitle.Width = length(dsParentObj.GetColumn(dsParentObj.currow, "EDUCOURSENM")) * 15 + 80;
	lblTabTitle.Text = dsParentObj.GetColumn(dsParentObj.currow, "EDUCOURSENM") + " 교수등록";
}


/*
 * 기능 : 일차별 교수등록 내용 필터링
 * parameter : days - 일차
 * Return : 없음
 */
function lfn_DaysFilter(days) {
	var strExpr = "LTEDUDAYS='"+days+"'";
	ds_ioProfesAssign.Filter(strExpr);
}


/* 사용자 이벤트 함수 */
function cbxDays_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {
	lfn_DaysFilter(strCode);
}


function gdProfesAssign_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex) {
	//if(ds_ioStudyCourse.GetColumn(ds_ioStudyCourse.currow, "EDULMGNO") 

	if(parent.ds_ioStudyCourse.GetColumn(parent.ds_ioStudyCourse.currow, "EDUYEAR") < "2024")
	{
		gfn_Alert("작년 데이터를 수정할 수 없습니다.");
		return;
	}
	
	if(gdProfesAssign.Editable == true) {
		if(nCell == 3) {	//과목명
			lfn_SearchSubjectListPopup(ds_ioProfesAssign.GetColumn(nRow, "LPCMGNO")		//과정관리번호
									, ds_ioProfesAssign.GetColumn(nRow, "LPSVERSION")	//과목버전
									, ds_ioProfesAssign.GetColumn(nRow, "LEDUGUBUN")	//교육과정구분[B:실무 T:강습]
									, nRow);
		}
		//trace("shjung : obj :: " + obj);
		if(nCell == 6) {	//교수명
			lfn_SearchProfessorListPopup(nRow);
		}
		if(nCell == 12) {	// 교수추가
			var rIdx = ds_ioProfesAssign.InsertRow(nRow+1);
			ds_ioProfesAssign.copyrow(rIdx,ds_ioProfesAssign,nRow);	// 클릭한 추가버튼 위치의 행 복사			
			ds_ioProfesAssign.SetColumn(rIdx, "LPPFGUBUN"   , ""); //교수구분	
			ds_ioProfesAssign.SetColumn(rIdx, "LPPFGUBUNCD" , ""); //교수구분코드	
			ds_ioProfesAssign.SetColumn(rIdx, "LPPFSABUN"   , ""); //교수번호	
			ds_ioProfesAssign.SetColumn(rIdx, "LPPFNM"      , ""); //교수명	
			ds_ioProfesAssign.SetColumn(rIdx, "LPPFJIKWINM" , ""); //직위명	
			ds_ioProfesAssign.SetColumn(rIdx, "LPPFJIKWI"   , ""); //직위코드	
			ds_ioProfesAssign.SetColumn(rIdx, "LPSPEAKERPAY", ""); //강사료			
			ds_ioProfesAssign.SetColumn(rIdx, "LPSOSOK"     , ""); //소속
			ds_ioProfesAssign.SetColumn(rIdx, "LPSEQ", ds_ioProfesAssign.RowCount()); //강의교수배정순번			
			//trace(ds_ioProfesAssign.savexml());
		}
		if(nCell == 13) {	// 교수삭제		
			ds_ioProfesAssign.DeleteRow(nRow);		
		}
	}	
}


/*
 * 기능 : 과목목록 팝업을 호출한다.
 * parameter : sCourse - 직능
 *           : sMGubun - 면제구분
 *           : sEGubun - 교육과정구분
 *           : sVGubun - 과목버전
 *           : nRow - 해당로우
 * return value : 과목 정보를 가진 배열 오브젝트
 */
function lfn_SearchSubjectListPopup(sLPCMGNO, sLPSVERSION, sLEDUGUBUN, nRow) {
    var sArg  = "sLPCMGNO=" + quote(sLPCMGNO);
		sArg += " sLPSVERSION=" + quote(sLPSVERSION);
		sArg += " sLEDUGUBUN=" + quote(sLEDUGUBUN);
		
    var arrSubjectInfo = Dialog("profes::frmprofes0005P01SubjectList.xml", sArg, 600, 400, "", -1, -1);
    
    if (length(arrSubjectInfo) > 0) {
        ds_ioProfesAssign.SetColumn(nRow, "LPPSSEQ", arrSubjectInfo[0]); //과목순번
        ds_ioProfesAssign.SetColumn(nRow, "PSTITLE", arrSubjectInfo[1]); //과목명
        ds_ioProfesAssign.SetColumn(nRow, "LPSVERSION", arrSubjectInfo[2]); //과목버전
    }
}


/*
 * 기능 : 교수목록 팝업을 호출한다.
 * parameter : 없음
 * return value : 교수 정보를 가진 배열 오브젝트
 */
function lfn_SearchProfessorListPopup(nRow) {
	
	var sArg  = "sGUBUN=" + quote(dsParentObj.GetColumn(dsParentObj.currow, "EDUGUBUN"));	//교육구분(강습:T, 실무:B)
		sArg += " sDATE=" + quote(ds_ioProfesAssign.GetColumn(nRow, "LTEDUDATE"));			//교육일자
		sArg += " sJIBU=" + quote(ds_ioProfesAssign.GetColumn(nRow, "LGTMGNO"));			//교육지부
		
    var arrProfessorInfo = Dialog("profes::frmprofes0005P02ProfessorList.xml", sArg, 568, 400, "", -1, -1);
    if (length(arrProfessorInfo) > 0) {
        ds_ioProfesAssign.SetColumn(nRow, "LPPFGUBUN"   , arrProfessorInfo[0]); //교수구분
        ds_ioProfesAssign.SetColumn(nRow, "LPPFGUBUNCD" , arrProfessorInfo[1]); //교수구분코드
        ds_ioProfesAssign.SetColumn(nRow, "LPPFSABUN"   , arrProfessorInfo[2]); //교수번호
        ds_ioProfesAssign.SetColumn(nRow, "LPPFNM"      , arrProfessorInfo[3]); //교수명
        ds_ioProfesAssign.SetColumn(nRow, "LPPFJIKWINM" , arrProfessorInfo[4]); //직위명
        ds_ioProfesAssign.SetColumn(nRow, "LPPFJIKWI"   , arrProfessorInfo[5]); //직위코드
        ds_ioProfesAssign.SetColumn(nRow, "LPSPEAKERPAY", arrProfessorInfo[6]); //강사료        
        ds_ioProfesAssign.SetColumn(nRow, "LPSOSOK"     , arrProfessorInfo[7]); //소속
    }
}

function btnSave_OnClick(cFlag)
{
	// 버튼이벤트 발생전, 선택된 로우가 위험물관리자 ( 대리자/교육희망자 ) 신청건이면
	// 버튼이벤트가 발생하지 않도록 처리한다 2023.03.31
	inf_edutypecheck();
	if (returnval == 1) {
		btnsave.Enable = false;
        return false; 
    }   
	
	if(parent.ds_ioStudyCourse.GetColumn(parent.ds_ioStudyCourse.currow, "EDUYEAR") < "2024")
	{
		gfn_Alert("작년 데이터를 수정할 수 없습니다.");
		return;
	}
	
	lfn_Save(cFlag);
}
 ]]></Script>
</Window>