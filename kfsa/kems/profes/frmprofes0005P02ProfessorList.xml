<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="400" Id="frmprofes0005P02ProfessorList" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="교육교수목록팝업" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="648" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_oProfessorList">
				<Contents>
					<colinfo id="GPCLASSCD" size="2" summ="default" type="STRING"/>
					<colinfo id="GPTEAMCD" size="4" summ="default" type="STRING"/>
					<colinfo id="GTDEPTNM" size="20" summ="default" type="STRING"/>
					<colinfo id="GTPRTSEQ" size="3" summ="default" type="STRING"/>
					<colinfo id="GTTEAMNM" size="70" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="1" summ="default" type="STRING"/>
					<colinfo id="JIBU" size="4" summ="default" type="STRING"/>
					<colinfo id="JIKWI" size="50" summ="default" type="STRING"/>
					<colinfo id="JIKWICD" size="2" summ="default" type="STRING"/>
					<colinfo id="MGNO" size="40" summ="default" type="STRING"/>
					<colinfo id="NAME" size="20" summ="default" type="STRING"/>
					<colinfo id="SPAY" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SOSOK" size="256" summ="default" type="STRING"/>
					<colinfo id="LTIME" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUNCD" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD></CD>
						<DATA>전체</DATA>
					</record>
					<record>
						<CD>1</CD>
						<DATA>전임</DATA>
					</record>
					<record>
						<CD>2</CD>
						<DATA>겸임</DATA>
					</record>
					<record>
						<CD>3</CD>
						<DATA>초빙강사</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oJibu">
				<Contents>
					<colinfo id="JJIBUCD" size="256" summ="default" type="STRING"/>
					<colinfo id="JJIBUNM" size="256" summ="default" type="STRING"/>
					<colinfo id="USE_YN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oProfessorList_0">
				<Contents>
					<colinfo id="GUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="GUBUNCD" size="1" summ="default" type="STRING"/>
					<colinfo id="JIBUCD" size="4" summ="default" type="STRING"/>
					<colinfo id="JIKWICD" size="2" summ="default" type="STRING"/>
					<colinfo id="JIKWINM" size="50" summ="default" type="STRING"/>
					<colinfo id="NAME" size="20" summ="default" type="STRING"/>
					<colinfo id="SABUN" size="40" summ="default" type="STRING"/>
					<colinfo id="PAY" size="256" summ="default" type="STRING"/>
					<colinfo id="JIBUCDNM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oAllJibu">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<colinfo id="USE_YN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Static Align="Center" Height="20" Id="lbProfesName" Left="4" Style="sty_Label" TabOrder="7" Text="교수명" Top="8" UserData="S" VAlign="Middle" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="JJIBUCD" DataColumn="JJIBUNM" Editable="TRUE" Height="20" Id="cbxJibu" INDEX="0" InnerDataset="ds_oJibu" Left="567" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="10" Top="31" UserData="I" Visible="FALSE" Width="77"></Combo>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_oProfessorList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="396" ColSizing="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="340" Id="gdProfessorList" InputPanel="FALSE" Left="4" LineColor="default" MinWidth="100" OnCellDBLClick="gdProfessorList_OnCellDblClick" OnHeadClick="lfn_SortGrid_OnHeadClick" OnKeyDown="gdProfessorList_OnKeyDown" Right="644" RowHeight="20" Style="sty_Grid" TabOrder="4" TabStop="true" Top="56" UseDBuff="true" UsePopupMenu="true" UserData="교수목록" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="640">
			<contents>
				<format id="Default">
					<columns>
						<col width="70"/>
						<col width="70"/>
						<col width="90"/>
						<col width="66"/>
						<col width="60"/>
						<col width="60"/>
						<col width="60"/>
						<col width="60"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" rowspan="2" text="구분"/>
						<cell align="center" col="1" display="text" rowspan="2" text="교수명"/>
						<cell col="2" display="text" rowspan="2" text="생년월일"/>
						<cell col="3" display="text" rowspan="2" text="직위"/>
						<cell col="4" display="text" rowspan="2" text="소속"/>
						<cell align="center" col="5" display="text" rowspan="2" text="지부"/>
						<cell align="center" col="6" display="text" rowspan="2" text="년간강의&#10;허용시간"/>
						<cell align="center" col="7" display="text" rowspan="2" text="총강의&#10;시간"/>
					</head>
					<body>
						<cell align="center" col="0" colid="GUBUN" display="text"/>
						<cell align="center" col="1" colid="NAME" display="normal"/>
						<cell col="2" colid="SBIRTHDAY" display="text" displaymaskchar="y" Mask="@@@@-@@-@@"/>
						<cell align="left" col="3" colid="JIKWI" display="text"/>
						<cell col="4" colid="SOSOK" display="text"/>
						<cell align="center" col="5" colid="GTDEPTNM" display="text"/>
						<cell align="right" col="6" colid="LLIMITTIME" display="number" expr='iif(GUBUNCD==&apos;3&apos;,&#32;LLIMITTIME,&#32;&quot;&quot;)'/>
						<cell align="right" col="7" colid="LTIME" display="number"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="292" LineColor="user14" Right="644" TabOrder="61" Top="1" Type="Rectangle" Width="352"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSelect" ImageID="BTN_TEXT_COM" Left="382" OnClick="btnSelect_OnClick" Style="sty_Button" TabOrder="2" Text="선택" ToolTipText="선택" Top="4" Transparent="TRUE" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSearch" ImageID="BTN_COM_SEARCH" Left="296" OnClick="lfn_Search" Style="sty_Button" TabOrder="1" ToolTipText="조회" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="556" OnClick="lfn_End" Style="sty_Button" TabOrder="3" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbGubun" Left="4" Style="sty_Label" TabOrder="6" Text="구분" Top="32" UserData="S" VAlign="Middle" Width="88"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edProfesName" ImeMode="native" Left="96" LeftMargin="2" MaxLength="20" OnCharChanged="edProfesName_OnCharChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="edProfesName_OnKeyDown" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_Edit" TabOrder="8" Top="8" UserData="S" Width="80"></Edit>
		<Radio Border="Flat" CodeColumn="CD" ColumnCount="4" DataColumn="DATA" Height="20" Id="radGubun" INDEX="0" InnerDataset="ds_oGubun" Left="96" LeftMargin="4" OnChanged="radGubun_OnChanged" OnKeyDown="gfn_EnterNextFocus" RightMargin="4" Style="sty_Radio" TabOrder="9" Top="32" UserData="S" Width="250"></Radio>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnCancel" ImageID="BTN_TEXT_COM" Left="469" OnClick="btnCancel_OnClick" Style="sty_Button" TabOrder="11" Text="선택취소" ToolTipText="선택취소" Top="4" Transparent="TRUE" Width="85"></Button>
		<Checkbox FalseValue="N" Height="20" Id="chkOtherJibu" Left="436" OnClick="chkOtherJibu_OnClick" OnKeyDown="gfn_EnterNextFocus" Style="sty_Checkbox" TabOrder="12" Text="전지부" Top="32" TrueValue="Y" UserData="S" Value="FALSE" Width="72"></Checkbox>
		<Static Align="Center" Height="20" Id="lbJibu" Left="512" Style="sty_Label" TabOrder="13" Text="지부" Top="32" VAlign="Middle" Visible="FALSE" Width="52"></Static>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmprofes0005P02ProfessorList.xml
 * 설명 : 교수목록팝업
 * 작성일 : 2009.11.12
 * 작성자 : 김은규
 */

#include "LIB::COMMON.js"; // 공통 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
    //gfn_SearchAllJibu(cbxJibu, "Y"); // 지부 코드 조회
    
    lfn_SearchMainOfficeAllJibu(obj); // 본회 및 전지부 조회
    

    if (!(IsExistVar("sGUBUN") && IsExistVar("sDATE") && IsExistVar("sJIBU"))) {
        gfn_Alert("강의실적 정보가 부족합니다.");
        Close();
    }
    
    lfn_Search();
    edProfesName.SetFocus();
}

function Form_OnUnloadCompleted(obj) {
    Close();
}

function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
    switch (nChar) {
        case 27 : // 종료(Esc)
            lfn_End();
            break;
        case 113 : // 조회(F2)
            lfn_Search();
            break;
    }
}

function lfn_SearchMainOfficeAllJibu(obj) {

    ds_oJibu.ClearData(); // 데이타셋 초기화
    tit_clearActionInfo();
	tit_addSearchActionInfo("com:searchMainOfficeAllJibu", false);
	// 서버 호출 
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_oJibu=ds_oJibu"	// outDs
		,""
		,""
		,false
		
		,false
		
		,true
	);

	ds_oJibu.InsertRow(0);
    ds_oJibu.SetColumn(0, "JJIBUCD", "");
    ds_oJibu.SetColumn(0, "JJIBUNM", "전체");

	//alert(Object("ds_oJibu").SaveXML());
}


/*
 * 기능 : 조회
 */
function lfn_Search(obj) {
	var sEDUGUBUN = "2";	//강습교육
	if(sGUBUN == "B") sEDUGUBUN = "1";	//실무교육
	
    ds_oProfessorList.ClearData(); // 데이타셋 초기화

    tit_clearActionInfo();
	//tit_addCsvSearchActionInfo("profes:searchProfes0005ProfessorList", false);
	tit_addSearchActionInfo("profes:searchProfes0005ProfessorList", false);
	// 서버 호출 
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_oProfessorList=ds_oProfessorList"	// outDs
		,"GUBUN=" + quote(radGubun.Value) // 구분
		 + " NAME=" + quote(edProfesName.Text)	// 교수명
		 + " OTHERJIBUYN=" + quote(chkOtherJibu.Value)	// 타지부 체크
		 + " OTHERJIBU=" + quote(cbxJibu.Value)	// 타지부
		 + " EDUGUBUN=" + quote(sEDUGUBUN)	//교육구분
		 + " EDUDATE=" + quote(sDATE)	//교육일자
		 + " EDUJIBU=" + quote(sJIBU)	//교육지부
		,"lfn_AfterSearchProfessorList"
		,false
	);
}

/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close();
}
/* 공통 필수 종료 */

/* 사용자 함수 */
/*
 * 기능 : 조회 후 처리해야 할 내용
 * parameter : nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterSearchProfessorList(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    gfn_SearchMessage(gdProfessorList); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
}

/* 사용자 이벤트 함수 */
function lfn_SortGrid_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {
    var lobj_Dataset = object(obj.BindDataset);
    // 데이터가 있는 경우 해당 컬럼을 기준으로 정렬한다.
    if (lobj_Dataset.GetRowCount() > 1) {
        gfn_GridCellSort(obj, nCell); // 해당 셀정렬을 호출한다.
    }
}

function btnSelect_OnClick(obj)
{

	var LLIMITTIME = toNumber(ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "LLIMITTIME")); // 년간 강의허용시간
	//var LLIMITTIME = 27;
	var MLLIMITTIME = toNumber(LLIMITTIME)-5;
	var REMAININGTIME = (LLIMITTIME - toNumber(MLLIMITTIME));
	var LTIME = toNumber(ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "LTIME"));

	// 초빙강사의 경우 연간 강의허용시간이 5시간 이내로 남았을 경우 안내메시지 알림
	if (ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "GUBUNCD") == "3") {

		if (toNumber(LTIME) >= toNumber(MLLIMITTIME)) {
		
			if(toNumber(REMAININGTIME) > 0)
			{
				gfn_Alert(ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "NAME")+" 초빙강사는 연간 강의허용시간("+ LLIMITTIME+"시간)이 \n5시간 이내로 남았습니다. 남은 시간은 "+REMAININGTIME+"시간 입니다.");
			}
			else {
				// 초빙강사의 경우 연간 강의허용시간을 초과하여 강의할 수 없다.
				gfn_Alert(ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "NAME")+" 초빙강사는 연간 강의허용시간("+ LLIMITTIME+"시간)을 초과하여 강의실적을 등록할 수 없습니다.");
				return false;
			}		
		}		
	}

	
    var arrArg = Array(8);
		arrArg[0] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "GUBUN"); // 교수구분
		arrArg[1] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "GUBUNCD"); // 교수구분코드
		arrArg[2] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "MGNO"); // 교수번호
		arrArg[3] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "NAME"); // 교수명
		arrArg[4] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "JIKWI"); // 직위명
		arrArg[5] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "JIKWICD"); // 직위코드
		arrArg[6] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "SPAY"); // 초빙 강사료
		
		arrArg[7] = ds_oProfessorList.GetColumn(ds_oProfessorList.currow, "SOSOK"); // 소속
		Close(arrArg);
}

function gdProfessorList_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
    btnSelect_OnClick(obj);
}

function edProfesName_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if (nChar == 13) {
        lfn_Search();
        
        gdProfessorList.SetFocus();
	}
	

}

function btnCancel_OnClick(obj)
{
	var arrArg = Array(7);
		arrArg[0] = null; // 교수구분
		arrArg[1] = null; // 교수구분코드
		arrArg[2] = null; // 교수번호
		arrArg[3] = null; // 교수명
		arrArg[4] = null; // 직위명
		arrArg[5] = null; // 직위코드
		arrArg[6] = null; // 초빙 강사료
		Close(arrArg);
}

// 타지부 선택
function chkOtherJibu_OnClick(obj,strValue)
{
	if(strValue == "Y") {
		lfn_OtherJibu(false);
	} else {
		lfn_OtherJibu(true);
	}
}

// 타지부 선택
function lfn_OtherJibu(bStatus) {
	if(bStatus == false) {
		radGubun.Index = 0;
		cbxJibu.Index = 0;

		cbxJibu.Visible = true;
		lbJibu.Visible = true;
	} else {
		cbxJibu.Visible = false;
		lbJibu.Visible = false;
	}
	radGubun.Enable = bStatus;
}

// 구분 변경시 조회
function radGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	lfn_Search();
}



function gdProfessorList_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	if (nChar == 13) {
		btnSelect_OnClick();
	}
}

function edProfesName_OnCharChanged(obj,strPreText,strPostText)
{

	if (length(strPreText) > 0) {
	
		chkOtherJibu.Value = "Y";
	
		chkOtherJibu_OnClick(chkOtherJibu, "Y");	
	
	} else {
	
		chkOtherJibu.Value = "N";
	
		chkOtherJibu_OnClick(chkOtherJibu, "N");	
	
	}
	
}
]]></Script>
</Window>