<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="590" Id="frmtraining0620MExamFailPassDiplomaPrint" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="불합격자수료증출력" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioExamList">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oRepeatNo">
				<Contents>
					<colinfo id="SSHEOMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SSHREPEATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SSHSENDYN" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_iPassGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>N</CD>
						<DATA>불합격</DATA>
					</record>
					<record>
						<CD>X</CD>
						<DATA>미응시</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioReport"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioExamFailList">
				<Contents>
					<colinfo id="SEL" size="255" summ="default" type="STRING"/>
					<colinfo id="EJMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="EJTPMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="EJPERSONNM" size="255" summ="default" type="STRING"/>
					<colinfo id="BIRTHDAY" size="255" summ="default" type="STRING"/>
					<colinfo id="EJLASTSUNAPGUBUN" size="255" summ="default" type="STRING"/>
					<colinfo id="EJZZIPCD" size="255" summ="default" type="STRING"/>
					<colinfo id="EJADDR1" size="255" summ="default" type="STRING"/>
					<colinfo id="EJADDR2" size="255" summ="default" type="STRING"/>
					<colinfo id="EJBULDNM" size="255" summ="default" type="STRING"/>
					<colinfo id="EJBULDADDR" size="255" summ="default" type="STRING"/>
					<colinfo id="EJEXPYN" size="255" summ="default" type="STRING"/>
					<colinfo id="EJPASSYN" size="255" summ="default" type="STRING"/>
					<colinfo id="EJCANCELREASON" size="255" summ="default" type="STRING"/>
					<colinfo id="EJCANCELPSABUN" size="255" summ="default" type="STRING"/>
					<colinfo id="EJIIIMGSEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="ERAPLEXAMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="EOTCCOURSECD" size="255" summ="default" type="STRING"/>
					<colinfo id="TPPASSNO" size="255" summ="default" type="STRING"/>
					<colinfo id="TPSTARTDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="TPENDDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="TCTERMTIME" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioReportFilter"></Dataset>
		</Datasets>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="357" LineColor="user14" Right="796" TabOrder="61" Top="1" Type="Rectangle" Width="439"></Shape>
		<Shape Bottom="88" Height="56" Id="shpGubunBox" Left="3" LineColor="user15" Right="795" TabOrder="11" Top="32" Type="Rectangle" Width="792"></Shape>
		<Div BKColor="user0" Height="28" Id="divWorkFormTitle" OnLoadCompleted="Form_OnLoadCompleted" Style="sty_Form" TabOrder="8" TabStop="FALSE" Text="Div0" Url="COM::frmCOM0100SWorkFormTitle.xml" Width="180">
			<Contents></Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoSelect="TRUE" BindDataset="ds_ioExamFailList" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="584" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="Flat" HeadHeight="20" Height="436" Id="gdExamFail" InputPanel="FALSE" Left="4" LineColor="default" MinWidth="100" OnHeadClick="gdExamFail_OnHeadClick" Right="796" RowHeight="20" Style="sty_Grid" TabOrder="7" TabStop="true" Top="148" UseDBuff="true" UsePopupMenu="true" UserData="불합격자목록" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="792">
			<contents>
				<format id="Default">
					<columns>
						<col width="29"/>
						<col width="67"/>
						<col width="70"/>
						<col width="128"/>
						<col width="283"/>
						<col width="210"/>
					</columns>
					<head>
						<cell align="center" col="0" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="접수번호"/>
						<cell align="center" col="2" display="text" text="성명"/>
						<cell align="center" col="3" display="text" text="생년월일"/>
						<cell align="center" col="4" display="text" text="주소1"/>
						<cell align="center" col="5" display="text" text="주소2"/>
					</head>
					<body>
						<cell align="center" col="0" colid="SEL" display="expr:iif(SEL&#32;==&#32;&apos;X&apos;,&#32;&apos;null&apos;,&#32;&apos;checkbox&apos;)" edit="expr:iif(SEL&#32;==&#32;&apos;X&apos;,&#32;&apos;null&apos;,&#32;&apos;checkbox&apos;)"/>
						<cell align="center" col="1" colid="ERAPLEXAMNO" display="combo"/>
						<cell align="center" col="2" colid="EJPERSONNM" display="text"/>
						<cell align="center" col="3" colid="BIRTHDAY" display="combo"/>
						<cell align="left" col="4" colid="EJADDR1" display="text"/>
						<cell align="left" col="5" colid="EJADDR2" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btnMutilSort" ImageID="BTN_MULTI_SORT" Left="720" OnClick="btnMutilSort_OnClick" Style="sty_Button" TabOrder="6" Top="124" Transparent="TRUE" Width="74"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnToExcel" ImageID="BTN_COM_EXCEL" Left="191" OnClick="lfn_Excel" Style="sty_Button" TabOrder="2" ToolTipText="엑셀로&#32;저장" Top="4" Visible="FALSE" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrintScreen" ImageID="BTN_COM_SCREEN" Left="534" OnClick="lfn_PrintScreen" Style="sty_Button" TabOrder="3" ToolTipText="화면&#32;출력" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="621" OnClick="lfn_End" Style="sty_Button" TabOrder="4" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSearch" ImageID="BTN_COM_SEARCH" Left="360" OnClick="lfn_Search" Style="sty_Button" TabOrder="1" ToolTipText="조회" Top="4" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbExamNm" Left="7" Style="sty_Label" TabOrder="9" Text="시험명" Top="36" VAlign="Middle" Width="88"></Static>
		<List BindDataset="ds_ioExamList" Border="Flat" CodeColumn="EOMGNO" DataColumn="EXAMNM" Height="48" Id="lstExamList" InnerDataset="ds_ioExamList" Left="99" OnChanged="lstExamList_OnChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Style="sty_List" TabOrder="5" Top="36" UserData="S" Width="692"></List>
		<Shape Bottom="120" Height="28" Id="Shape0" Left="3" LineColor="user15" Right="795" TabOrder="12" Top="92" Type="Rectangle" Width="792"></Shape>
		<Static Align="Center" Height="20" Id="lbRepeatNo" Left="191" Style="sty_Label" TabOrder="13" Text="평가차수" Top="96" VAlign="Middle" Visible="FALSE" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="SSHREPEATNO" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxRepeatNo" INDEX="0" InnerDataset="ds_oRepeatNo" Left="282" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="14" Top="95" UserData="S" Visible="FALSE" Width="90"></Combo>
		<Static Align="Center" Height="20" Id="lbPassGubun" Left="7" Style="sty_Label" TabOrder="15" Text="대상자" Top="96" VAlign="Middle" Width="88"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Editable="TRUE" Height="20" Id="cbxPassGubun" INDEX="0" InnerDataset="ds_iPassGubun" Left="98" OnChanged="cbxPassGubun_OnChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="16" Top="95" UserData="S" Width="90"></Combo>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrint" ImageID="BTN_COM_PRINT" Left="447" OnClick="lfn_Print" Style="sty_Button" TabOrder="17" ToolTipText="출력" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnNext" ImageID="BTN_TEXT_COM" Left="708" OnClick="btnNext_OnClick" Style="sty_Button" TabOrder="18" Text="다음&#32;▶" Top="4" Transparent="TRUE" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbTotalCnt" Left="3" Style="sty_LabelStat" TabOrder="20" Text="불합격자수" Top="124" VAlign="Middle" Width="88"></Static>
		<MaskEdit AutoSelect="TRUE" AutoSkip="TRUE" Border="Flat" Enable="FALSE" Height="20" Id="medTotalCnt" Left="95" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" Readonly="TRUE" Style="sty_Edit" TabOrder="19" Top="124" UserData="S" Width="88"></MaskEdit>
		<Static Height="20" Id="lbTextBlue" Left="184" Style="sty_TextBlue" TabOrder="21" Text="※&#32;재시험&#32;응시자는&#32;수료증을&#32;출력할&#32;수&#32;없습니다." Top="124" VAlign="Middle" Width="292"></Static>
	</Form>
	<Script><![CDATA[/*

 * 프로그램명 : frmtraining0620MExamFailPassDiplomaPrint.xml

 * 설명 : 불합격자수료증출력

 * 작성일 : 2009.10.20

 * 작성자 : 김동현

 * 수정자 : 전윤호 (강습직능 영향도 및 SQL분석) 2022/09/29 
 
 */



#include "LIB::training.js"; // 공통업무 관련



var li_ExamMgno; // 시험 회차 관리번호



/* 공통 필수 시작 */

function Form_OnLoadCompleted(obj) {

    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리



    // 폼 환경설정

    ls_SystemGubun = gs_SystemGubun;

    ls_SystemMenuId = gs_SystemMenuId;

    var ls_FormId = split(sFormUrl, "::");

    ls_FormId = split(ls_FormId[1], ".");

    obj.Title = sFormTitle + "(" + ls_FormId[0] + ")";



    gfn_MakeRequiredInputMark(this); // 필수 입력란을 설정한다.



    ms_FormAuth = gfn_GetFormAuth(this); // 권한을 조회한다.

    if (ms_FormAuth == "W") { // 권한에 따른 버튼 설정

        lfn_SetFormAuth(true); // 저장 권한

    } else if (ms_FormAuth == "R") {

        lfn_SetFormAuth(false); // 읽기 권한

    } else {

        gfn_Alert(MSGI00080);

        close();

    }

    

    // 시험명 가져오기

    ds_ioExamList.ClearData();

    ldb.Sync = true;

    ds_ioExamList.Load("SvcLdb::searchExamOrderList.xml");

    ldb.Sync = false;

    

    li_ExamMgno = ds_ioExamList.GetColumn(0, "EOMGNO");

    lfn_GetRepeatNo(li_ExamMgno);



}



function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {

    // to do

    gfn_Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam); // 공통 키 이벤트 처리

}



function Form_OnSize(obj,nCx,nCy,nState) {

    if (gs_IsResizingForm == "Y") {

        gdExamFail.Height = nCy - gdExamFail.Top - 4;

    }

}



/**

 * 시험 선택 시 정보저장

 */

function lstExamList_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {



	li_ExamMgno = lstExamList.Value;

	lfn_GetRepeatNo(strCode);

}



/**

 * 대상자 선택

 */

function cbxPassGubun_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {

    lbTotalCnt.Text = cbxPassGubun.Text + "자수";

}



/**

 * 평가차수 가져오기

 */

function lfn_GetRepeatNo(strCode) {

    ds_oRepeatNo.ClearData();

    ldb.Sync = true;

    Transaction("SearchRepeatNo"

        , "SvcLdb::searchRepeatNo.xml"

        , ""

        , "ds_oRepeatNo=output"

        , "APEOMGNO=" + quote(li_ExamMgno)

        , "fn_callBack");

    ldb.Sync = false;

    

    ds_oRepeatNo.InsertRow(0);

    ds_oRepeatNo.SetColumn(0, "SSHREPEATNO", "0");

    ds_oRepeatNo.SetColumn(0, "DATA", "최종차수");

    cbxRepeatNo.Value = "0";

        

    if (ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "10"

        || ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "21"
        
        || ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "22"
        
        || ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "23"
        
        || ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "50"
        
        || ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "51"
        
        || ds_ioExamList.GetColumn(ds_ioExamList.FindRow("EOMGNO", strCode), "TCCOURSECD") == "53"

    ) {

        cbxRepeatNo.Visible = false;

        lbRepeatNo.Visible = false;

    } else {

        cbxRepeatNo.Visible = true;

        lbRepeatNo.Visible = true;

    }



}



/*

 * 기능 : 조회

 */

function lfn_Search(obj) {



    ds_ioExamFailList.ClearData(); // 데이타셋 초기화



    ldb.Sync = true;

    transaction("select"

        ,"SvcLdb::searchExamFail.xml"

        ,""

        ,"ds_ioExamFailList=output"

        ,"EOMGNO=" + quote(li_ExamMgno)

            + " ERREPEATNO=" + quote(cbxRepeatNo.Value)

            + " ERPASSYN=" + quote(cbxPassGubun.Value)

        ,"");

    ldb.Sync = false;



    medTotalCnt.Value = ds_ioExamFailList.GetRowCount();



}

/* 공통 필수 종료 */



/* 사용자 함수 */



/*

 * 기능 : 버튼 활성/비활성시킨다.

 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)

 * return : 없음

 */

function lfn_SetFormAuth(bStatus) {



}



/* 사용자 이벤트 함수 */

function btnMutilSort_OnClick(obj) {

	gfn_GridMultiSort(gdExamFail, 1); // 멀티 정렬을 실행한다.

}



function gdExamFail_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {

	var lobj_Dataset = object(obj.BindDataset);

	if (nCell == 0) { // 선택

        if (obj.GetCellProp("head", nCell, "text") == 1) { // 전체가 이미 선택된 경우

            obj.SetCellProp("head", nCell, "text", 0);

            for(i = 0; i < lobj_Dataset.RowCount(); i++) {

//                if (lobj_Dataset.GetColumn(i, "SEL") != "X") {

                    lobj_Dataset.SetColumn(i, "SEL", "0");

//                }

            }

        } else { // 전체가 이미 선택되지 않은 경우

            obj.SetCellProp("head", nCell, "text", 1);

            for(i = 0; i < lobj_Dataset.RowCount(); i++) {

//                if (lobj_Dataset.GetColumn(i, "SEL") != "X") {

                    lobj_Dataset.SetColumn(i, "SEL", "1");

//                }

            }

        }

	} else { // 헤드 정렬

        lfn_SortGrid_OnHeadClick(obj,nCell,nX,nY,nPivotIndex);

	}

}



function lfn_Print(obj) {

	if(!gfn_CheckChangedGrid(this)){  //선택한것이 있는지 체크 메세지 보임

        alert("출력할 인원을 선택해 주십시오.");      

        return false;

    }

    

    ds_ioExamFailList.Filter("SEL = '1'");

    ds_ioReport.copyf(ds_ioExamFailList);

 

    if (!Confirm("총 " + ds_ioReport.GetRowCount() + "건의 수료증이 출력됩니다. 출력 하시겠습니까? ")) { //  출력전 확인 메시지

        ds_ioExamFailList.UnFilter();

        return false;

	}

	if (ds_ioReport.GetColumn(0, "EOTCCOURSECD") < "50") {
	
		gfn_PrintReport("frmtraining0280R02DiplomaWarrant.rex", "ds_ioReport", "","","", false);
		
	} else if (ds_ioReport.GetColumn(0, "EOTCCOURSECD") >= "50") {
	
		gfn_PrintReport("frmtraining0280R06LifeSafetyDiplomaWarrant.rex", "ds_ioReport", "","","", false);
		
	}


    for(i = 0; i < ds_ioReport.GetRowCount(); i++) {

        ds_ioExamFailList.SetColumn(i, "SEL", "0");

    }



    ds_ioExamFailList.UnFilter();


}



/**

 * 채점결과전송화면

 */

function btnNext_OnClick(obj) {

    var ls_MenuId = "0000000089";

    var ls_MenuTitle = "채점결과전송";

    var ls_MenuUrl = "training::frmtraining0630MExamMarkingResultSend.xml";



    gs_SystemGubun = "training";

    gs_SystemMenuId = "0000000003";

    global.mnuLeft.tabMenu.tabpgMenu.Text = "강습관리";



    global.mnuTop.tabTopMenu.TabIndex = gds_oTopMenu.FindRow("MSYSGUBUN", gs_SystemGubun);

    gfn_OpenChildWindow(ls_MenuUrl, ls_MenuTitle, ls_MenuId);

}
function Form_OnActivate(obj)
{
	gs_SysID = "[stm_01,bsn_4000,dsc_0018]";	// 개인정보접속기록 시스템ID 
}
]]></Script>
</Window>