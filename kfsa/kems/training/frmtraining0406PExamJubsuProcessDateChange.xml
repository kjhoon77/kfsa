<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="184" Id="frmtraining0025PTrainingJubsuProcessDateChange" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="결제처리일자변경팝업" Top="8" Ver="1.0" Width="572" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_oChangeDate">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oBankSunapGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>0</CD>
						<DATA>방문(직납)</DATA>
					</record>
					<record>
						<CD>4</CD>
						<DATA>방문(은납)</DATA>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Static Height="72" Id="lbAfter" Left="4" Style="sty_Groupbox" TabOrder="7" Text="&#32;변경&#32;후&#32;" Top="108" Type="Groupbox" VAlign="Middle" Width="564"></Static>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="390" LineColor="user14" Right="568" TabOrder="61" Top="1" Type="Rectangle" Width="178"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="480" OnClick="lfn_End" Style="sty_Button" TabOrder="5" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSave" ImageID="BTN_TEXT_COM" Left="393" OnClick="lfn_Save" Style="sty_Button" TabOrder="4" Text="변경(F4)" ToolTipText="변경" Top="4" Width="85"></Button>
		<Static Height="72" Id="lbBefore" Left="4" Style="sty_Groupbox" TabOrder="8" Text="&#32;변경&#32;전&#32;" Top="28" Type="Groupbox" VAlign="Middle" Width="564"></Static>
		<Static Align="Center" Height="20" Id="lbBeforeProcDate" Left="8" Style="sty_Label" TabOrder="12" Text="처리일자" Top="48" VAlign="Middle" Width="100"></Static>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" Enable="FALSE" HeaderFont="돋음,10,Bold" Height="20" Id="calBeforeProcDate" Left="112" OnFocus="gfn_ComponentOnFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="9" Top="48" UserData="I:처리일자" WeeksFont="돋음,9" Width="98"></Calendar>
		<Edit Align="CENTER" AutoSelect="TRUE" BKColor="#568eb7" Border="None" Cursor="HELP" DisableColor="white" Height="20" Id="edBeforePonyDate" ImeMode="native" Left="224" LeftMargin="2" OnFocus="edPonyDate_OnFocus" Readonly="TRUE" Style="sty_Label" TabOrder="13" Text="정산일자" ToolTipText="방문(직납&#32;OR&#32;은납(통장))에&#32;돈을&#32;입금받은&#32;날짜" Top="48" Width="100"></Edit>
		<Checkbox Enable="FALSE" Height="20" Id="chkBeforePonyDate" Left="328" Style="sty_Checkbox" TabOrder="10" Text="처리일과&#32;틀린&#32;경우" Top="48" Value="FALSE" Width="134"></Checkbox>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" Enable="FALSE" HeaderFont="돋음,10,Bold" Height="20" Id="calBeforePonyDate" Left="464" OnFocus="gfn_ComponentOnFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="11" Top="48" UserData="I:정산일자" WeeksFont="돋음,9" Width="98"></Calendar>
		<Static Align="Center" Height="20" Id="lbAfterProcDate" Left="8" Style="sty_Label" TabOrder="14" Text="처리일자" Top="128" VAlign="Middle" Width="100"></Static>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" HeaderFont="돋음,10,Bold" Height="20" Id="calAfterProcDate" Left="112" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="1" Top="128" UserData="I:처리일자" WeeksFont="돋음,9" Width="98"></Calendar>
		<Edit Align="CENTER" AutoSelect="TRUE" BKColor="#568eb7" Border="None" Cursor="HELP" DisableColor="white" Height="20" Id="edAfterPonyDate" ImeMode="native" Left="224" LeftMargin="2" OnFocus="edPonyDate_OnFocus" Readonly="TRUE" Style="sty_Label" TabOrder="15" Text="정산일자" ToolTipText="방문(직납&#32;OR&#32;은납(통장))에&#32;돈을&#32;입금받은&#32;날짜" Top="128" Width="100"></Edit>
		<Checkbox Height="20" Id="chkAfterPonyDate" Left="328" OnClick="chkAfterPonyDate_OnClick" OnKeyDown="gfn_EnterNextFocus" Style="sty_Checkbox" TabOrder="2" Text="처리일과&#32;틀린&#32;경우" Top="128" Value="FALSE" Width="134"></Checkbox>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" Enable="FALSE" HeaderFont="돋음,10,Bold" Height="20" Id="calAfterPonyDate" Left="464" OnFocus="gfn_ComponentOnFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="3" Top="128" UserData="I:정산일자" WeeksFont="돋음,9" Width="98"></Calendar>
		<Static Align="Center" Height="20" Id="lbBeforeBankSunapGubun" Left="8" Style="sty_Label" TabOrder="17" Text="수납방법" Top="72" VAlign="Middle" Width="100"></Static>
		<Radio Border="None" CodeColumn="CD" ColumnCount="2" DataColumn="DATA" Enable="FALSE" Height="20" Id="radBeforeBankSunapGubun" INDEX="0" InnerDataset="ds_oBankSunapGubun" Left="114" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="16" Top="73" Value="0" Width="208"></Radio>
		<Static Align="Center" Height="20" Id="lbAfterBankSunapGubun" Left="8" Style="sty_Label" TabOrder="19" Text="수납방법" Top="152" VAlign="Middle" Width="100"></Static>
		<Radio Border="None" CodeColumn="CD" ColumnCount="2" DataColumn="DATA" Enable="FALSE" Height="20" Id="radAfterBankSunapGubun" INDEX="0" InnerDataset="ds_oBankSunapGubun" Left="114" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="18" Top="153" Value="0" Width="208"></Radio>
	</Form>
	<Script><![CDATA[/*
 * 결제처리일자변경 : frmtraining0025PTrainingJubsuProcessDateChange.xml
 * 설명 : 결제처리일자변경팝업
 * 작성일 : 2009.09.16
 * 작성자 : 장성호
 */

#include "LIB::COMMON.js"; // 공통 관련

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
    
    calBeforeProcDate.Value = sProcDate;
    calAfterProcDate.Value = sProcDate;
    calBeforePonyDate.Value = sPonyDate;
    calAfterPonyDate.Value = sPonyDate;
    chkBeforePonyDate.Value = sPonyDateCheck;
    chkAfterPonyDate.Value = sPonyDateCheck;
    /* 수납방법
        10	방문현금
        11	방문카드
        12	방문현금영수증
        13	방문가상계좌
        14	방문무통장
        15	방문가상계좌현금영수증
        16	방문무통장현금영수증
    */
    radBeforeBankSunapGubun.Value = decode(sEsgubun, '14', '4', '16', '4', decode(left(sEsgubun, 1), '1', '0', '')); // 변경 전 수납방법
    radAfterBankSunapGubun.Value = decode(sEsgubun, '14', '4', '16', '4', decode(left(sEsgubun, 1), '1', '0', '')); // 변경 후 수납방법
    radAfterBankSunapGubun.Enable = decode(left(sEsgubun, 1), '1', true, false); // 변경 후 수납방법
}

function Form_OnUnloadCompleted(obj) {
    Close("END");
}

/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close("END");
}
/* 공통 필수 종료 */

/* 사용자 이벤트 함수 */

function lfn_Save(obj) {
    if (!gfn_FormValidate(this)) { // 입력 Validation Check
        return false;
    }
    
    if(calAfterProcDate.Value <= calAfterPonyDate.Value)
    {
		alert("정산일자는 처리일자 이전이어야 합니다. 확인후 다시 결재처리 하십시오. ");		
		calAfterPonyDate.SetFocus();
		return false;
    }

    if (sProcDate == left(calAfterProcDate.Value, 8)
                && sPonyDate == left(calAfterPonyDate.Value, 8)
                && sPonyDateCheck == chkAfterPonyDate.Value
                && radBeforeBankSunapGubun.Value == radAfterBankSunapGubun.Value
            ) {
        gfn_Alert("변경사항이 없습니다.");
        return false;
    }

    if (!gfn_Confirm("정말로 처리일자를 변경 하시겠습니까?")) {
        return false;
    }

    var sArg = "EJMGNO=" + quote(sEjmgno);
    sArg += " ESSEQ=" + quote(sSetlmtSeq);
    sArg += " ESPROCDATE=" + quote(left(calAfterProcDate.Value, 8));
    sArg += " ESPONYDATE=" + quote(left(calAfterPonyDate.Value, 8));
    sArg += " ESPONYGUBUN=" + quote(chkAfterPonyDate.Value);
    sArg += " ESPMYEAR=" + quote(sPmYear);
    sArg += " ESPMMGNO=" + quote(sPmMgno);
    if (left(sEsgubun, 1) == "1") { // 방문인 경우
        if (radAfterBankSunapGubun.Value == "0") { // 직납으로 변경한 경우
            sArg += " ESGUBUN=" + quote(decode(sEsgubun, '14', '10', '16', '12', '10'));
        } else { // 은납으로 변경한 경우
            sArg += " ESGUBUN=" + quote(decode(sEsgubun, '12', '16', '15', '16', '14'));
        }
    } else {
        sArg += " ESGUBUN=" + quote(sEsgubun);
    }
    
    tit_clearActionInfo();
    tit_addSingleActionInfo("training:executeExamProcDateChange", "", 0, "");

    tit_callService(
        ""
        ,""
        ,"" // inDs
        ,"ds_oChangeDate=ds_oChangeDate" // outDs
        ,sArg // args
        ,"lfn_AfterSaveProcDateChange"
        ,false
    );
}

/*
 * 기능 : Transaction 서비스 호출 후 처리해야 할 내용
 * parameter : strSvcID - 서비스ID
 *             nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterSaveProcDateChange(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    if (ds_oChangeDate.GetColumn(0, "RESULTCODE") == "OK") {
        gfn_Alert("정상적으로 변경되었습니다.");
        Close("OK");
    } else {
        gfn_ErrorMsg(ds_oChangeDate.GetColumn(0, "RESULTCODE"), ds_oChangeDate.GetColumn(0, "RESULTMSG"));
    }
}

function chkAfterPonyDate_OnClick(obj,strValue) {
	if (chkAfterPonyDate.Value == "1") {
        calAfterPonyDate.Enable = true;
	} else {
        calAfterPonyDate.Enable = false;
        calAfterPonyDate.Value = sPonyDate;
	}
}
]]></Script>
</Window>