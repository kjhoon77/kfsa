<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="104" Id="frmtraining0256PLicenseProcessDate" Left="8" OnKeyDown="Form_OnKeyDown" OnLoadCompleted="Form_OnLoadCompleted" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="결제처리일자변경팝업" Top="8" Ver="1.0" Width="276" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioSunapGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>0</CD>
						<DATA>방문(직납)</DATA>
					</record>
					<record>
						<CD>1</CD>
						<DATA>방문(은납)</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioProc">
				<Contents>
					<colinfo id="LSGUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="LSLHSEQ" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSLLCSNO" size="19" summ="default" type="STRING"/>
					<colinfo id="LSPONYDATE" size="8" summ="default" type="STRING"/>
					<colinfo id="LSPROCDATE" size="8" summ="default" type="STRING"/>
					<colinfo id="LSSEQ" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSPMMGNO" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="LSPMYEAR" size="4" summ="default" type="STRING"/>
					<colinfo id="LSPONYGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="93" LineColor="user14" Right="272" TabOrder="61" Top="1" Type="Rectangle" Width="179"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="184" OnClick="lfn_End" Style="sty_Button" TabOrder="2" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbProcDate" Left="4" Style="sty_Label" TabOrder="7" Text="처리일자" Top="32" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbPonyDate" Left="4" Style="sty_Label" TabOrder="8" Text="정산일자" Top="56" VAlign="Middle" Width="88"></Static>
		<Static Align="Center" Height="20" Id="lbSunapGubun" Left="4" Style="sty_Label" TabOrder="9" Text="수납방법" Top="80" VAlign="Middle" Width="88"></Static>
		<Checkbox FalseValue="0" Height="20" Id="chkPonyDate" Left="96" OnClick="chkPonyDate_OnClick" OnKeyDown="gfn_EnterNextFocus" Style="sty_Checkbox" TabOrder="4" Top="56" TrueValue="1" UserData="S" Value="FALSE" Width="16"></Checkbox>
		<Radio Border="None" CodeColumn="CD" ColumnCount="2" DataColumn="DATA" Height="20" Id="radSunapGubun" INDEX="0" InnerDataset="ds_ioSunapGubun" Left="96" OnKeyDown="gfn_EnterNextFocus" Style="sty_Radio" TabOrder="6" Top="80" UserData="S" Width="176"></Radio>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" HeaderFont="돋음,10,Bold" Height="20" Id="calProcDate" Left="96" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="3" Top="32" UserData="S" WeeksFont="돋음,9" Width="98"></Calendar>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" Enable="FALSE" HeaderFont="돋음,10,Bold" Height="20" Id="calPonyDate" Left="112" OnChanged="calPonyDate_OnChanged" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="5" Top="56" UserData="S" WeeksFont="돋음,9" Width="98"></Calendar>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSave" ImageID="BTN_COM_SAVE" Left="96" OnClick="lfn_Save" Style="sty_Button" TabOrder="1" ToolTipText="수정&#32;저장" Top="4" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*
 * 결제처리일자변경 : frmtraining0256PLicenseProcessDate.xml
 * 설명 : 결제처리일자변경팝업
 * 작성일 : 2009.09.11
 * 작성자 : 김동현
 */

#include "LIB::COMMON.js"; // 공통 관련

var ls_Gubun = "";

/* 공통 필수 시작 */
function Form_OnLoadCompleted(obj) {
    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리

    if (length(sLicenseNo) < 1 && length(sHistorySeq) < 1 && length(sSetlmtSeq) < 1) {
        Close(false);
    }
    
    calProcDate.Value = sProcDate;
    if (length(sPonyDate) > 1) {
        calPonyDate.Value = sPonyDate;
    } else {
        calPonyDate.Value = toNumber(sProcDate)-1;
    }
    if (sGubun == "10" || sGubun == "12" || sGubun == "11") {
        radSunapGubun.Value = "0";
        ls_Gubun = "0";
    } else {
        radSunapGubun.Value = "1";
        ls_Gubun = "1";
    }

}

function Form_OnUnloadCompleted(obj) {
    Close(false);
}

/*
 * 기능 : 종료
 */
function lfn_End(obj) {
    Close(false);
}
/* 공통 필수 종료 */

/* 사용자 이벤트 함수 */

function lfn_Save(obj) {

    if (!gfn_Confirm("처리일자를 변경 하시겠습니까?")) {
        return false;
    }

	ds_ioProc.ClearData();
	ds_ioProc.InsertRow(0);
    ds_ioProc.SetColumn(0, "LSLLCSNO", sLicenseNo);
    ds_ioProc.SetColumn(0, "LSLHSEQ", sHistorySeq);
    ds_ioProc.SetColumn(0, "LSSEQ", sSetlmtSeq);
    ds_ioProc.SetColumn(0, "LSPROCDATE", calProcDate.Value);
    ds_ioProc.SetColumn(0, "LSPONYGUBUN", chkPonyDate.Value);
    ds_ioProc.SetColumn(0, "LSPONYDATE", calPonyDate.Value);
    ds_ioProc.SetColumn(0, "LSGUBUN", radSunapGubun.Value);
    ds_ioProc.SetColumn(0, "LSPMYEAR", sPmYear);
    ds_ioProc.SetColumn(0, "LSPMMGNO", sPmMgno);
    
    if (radSunapGubun.Value == "0") { // 직납으로 변경한 경우
       ds_ioProc.SetColumn(0, "LSGUBUN", decode(sGubun, "14", "10", "16", "12", sGubun));
    } else { // 은납으로 변경한 경우
       ds_ioProc.SetColumn(0, "LSGUBUN", decode(sGubun, "12", "16", "10", "14", sGubun));
    }
    
    tit_clearActionInfo();
    tit_addSingleActionInfo("training:updateLicenseSettlement", "", 0, "");

    tit_callService(
        ""
        ,""
        ,"ds_iLicenseSettlement=ds_ioProc:U"	// inDs
        ,""	// outDs
        ,""	// args
        ,"lfn_AfterSaveLicense"
        ,false
        ,""
        ,true
    );

    gds_iModifyHistory.ClearData();
    gds_iModifyHistory.InsertRow(0);
    gds_iModifyHistory.SetColumn(0, "MHWORKGUBUN", "수첩처리일자변경"); // 업무구분
    gds_iModifyHistory.SetColumn(0, "MHGUBUN", "U"); // 변경구분
    gds_iModifyHistory.SetColumn(0, "MHKEY", sLicenseNo); // KEY값
    gds_iModifyHistory.SetColumn(0, "MHCOLUMN", "LSPROCDATE"); // 변경 컬럼명
    gds_iModifyHistory.SetColumn(0, "MHBEFOREDATA", sProcDate); // 변경 전 값
    gds_iModifyHistory.SetColumn(0, "MHAFTERDATA", calProcDate.Value); // 변경 후 값
    
    if (chkPonyDate.Value == "1") {
        gds_iModifyHistory.InsertRow(0);
        gds_iModifyHistory.SetColumn(0, "MHWORKGUBUN", "수첩처리일자변경"); // 업무구분
        gds_iModifyHistory.SetColumn(0, "MHGUBUN", "U"); // 변경구분
        gds_iModifyHistory.SetColumn(0, "MHKEY", sLicenseNo); // KEY값
        gds_iModifyHistory.SetColumn(0, "MHCOLUMN", "LSPONYGUBUN"); // 변경 컬럼명
        gds_iModifyHistory.SetColumn(0, "MHBEFOREDATA", "0"); // 변경 전 값
        gds_iModifyHistory.SetColumn(0, "MHAFTERDATA", "1"); // 변경 후 값
        gds_iModifyHistory.InsertRow(0);
        gds_iModifyHistory.SetColumn(0, "MHWORKGUBUN", "수첩처리일자변경"); // 업무구분
        gds_iModifyHistory.SetColumn(0, "MHGUBUN", "U"); // 변경구분
        gds_iModifyHistory.SetColumn(0, "MHKEY", sLicenseNo); // KEY값
        gds_iModifyHistory.SetColumn(0, "MHCOLUMN", "LSPONYDATE"); // 변경 컬럼명
        gds_iModifyHistory.SetColumn(0, "MHBEFOREDATA", sPonyDate); // 변경 전 값
        gds_iModifyHistory.SetColumn(0, "MHAFTERDATA", calPonyDate.Value); // 변경 후 값
    }
    
    if (ls_Gubun <> radSunapGubun.Value) {
        gds_iModifyHistory.InsertRow(0);
        gds_iModifyHistory.SetColumn(0, "MHWORKGUBUN", "수첩처리일자변경"); // 업무구분
        gds_iModifyHistory.SetColumn(0, "MHGUBUN", "U"); // 변경구분
        gds_iModifyHistory.SetColumn(0, "MHKEY", sLicenseNo); // KEY값
        gds_iModifyHistory.SetColumn(0, "MHCOLUMN", "LSGUBUN"); // 변경 컬럼명
        gds_iModifyHistory.SetColumn(0, "MHBEFOREDATA", ls_Gubun); // 변경 전 값
        gds_iModifyHistory.SetColumn(0, "MHAFTERDATA", radSunapGubun.Value); // 변경 후 값
    }
    
    gfn_InsertModifyHistory();

}

/*
 * 기능 : Transaction 서비스 호출 후 처리해야 할 내용
 * parameter : strSvcID - 서비스ID
 *             nErrorCode - 에러코드
 *             strErrorMsg - 에러메시지
 * Return : 없음
 */
function lfn_AfterSaveLicense(nErrorCode, strErrorMsg) {

    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }

    Close(true);
}

function chkPonyDate_OnClick(obj,strValue) {
	if (chkPonyDate.Value == "1") {
        calPonyDate.Enable = true;
	} else {
        calPonyDate.Enable = false;
	}
}

function calPonyDate_OnChanged(obj,strOldText,strNewText) {
	if (left(calPonyDate.Value) >= calProcDate.Value) {
        gfn_Alert("정산일자가 잘 못 되었습니다.");
        calPonyDate.Value = toNumber(sProcDate)-1;
	}
}
]]></Script>
</Window>