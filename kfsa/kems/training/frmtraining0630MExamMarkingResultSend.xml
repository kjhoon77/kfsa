<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="368" Id="frmtraining0630MExamMarkingResultSend" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="채점결과전송" Top="8" Ver="1.0" Width="656" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioExamResult">
				<Contents>
					<colinfo id="EREJMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="ERSEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="ERREPEATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="ERAPLEXAMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="ERPASSYN" size="255" summ="default" type="STRING"/>
					<colinfo id="ERPASSDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="ERSCORE" size="255" summ="default" type="STRING"/>
					<colinfo id="ERRANK" size="255" summ="default" type="STRING"/>
					<colinfo id="ERCORRECTCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="ERREGDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="ERREGSABUN" size="255" summ="default" type="STRING"/>
					<colinfo id="ERMODDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="ERMODSABUN" size="255" summ="default" type="STRING"/>
					<colinfo id="ERSCORE2" size="256" summ="default" type="STRING"/>
					<colinfo id="ERSCOREAVG" size="256" summ="default" type="STRING"/>
					<colinfo id="EJPASSYN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioAnswerAnalysis">
				<Contents>
					<colinfo id="AATCCOURSECD" size="255" summ="default" type="STRING"/>
					<colinfo id="AACAEPNUMTYPE" size="255" summ="default" type="STRING"/>
					<colinfo id="AACAEPALPHATYPE" size="255" summ="default" type="STRING"/>
					<colinfo id="AACAITEMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="AAREPEATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="AAEOMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="AACORRECTCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AAMARKINGCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AACORRECTPERCENT" size="255" summ="default" type="STRING"/>
					<colinfo id="AA1CNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AA2CNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AA3CNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AA4CNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AAEMPTYCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AADOUBLECNT" size="255" summ="default" type="STRING"/>
					<colinfo id="AAREGDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="AAREGSABUN" size="255" summ="default" type="STRING"/>
					<colinfo id="AAMODDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="AAMODSABUN" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioExamList" OnRowPosChanged="ds_ioExamList_OnRowPosChanged">
				<Contents>
					<colinfo id="EOMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="EOYEAR" size="255" summ="default" type="STRING"/>
					<colinfo id="EOEXAMORDER" size="255" summ="default" type="STRING"/>
					<colinfo id="EOEXAMDATE" size="255" summ="default" type="STRING"/>
					<colinfo id="TCCOURSECD" size="255" summ="default" type="STRING"/>
					<colinfo id="EOTCCOURSENM" size="255" summ="default" type="STRING"/>
					<colinfo id="JJIBUNICK" size="255" summ="default" type="STRING"/>
					<colinfo id="EXAMNM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oAnswerPaper">
				<Contents>
					<colinfo id="APSEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="APREPEATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="APEOMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="APAPLEXAMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="APTCCOURSECD" size="255" summ="default" type="STRING"/>
					<colinfo id="APNUMTYPE" size="255" summ="default" type="STRING"/>
					<colinfo id="APALPHATYPE" size="255" summ="default" type="STRING"/>
					<colinfo id="APCAITEMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="APANSWER" size="255" summ="default" type="STRING"/>
					<colinfo id="APANSWERYN" size="255" summ="default" type="STRING"/>
					<colinfo id="APITEMSCORE" size="255" summ="default" type="STRING"/>
					<colinfo id="APEXAMROOM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_iAnswerPaper">
				<Contents>
					<colinfo id="APSEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="APREPEATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="APEOMGNO" size="255" summ="default" type="STRING"/>
					<colinfo id="APAPLEXAMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="APTCCOURSECD" size="255" summ="default" type="STRING"/>
					<colinfo id="APNUMTYPE" size="255" summ="default" type="STRING"/>
					<colinfo id="APALPHATYPE" size="255" summ="default" type="STRING"/>
					<colinfo id="APCAITEMNO" size="255" summ="default" type="STRING"/>
					<colinfo id="APANSWER" size="255" summ="default" type="STRING"/>
					<colinfo id="APANSWERYN" size="255" summ="default" type="STRING"/>
					<colinfo id="APITEMSCORE" size="255" summ="default" type="STRING"/>
					<colinfo id="APEXAMROOM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oExamResultCnt"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioServerSendH">
				<Contents>
					<colinfo id="SEL" size="256" summ="default" type="STRING"/>
					<colinfo id="SSHEOMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SSHREPEATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SSHSENDYN" size="256" summ="default" type="STRING"/>
					<colinfo id="JUBSUCNT" size="256" summ="default" type="STRING"/>
					<colinfo id="EXAMCNT" size="256" summ="default" type="STRING"/>
					<colinfo id="MARKCNT" size="256" summ="default" type="STRING"/>
					<colinfo id="SENDCNT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioTrainingPassH">
				<Contents>
					<colinfo id="TPHTPTJMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHTRUTHCD" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHREGDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHREGSABUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHMODDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TPHMODSABUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioInsertOmrFile">
				<Contents>
					<colinfo id="AFEJMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="AFSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="AFPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="AFFILENM" size="256" summ="default" type="STRING"/>
					<colinfo id="AFREGDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="AFREGSABUN" size="256" summ="default" type="STRING"/>
					<colinfo id="EOYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="EOTCCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="EOEXAMORDER" size="256" summ="default" type="STRING"/>
					<colinfo id="AFTRANS" size="256" summ="default" type="STRING"/>
					<colinfo id="AFORDER" size="256" summ="default" type="STRING"/>
					<colinfo id="AFSUBJECTGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioSelectOmrFile">
				<Contents>
					<colinfo id="AFEJMGNO" size="256" summ="default" type="STRING"/>
					<colinfo id="EOYEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="EOTCCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="EOEXAMORDER" size="256" summ="default" type="STRING"/>
					<colinfo id="AFSUBJECTGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oAlphaTypeAvg"></Dataset>
		</Datasets>
		<Shape Bottom="228" Height="132" Id="Shape0" Left="4" LineColor="user15" Right="652" TabOrder="10" Top="96" Type="Rectangle" Width="648"></Shape>
		<Shape Bottom="92" Height="60" Id="Shape1" Left="4" LineColor="user15" Right="652" TabOrder="6" Top="32" Type="Rectangle" Width="648"></Shape>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="400" LineColor="user14" Right="652" TabOrder="61" Top="1" Type="Rectangle" Width="252"></Shape>
		<Div BKColor="user0" Height="28" Id="divWorkFormTitle" OnLoadCompleted="Form_OnLoadCompleted" Style="sty_Form" TabOrder="2" TabStop="FALSE" Text="Div0" Url="COM::frmCOM0100SWorkFormTitle.xml" Width="300">
			<Contents></Contents>
		</Div>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="564" OnClick="lfn_End" Style="sty_Button" TabOrder="1" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbExamNm" Left="8" Style="sty_Label" TabOrder="4" Text="시험명" Top="36" VAlign="Middle" Width="88"></Static>
		<Grid AutoFit="TRUE" BindDataset="ds_ioExamList" BkColor2="user2" BkSelColor="user3" BoldHead="FALSE" Border="Flat" Bottom="88" Enable="true" EndLineColor="default" FillAreaType="All" HeadBorder="None" HeadHeight="20" Height="52" Id="gdExam" InputPanel="FALSE" Left="100" LineColor="default" MinWidth="100" Right="648" RowHeight="20" Style="sty_Grid" TabOrder="5" TabStop="true" Top="36" UseDBuff="true" UsePopupMenu="true" UserData="응시자목록" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="548">
			<contents>
				<format id="Default">
					<columns>
						<col width="330"/>
						<col width="0"/>
						<col width="0"/>
					</columns>
					<body>
						<cell align="left" col="0" colid="EXAMNM" display="text"/>
						<cell align="center" col="1" colid="EOEXAMDATE" display="text" Mask="####-##-##"/>
						<cell align="center" col="2" colid="TCCOURSECD" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSave" ImageID="BTN_TEXT_11" Left="405" OnClick="lfn_Save" Style="sty_Button" TabOrder="7" Text="결과전송(데이터&amp;답안지)" ToolTipText="출력" Top="4" Width="157"></Button>
		<Static Align="Center" Height="36" Id="Static4" Left="8" Style="sty_Label" TabOrder="8" Text="결과데이터&#13;&#10;전송" Top="100" VAlign="Middle" Width="88"></Static>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_ioServerSendH" BkColor2="user2" BkSelColor="user3" BoldHead="true" Border="Flat" Bottom="224" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="All" Format="NOREPEATNO" HeadBorder="Flat" HeadHeight="20" Height="124" Id="gdServerSendH" InputPanel="FALSE" Left="100" LineColor="default" MinWidth="100" OnHeadClick="gdServerSendH_OnHeadClick" Right="648" RowHeight="20" Style="sty_Grid" TabOrder="9" TabStop="true" Top="100" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="548">
			<contents>
				<format id="REPEATNO">
					<columns>
						<col width="29"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
					</columns>
					<head>
						<cell align="center" col="0" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="평가차수"/>
						<cell align="center" col="2" display="text" text="전송여부"/>
						<cell align="center" col="3" display="text" text="접수인원"/>
						<cell align="center" col="4" display="text" text="응시인원"/>
						<cell align="center" col="5" display="text" text="채점인원"/>
						<cell align="center" col="6" display="text" text="전송인원"/>
					</head>
					<body>
						<cell align="center" col="0" colid="SEL" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" colid="SSHREPEATNO" display="text"/>
						<cell align="center" col="2" colid="SSHSENDYN" display="text"/>
						<cell align="center" col="3" colid="JUBSUCNT" display="number"/>
						<cell align="center" col="4" colid="EXAMCNT" display="number"/>
						<cell align="center" col="5" colid="MARKCNT" display="number"/>
						<cell align="center" col="6" colid="SENDCNT" display="number"/>
					</body>
				</format>
				<format id="NOREPEATNO">
					<columns>
						<col width="29"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
						<col width="67"/>
					</columns>
					<head>
						<cell align="center" col="0" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="text" text="전송여부"/>
						<cell align="center" col="2" display="text" text="접수인원"/>
						<cell align="center" col="3" display="text" text="응시인원"/>
						<cell align="center" col="4" display="text" text="채점인원"/>
						<cell align="center" col="5" display="text" text="전송인원"/>
					</head>
					<body>
						<cell align="center" col="0" colid="SEL" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" colid="SSHSENDYN" display="text"/>
						<cell align="center" col="2" colid="JUBSUCNT" display="number"/>
						<cell align="center" col="3" colid="EXAMCNT" display="number"/>
						<cell align="center" col="4" colid="MARKCNT" display="number"/>
						<cell align="center" col="5" colid="SENDCNT" display="number"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Shape Bottom="364" Height="132" Id="Shape2" Left="4" LineColor="user15" Right="652" TabOrder="11" Top="232" Type="Rectangle" Width="648"></Shape>
		<Static Align="Center" Height="20" Id="Static0" Left="8" Style="sty_Label" TabOrder="12" Text="답안지&#32;전송" Top="236" VAlign="Middle" Width="88"></Static>
		<Progressbar Height="22" Id="prog_bar" Left="100" Max="100" Origin="Horizontal" Step="10" TabOrder="13" Top="236" Width="548"></Progressbar>
		<Grid AutoFit="TRUE" BindDataset="ds_ioInsertOmrFile" BkColor2="default" BoldHead="true" Bottom="358" Enable="true" EndLineColor="default" Height="95" Id="gdServerSendOmr" InputPanel="FALSE" Left="99" LineColor="default" MinWidth="100" Right="646" TabOrder="14" TabStop="true" Top="263" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="547">
			<contents>
				<format id="Default">
					<columns>
						<col width="50"/>
						<col width="200"/>
						<col width="75"/>
					</columns>
					<head>
						<cell col="0" display="text" text="순번"/>
						<cell col="1" display="text" text="파일명"/>
						<cell col="2" display="text" text="상태"/>
					</head>
					<body>
						<cell align="center" col="0" display="text"/>
						<cell align="left" col="1" display="text"/>
						<cell align="center" col="2" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<File Bottom="28" Height="24" Id="filDeleteFile" Left="343" Right="367" TabOrder="15" Top="4" Width="24"></File>
		<HttpFile Height="24" Id="hfImageFile" Left="314" Top="4" Width="24"></HttpFile>
		<File Bottom="29" Height="24" Id="Filecontrol" Left="370" Right="394" TabOrder="14" Top="5" Width="24"></File>
	</Form>
	<Script><![CDATA[/*

 * 프로그램명 : frmtraining0630MExamMarkingResultSend.xml

 * 설명 : 채점결과전송

 * 작성일 : 2009.11.03

 * 작성자 : 김은규

 * 수정자 : 전윤호 (강습직능 영향도 및 SQL분석) 2022/09/29 

 */



#include "LIB::training.js"; // 공통업무 관련



/* 공통 필수 시작 */

function Form_OnLoadCompleted(obj) {

	if (gs_isBSB == "Y") {

        gfn_Alert("로컬환경에서는 채점결과전송이 불가능합니다.");

        close();

    }


    gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리



    // 폼 환경설정

    ls_SystemGubun = gs_SystemGubun;

    ls_SystemMenuId = gs_SystemMenuId;



    var ls_FormId = split(sFormUrl, "::");



    ls_FormId = split(ls_FormId[1], ".");

    obj.Title = sFormTitle + "(" + ls_FormId[0] + ")";

    gfn_MakeRequiredInputMark(this); // 필수 입력란을 설정한다.

    ms_FormAuth = gfn_GetFormAuth(this); // 권한을 조회한다.

    

    if (ms_FormAuth == "W") { // 권한에 따른 버튼 설정

        lfn_SetFormAuth(true); // 저장 권한

    } else if (ms_FormAuth == "R") {

        lfn_SetFormAuth(false); // 읽기 권한

    } else {

        gfn_Alert(MSGI00080);

        close();

    }

    ds_ioExamList.ClearData();
    
    lfn_Search();

}



function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {



    gfn_Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam); // 공통 키 이벤트 처리



}



function Form_OnSize(obj,nCx,nCy,nState) {

}



/*

 * 기능 : 조회

 */

function lfn_Search(obj) {



    ldb.Sync = true;

    ds_ioExamList.Load("SvcLdb::searchExamOrderList.xml");

    ldb.Sync = false;

}



/*

 * 기능 : 서버전송이력 조회

 */

function lfn_SearchServerSendH() {

	ds_ioServerSendH.ClearData();



    ldb.Sync = true;

    transaction("ServerSendH"

        ,"SvcLdb::searchServerSendH.xml"

        ,""

        ,"ds_ioServerSendH=output"

        ,"EOMGNO=" + quote(ds_ioExamList.GetColumn(ds_ioExamList.currow, "EOMGNO"))

        ,"lfn_AfterSearchServerSendH");

    ldb.Sync = false;

}



 /*

 * 기능 : gfn_Cryptograph 서비스 호출 후 처리해야 할 내용

 * parameter : strSvcID - 서비스ID

 *             nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 *	           cRtnVal - 리턴값(암호문)

 * Return : 성공:"OK", 실패:"FAIL"

 */

function lfn_AfterSearchServerSendH(strSvcID, nErrorCode, strErrorMsg) {

    if (strSvcID <> "ServerSendH") {

        return;

    }



    if (nErrorCode < 0) { // 트랜잭션 에러.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }

}



/*

 * 기능 : 삭제

 */

function lfn_Delete(obj) {

}



// 저장

function lfn_Save(obj) {

    var chkRow = 0;

    if (!gfn_FormValidate(this)) { // 입력 Validation Check

        return false;

    }
    

    for(var i=0; i<ds_ioServerSendH.GetRowCount(); i++) {

		if(ds_ioServerSendH.GetColumn(i, "SEL") == "1") chkRow++;

    }

    

    if(chkRow == 0) {

		gfn_Alert("전송할 평가차수를 선택하십시오.");

		return false;

    }



     if (!gfn_Confirm(ds_ioExamList.GetColumn(ds_ioExamList.currow, "EXAMNM") + "의 채점결과를 전송 하시겠습니까?\n\n"
         + "[채점결과 데이터 전송 후 답안지(스캔이미지) 파일이 전송됩니다.]")) {

         return false;

     }
     

	 lfn_SearchAnswerAnalysisLBD();	//로컬 자료 로딩 (1.문항분석)(2.시험결과)(3.답안지)

	
	/*
	ext_GetFileList함수는 ext_GetFileList(strFolder, strOpt) 로 쓰시며, strFolder내의 파일 리스트를 리턴합니다.
	strOpt는 "F"(default), "D"로 먼저 "F"일 때에는 파일명.확장자의 구조로 파일 리스트를 리턴하며, “D”일 때에는 파일명의 구조로 파일리스트를 리턴합니다.
	*/
	// Image 폴더에 파일이 있는지 체크
	var DirRtn = ext_GetFileList("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지","F");
	
	if(DirRtn.length > 0) {
		ds_ioInsertOmrFile.ClearData();
		var row = "";
		
		var i = 0;
		var j = 0;

		// 답안이미지파일 서버전송
		var upFile = ext_GetFileList("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지","F");
		
		while(indexOf(upFile, upFile[i]) > 0) {
			tit_clearActionInfo();
			
			var sp_upFile = split(upFile[i], "_", "webstyle");
			
			//alert(sp_upFile);
			//alert(sp_upFile.length);
			
			//답안지 2장 또는 3장인경우 전송
			if(2 == sp_upFile.length || 3 == sp_upFile.length) {
				row = ds_ioInsertOmrFile.AddRow();
				
				// 시험접수 관리번호
				ds_ioInsertOmrFile.SetColumn(row, "AFEJMGNO", sp_upFile[0]);
				// 순번
				ds_ioInsertOmrFile.SetColumn(row, "AFORDER", row+1);
				// 파일명
				ds_ioInsertOmrFile.SetColumn(row, "AFFILENM", upFile[i]);
				
				ds_ioInsertOmrFile.SetColumn(row, "AFSUBJECTGUBUN", substr(sp_upFile[2],0,1));
			} /*else if(2 < sp_upFile.length) {
				var aResult = tit_FileWrite(
					hfImageFile
					, "/IMGDATA/ANSWERPAPER/BACKUP/" + sp_upFile[1] + "/"
					, "C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지"
					, upFile[i]
					, sp_upFile[1] + "_" + sp_upFile[3] + "_" + sp_upFile[4] + "_" + sp_upFile[5]
					, "U"
					, false
				);

				trace(aResult);
				
				if("S" == aResult[0]) {
					// 전송이미지파일 삭제
					filDeleteFile.Delete("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지\\"+upFile[i]);
				}
			}*/
			
			tit_addSearchActionInfo("training:searchAnswerOmrFile", false);
			
			// 서버 호출

			tit_callService(

	                 ""

	               , ""  

	               , ""   

	               , "ds_ioSelectOmrFile=ds_oSOmrFile" //outDs

	               , "AFEJMGNO=" + sp_upFile[0] // args

	               , ""  //callBack

	               , false

	               , false

	               , true

			);
			
			// 저장 경로
			ds_ioInsertOmrFile.SetColumn(row, "AFPATH", "/IMGDATA/ANSWERPAPER/"+ds_ioSelectOmrFile.GetColumn(0, "EOYEAR")+"/"+ds_ioSelectOmrFile.GetColumn(0, "EOTCCOURSECD")+"/"+ds_ioSelectOmrFile.GetColumn(0, "EOEXAMORDER")+"/");
			i++;
		}
		
		//tit_clearActionInfo();
		
		tit_addSaveActionInfo(

			"training:insertAnswerOmrFile"	// insert
	
			, ""	// update
	
			, ""	// delete
	
			, ""	// flag column 명
	
			, ""	// key sql id
	
			, 0	// key 증가 값
	
			, "" 
	
			, 0 
	
			, "N"	// 실행타입
	
		);
		
		//trace(ds_ioInsertOmrFile.SaveXML());
		// 서버 호출 

		tit_callService(	
			""	
			
			,""	
			
			,"ds_iOmrFile=ds_ioInsertOmrFile:U"	// inDs
			
			//,"ds_iOmrFile=ds_ioInsertOmrFile"	// inDs	
			
			,""	// outDs	
			
			,""	// args 	
			
			,"lfn_AfterInsertOmrFile"	
			
			,false			
			
			,false			
			
			,false
			
		);
		
	}
	
}



function lfn_AfterInsertOmrFile(nErrorCode, strErrorMsg) {
	if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;
    }

	// 백업 디렉토리 생성// 이미지 다른 위치에 백업(2019.07.31)
  	Filecontrol.MakeDir("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\backup\\"+left(getDate(),6));
	//Filecontrol.Move("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지\\1232934_20190615000733.jpg", "C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\backup\\"+left(getDate(),6)+"\\1232934_20190615000733.jpg");

    
    // 파일 Count만큼 loop
    for(i=0;i<ds_ioInsertOmrFile.rowcount;i++) {
        /*     
        * @return  서버에 저장된 파일 정보 Array
              0 - 성공 : S / 실패 : E / 파일크기 초과 : O
              1 - 서버에 저장된 실제 경로
              2 - 서버에 저장된 실제 파일명
              3 - 서버에 저장된 파일 사이즈
       */    
		var aResult = tit_FileWrite(
            hfImageFile
            , ds_ioInsertOmrFile.GetColumn(i, "AFPATH")
            , "C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지"
            , ds_ioInsertOmrFile.GetColumn(i, "AFFILENM")
            , ds_ioInsertOmrFile.GetColumn(i, "AFFILENM")
            , "U"
            , false
        );
        //trace(ds_ioInsertOmrFile.GetColumn(i, "AFPATH")+ds_ioInsertOmrFile.GetColumn(i, "AFFILENM"));
		//trace(aResult);
		
		if("S" == aResult[0]) {		
			// 그리드 진행률 표시
			gdServerSendOmr.SetCellProp("Body", 0, "colid", "AFORDER");
			gdServerSendOmr.SetCellProp("Body", 1, "colid", "AFFILENM");
			gdServerSendOmr.SetCellProp("Body", 2, "text", "전송완료");
			
			// 전송이미지파일 삭제(2019.07.31 삭제안함)
			//filDeleteFile.Delete("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지\\"+aResult[2] ;
			// 이미지 백업(2019.07.31)
			Filecontrol.Move("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\정상용지\\"+aResult[2], "C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\backup\\"+left(getDate(),6)+"\\"+aResult[2]);
			
			// 답안지 전송진행상황 표기
			prog_bar.Pos = round(i / ds_ioInsertOmrFile.rowcount * 100);
			
		} else if("E" == aResult[0]) {
			gfn_Alert("전송에 실패하였습니다. " + aResult[2] + " 파일을 확인해 주세요.");
			return;
		} else if(0 == aResult[0]) {
			gfn_Alert("파일 사이즈를 초과하였습니다. " + aResult[2] + " 파일을 확인해 주세요.");
			return;
		}
        
        hfImageFile.CloseFile();
        
        if(i == ds_ioInsertOmrFile.rowcount-1) {
			gfn_Alert("답안지 파일전송이 완료되었습니다.");
		}
	}
	
	// 3개월 전 백업디렉토리(파일포함) 삭제
    var sYear = left(getDate(),4);
    var sMonth = substr(getDate(),4,2);
    if (sMonth >= "01" && sMonth <= "03") {
		sYear = toNumber(sYear)-1;
		//alert(syear);
		sMonth = lpad(toNumber(sMonth)-3,"0",2);
		
    } else {
    	sMonth = lpad(toNumber(sMonth)-3,"0",2);
    }
    var sYearMonth = toString(sYear) + toString(sMonth);

	filDeleteFile.RemoveDir("C:\\KFSA\\kems\\training\\local\\kems\\localsvc\\Image\\backup\\"+sYearMonth, true);
}



/*

 * 기능 : 로컬 자료 로딩 (1.문항분석)

 */

function lfn_SearchAnswerAnalysisLBD(obj) {

	ds_ioAnswerAnalysis.ClearData();

	

	ldb.Sync = true;        

    transaction("AnswerAnalysis"

        ,"SvcLdb::searchAnswerAnalysis.xml"

        ,""

        ,"ds_ioAnswerAnalysis=output"

        , "EOMGNO=" + quote(ds_ioExamList.GetColumn(ds_ioExamList.currow, "EOMGNO"))

          +" ARYREPEATNO=" + quote(lfn_getRepeatnoArray())

        ,"lfn_AfterAnswerAnalysisLBD");

	ldb.Sync = false;

}



 /*

 * 기능 : lfn_SearchAnswerAnalysisLBD 서비스 호출 후 처리해야 할 내용

 * parameter : nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterAnswerAnalysisLBD(nErrorCode, strErrorMsg) {

    if (nErrorCode < 0) { // 트랜잭션 에러.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }

	lfn_SearchExamResultLDB();	//서버 전송 이력 관리

}



/*

 * 기능 : 로컬 자료 로딩 (2.시험결과)

 */

function lfn_SearchExamResultLDB(obj) {

	ds_ioExamResult.ClearData();

	

	ldb.Sync = true;

    transaction("ExamResult"

        ,"SvcLdb::searchExamResult.xml"

        ,""

        ,"ds_ioExamResult=output"

        , "EOEXAMORDER=" + quote(ds_ioExamList.GetColumn(ds_ioExamList.currow, "EOEXAMORDER"))

          +" ARYREPEATNO=" + quote(lfn_getRepeatnoArray())

        ,"lfn_AfterExamResultLBD");

	ldb.Sync = false;

}



 /*

 * 기능 : lfn_SearchExamResultLDB 서비스 호출 후 처리해야 할 내용

 * parameter : nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterExamResultLBD(nErrorCode, strErrorMsg) {

    if (nErrorCode < 0) { // 트랜잭션 에러.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }
    

	// 특급소관이면 "EJPASSYN" 합격여부("Y")를 1차합격("1")으로 수정한다.
	if (ds_ioExamList.GetColumn(0, "TCCOURSECD") == "10") {
	
		for(var i=0; i<ds_ioExamResult.GetRowCount(); i++) {
		
			if(ds_ioExamResult.GetColumn(i, "ERPASSYN") == "Y") {
			
				ds_ioExamResult.SetColumn(i, "EJPASSYN", "1");	// EXAMRESULT, EXAMJUBSU  최종결과 UPDATE용
			
			}
		
		}
		
	}

	lfn_SearchAnswerPaperResultLDB();	//서버 전송 이력 관리

}



/*

 * 기능 : 로컬 자료 로딩 (3.답안지)

 */

function lfn_SearchAnswerPaperResultLDB(obj) {

	ds_iAnswerPaper.ClearData();

	

	ldb.Sync = true;

    transaction("AnswerPaperResult"

        ,"SvcLdb::searchAnswerPaperResult.xml"

        ,""

        ,"ds_iAnswerPaper=output"

        , "EOMGNO=" + quote(ds_ioExamList.GetColumn(ds_ioExamList.currow, "EOMGNO"))

          +" ARYREPEATNO=" + quote(lfn_getRepeatnoArray())

        ,"lfn_AfterAnswerPaperResultLBD");

	ldb.Sync = false;

}



 /*

 * 기능 : lfn_SearchAnswerPaperResultLDB 서비스 호출 후 처리해야 할 내용

 * parameter : nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterAnswerPaperResultLBD(nErrorCode, strErrorMsg) {

    if (nErrorCode < 0) { // 트랜잭션 에러.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }

	lfn_SendExamResult();	//서버 전송 이력 관리

}



/*

 * 기능 : 서버 전송 (1.시험결과:INSERT)

 *                    (2.문항분석:INSERT OR UPDATE)

 *                    (3.답안지:INSERT)

 *                    (4.시험[평가]접수:UPDATE)

 */

function lfn_SendExamResult(obj) {

	tit_clearActionInfo();

	// 접수자가 1명인 경우

	if (ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") <> "10") {	// 특급소관이 아니면
	
		if (ds_ioServerSendH.GetColumn(ds_ioServerSendH.currow , "JUBSUCNT") == "1") {
		
			if (ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "21" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "22" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "23" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "24" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "29") {	// 1,2,3급소관,위관,통합자이면
			    
				tit_addSingleActionInfo("training:insertSendBangExamResult", "", 0, "");
				
			} else if (ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "51") {	// 심폐소생술과정이면
				
				tit_addSingleActionInfo("training:insertSendCPRExamResult", "", 0, "");
				
			} else {
				
				tit_addSingleActionInfo("training:insertSendExamResult", "", 0, "");
				
			}
			
			tit_addSingleActionInfo("training:insertSendAnswerAnalysis", "", 0, "");
			
			tit_addSingleActionInfo("training:insertSendAnswerPaper", "", 0, "");
			
			tit_addSingleActionInfo("training:updateSendExamJubsu", "", 0, "");
		
		// 접수자가 1명보다 큰 경우
			
		} else if (ds_ioServerSendH.GetColumn(ds_ioServerSendH.currow , "JUBSUCNT") > "1") {
			
			
			if (ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "21" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "22" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "23" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "24" ||
			    ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "29") {	// 1,2,3급소관,위관,통합자이면
			
				tit_addMultiActionInfo("training:insertSendBangExamResult", "", 0, "", "N");
			
			} else if (ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "51") {	// 심폐소생술과정이면
			
				tit_addMultiActionInfo("training:insertSendCPRExamResult", "", 0, "", "N");
	
			} else {
			
				tit_addMultiActionInfo("training:insertSendExamResult", "", 0, "", "N");
			
			}
			
			tit_addMultiActionInfo("training:insertSendAnswerAnalysis", "", 0, "", "N");
			
			tit_addMultiActionInfo("training:insertSendAnswerPaper", "", 0, "", "N");
			
			tit_addMultiActionInfo("training:updateSendExamJubsu", "", 0, "", "N");

		}

	} else {	 // 특급소관이면
	
		// 접수자가 1명인 경우	
		if (ds_ioServerSendH.GetColumn(ds_ioServerSendH.currow , "JUBSUCNT") == "1") {
	
			tit_addSingleActionInfo("training:insertSendSpecialExamResult", "", 0, "");
		
			tit_addSingleActionInfo("training:insertSendAnswerAnalysis", "", 0, "");
		
			tit_addSingleActionInfo("training:insertSendAnswerPaper", "", 0, "");
		
			tit_addSingleActionInfo("training:updateSendSpecialExamJubsu", "", 0, "");
	
		// 접수자가 1명보다 큰 경우
		} else if (ds_ioServerSendH.GetColumn(ds_ioServerSendH.currow , "JUBSUCNT") > "1") {
		
			tit_addMultiActionInfo("training:insertSendSpecialExamResult", "", 0, "", "N");
		
			tit_addMultiActionInfo("training:insertSendAnswerAnalysis", "", 0, "", "N");
		
			tit_addMultiActionInfo("training:insertSendAnswerPaper", "", 0, "", "N");
		
			tit_addMultiActionInfo("training:updateSendSpecialExamJubsu", "", 0, "", "N");
		}
		
	}


	// 서버 호출 

	tit_callService(

		""

		,""

		,"ds_ioExamResult=ds_ioExamResult ds_ioAnswerAnalysis=ds_ioAnswerAnalysis ds_iAnswerPaper=ds_iAnswerPaper ds_ioExamResult=ds_ioExamResult"	// inDs

		,""	// outDs

		,""	// args

		,"lfn_AfterSaveSendExamResult"

		,false

	);

}



 /*

 * 기능 : lfn_SendExamResult 서비스 호출 후 처리해야 할 내용

 * parameter : strSvcID - 서비스ID

 *             nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterSaveSendExamResult(ErrorCode, ErrorMsg) {

    if (ErrorCode < 0) { // 트랜잭션 에러.

        gfn_ErrorMsg(ErrorCode, ErrorMsg);

        return;

    }

	lfn_updateServerSendH();	//서버 전송 이력 관리

}



/*

 * 기능 : 서버 전송 이력 관리

 */

function lfn_updateServerSendH(obj) {



	ldb.Sync = true;

		transaction("ServerSendH"

			,"SvcLdb::updateServerSendH.xml"

			,"input=ds_ioServerSendH"

			,""

			,""

			,"lfn_AfterSaveServerSendH");

	ldb.Sync = false;

}



 /*

 * 기능 : lfn_updateServerSendH 서비스 호출 후 처리해야 할 내용

 * parameter : nErrorCode - 에러코드

 *             strErrorMsg - 에러메시지

 * Return : 없음

 */

function lfn_AfterSaveServerSendH(nErrorCode, strErrorMsg) {

    if (nErrorCode < 0) { // 트랜잭션 에러.

        gfn_ErrorMsg(nErrorCode, strErrorMsg);

        return;

    }

    //gfn_SaveMessage(); // 저장 메세지를 처리한다.
    
    
    for(var i=0; i<ds_ioExamList.GetRowCount(); i++) {
    
		// ABCD유형별 평균이 전체평균과 +-20% 이상의 편차를 보일 경우 경고메시지 알림  // 2020.06.02
		ds_oAlphaTypeAvg.ClearData();
	
		tit_clearActionInfo();
	
		tit_addSearchActionInfo("training:searchExam0630AlphaTypeAvg", false);
		
		// 서버 호출
	
		tit_callService(
	
				 ""
	
			   , ""  
	
			   , ""   
	
			   , "ds_oAlphaTypeAvg=ds_oAlphaTypeAvg" //outDs
	
			   , "EOMGNO=" + quote(ds_ioExamList.GetColumn(i, "EOMGNO")) // args
	
			   , ""  //callBack
	
			   , false
	
			   , false
	
			   , true
	
		);
		
		var lsOverChk = "";
		var lsAOverChk = "";
		var lsBOverChk = "";
		var lsCOverChk = "";
		var lsDOverChk = "";
		var lsTitle = "";
		var lsMsg = "";
		if (ds_oAlphaTypeAvg.GetColumn(0, "AOVERCHK") == "AOK" &&
			ds_oAlphaTypeAvg.GetColumn(0, "BOVERCHK") == "BOK" &&
			ds_oAlphaTypeAvg.GetColumn(0, "COVERCHK") == "COK" &&
			ds_oAlphaTypeAvg.GetColumn(0, "DOVERCHK") == "DOK") {
			lsOverChk = "OK";
			lsTitle="채점결과(데이터) 전송이 정상적으로 처리되었습니다.";
			lsMsg = "  [ " + ds_ioExamList.GetColumn(i, "EXAMNM") + " ]\n" +
					"                          <유형별 평균점수>\n"+
					" ○ 전체(ABCD) 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "TOTAVG") + "점\n" +
					"   - A형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "AAVG") + "점\n" +
					"   - B형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "BAVG") + "점\n" +
					"   - C형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "CAVG") + "점\n" +
					"   - D형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "DAVG") + "점\n\n";
			
					
		} else {
			lsOverChk = "OVER";
			lsAOverChk = ds_oAlphaTypeAvg.GetColumn(0, "AOVERCHK");
			lsBOverChk = ds_oAlphaTypeAvg.GetColumn(0, "BOVERCHK");
			lsCOverChk = ds_oAlphaTypeAvg.GetColumn(0, "COVERCHK");
			lsDOverChk = ds_oAlphaTypeAvg.GetColumn(0, "DOVERCHK");
			var lsAOver = "";
			var lsBOver = "";
			var lsCOver = "";
			var lsDOver = "";
			if (lsAOverChk == "AOVER") { lsAOver = "[이상발생(전체평균과 편차 20% 이상)]"; }
			if (lsBOverChk == "BOVER") { lsBOver = "[이상발생(전체평균과 편차 20% 이상)]"; }
			if (lsCOverChk == "COVER") { lsCOver = "[이상발생(전체평균과 편차 20% 이상)]"; }
			if (lsDOverChk == "DOVER") { lsDOver = "[이상발생(전체평균과 편차 20% 이상)]"; }
			
			lsTitle="채점결과(데이터)를 다시 한번 확인해 주시기 바랍니다.";
			lsMsg = "  [ " + ds_ioExamList.GetColumn(i, "EXAMNM") + " ]\n" +
			        "                            <유형별 평균점수>\n\n"+
					" ○ 전체(ABCD) 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "TOTAVG") + "점\n" +
					"   - A형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "AAVG") + "점  " + lsAOver + "\n" +
					"   - B형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "BAVG") + "점  " + lsBOver + "\n" +
					"   - C형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "CAVG") + "점  " + lsCOver + "\n" +
					"   - D형 평균 : " + ds_oAlphaTypeAvg.GetColumn(0, "DAVG") + "점  " + lsDOver + "\n\n"+
					"                           <확인 및 조치사항>\n\n"+
					" ① [문제지] 사용시험지 종별 유형(ABCD) 일치여부 확인\n"+
					" ② [KEMS] 시험장관리 및 종별 선택 일치여부 확인\n"+
					" ③ [재채점] ①+② 확인 후 재채점 실시\n"+
					" ※ 재알림 시 평가관리과 연락(02-2671-8688)";
		
		}
		
		var sArg = "sOverChk="+quote(lsOverChk) + " sTitle="+ quote(lsTitle) + " sMsg=" + quote(lsMsg);
		
//		return Dialog("training::frmtraining0630PResultMessage.xml", sArg, 400, 200, "titlebar=true", -1, -1);
		Dialog("training::frmtraining0630PResultMessage.xml", sArg, 400, 200, "titlebar=true", -1, -1);


	}	// for

    ds_ioExamList_OnRowPosChanged(ds_ioExamList,ds_ioExamList.currow,ds_ioExamList.currow);

}



/* 공통 필수 종료 */



/* 사용자 함수 */



/*

 * 기능 : 버튼 활성/비활성시킨다.

 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)

 * return : 없음

 */

function lfn_getRepeatnoArray() {

	var tmpAry = "";

	

	for(var i=0; i<ds_ioServerSendH.GetRowCount(); i++) {

		if(ds_ioServerSendH.GetColumn(i, "SEL") == 1) {

			tmpAry += "'"+ds_ioServerSendH.GetColumn(i, "SSHREPEATNO")+"',";

		}

	}
	
	return left(tmpAry, length(tmpAry)-1);

}

 

/*
 * 기능 : 버튼 활성/비활성시킨다.
 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)
 * return : 없음
 */

function lfn_SetFormAuth(bStatus) {

    btnSave.Enable = bStatus; // 엑셀 로딩 저장 버튼

}



/* 사용자 이벤트 함수 */



function ds_ioExamList_OnRowPosChanged(obj,nOldRow,nRow) {

    
	if( ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "10"
	
		|| ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "21" 

		|| ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "22"
		
		|| ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "23"
		 
		|| ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "50"
		 
		|| ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "51"
		 
		|| ds_ioExamList.GetColumn(ds_ioExamList.currow, "TCCOURSECD") == "53") {

		gdServerSendH.Format = "NOREPEATNO";

	} else {

		gdServerSendH.Format = "REPEATNO";

	}

	

    lfn_SearchServerSendH(nRow);

    gdServerSendH.SetCellProp("head", 0, "text", 0);	//헤드 체크 해제

}



function gdServerSendH_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)

{

	var lobj_Dataset = object(obj.BindDataset);

	if (nCell == 0) { // 선택

        if (obj.GetCellProp("head", nCell, "text") == 1) { // 전체가 이미 선택된 경우

            obj.SetCellProp("head", nCell, "text", 0);

            for(i = 0; i < lobj_Dataset.RowCount(); i++) {

                lobj_Dataset.SetColumn(i, "SEL", "0");

            }

        } else { // 전체가 이미 선택되지 않은 경우

            obj.SetCellProp("head", nCell, "text", 1);

            for(i = 0; i < lobj_Dataset.RowCount(); i++) {

                lobj_Dataset.SetColumn(i, "SEL", "1");

            }

        }

	} else { // 헤드 정렬

        lfn_SortGrid_OnHeadClick(obj,nCell,nX,nY,nPivotIndex);

	}

}


function Form_OnActivate(obj)
{
	gs_SysID = "[stm_01,bsn_4000,dsc_0019]";	// 개인정보접속기록 시스템ID 
}
]]></Script>
</Window>