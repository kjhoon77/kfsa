<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form BKColor="user0" Height="590" Id="frmcust2080MDailyFeeReportGateway" Left="8" OnActivate="Form_OnActivate" OnDeactivate="Form_OnDeactivate" OnFocus="Form_OnFocus" OnKeyDown="Form_OnKeyDown" OnKillFocus="Form_OnKillFocus" OnLoadCompleted="Form_OnLoadCompleted" OnSize="Form_OnSize" OnUnloadCompleted="Form_OnUnloadCompleted" PidAttrib="7" Style="sty_Form" Title="일별&#32;회비/교육비&#32;수납현황(전자결재연동)" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ioGubun">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD>3</CD>
						<DATA>전체</DATA>
					</record>
					<record>
						<CD>0</CD>
						<DATA>수납</DATA>
					</record>
					<record>
						<CD>1</CD>
						<DATA>환불</DATA>
					</record>
					<record>
						<CD>2</CD>
						<DATA>폐기</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioSunap">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
					<record>
						<CD></CD>
						<DATA>전체</DATA>
					</record>
					<record>
						<CD>1019</CD>
						<DATA>현금&amp;전화수납</DATA>
					</record>
					<record>
						<CD>10</CD>
						<DATA>현금</DATA>
					</record>
					<record>
						<CD>19</CD>
						<DATA>전화수납</DATA>
					</record>
					<record>
						<CD>14</CD>
						<DATA>은행납</DATA>
					</record>
					<record>
						<CD>17</CD>
						<DATA>지로</DATA>
					</record>
					<record>
						<CD>11</CD>
						<DATA>카드</DATA>
					</record>
					<record>
						<CD>12</CD>
						<DATA>현금영수증</DATA>
					</record>
					<record>
						<CD>13</CD>
						<DATA>가상계좌</DATA>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioJibu">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DATA" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ioElecApprConnection">
				<Contents>
					<colinfo id="GYMGNO" size="22" summ="sum" type="DECIMAL"/>
					<colinfo id="NEW_RECEIVE_DATE" size="14" summ="default" type="STRING"/>
					<colinfo id="PROCDATE" size="19" summ="default" type="STRING"/>
					<colinfo id="RE_ALI_DOC_ID" size="16" summ="default" type="STRING"/>
					<colinfo id="RE_APPROVER_DATE" size="7" summ="default" type="DATE"/>
					<colinfo id="RE_APPROVER_KIND" size="50" summ="default" type="STRING"/>
					<colinfo id="RE_APPROVER_NAME" size="30" summ="default" type="STRING"/>
					<colinfo id="RE_APPROVER_STATUS" size="50" summ="default" type="STRING"/>
					<colinfo id="RE_PC_DEPARTMENT" size="100" summ="default" type="STRING"/>
					<colinfo id="RE_PC_POSITION" size="100" summ="default" type="STRING"/>
					<colinfo id="RECEIVE_DATE" size="14" summ="default" type="STRING"/>
					<colinfo id="ROWNUM" size="22" summ="default" type="DECIMAL"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oMemberfee1">
				<Contents>
					<colinfo id="CNM" size="256" summ="default" type="STRING"/>
					<colinfo id="CFMEMBERGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="CCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB1_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB1_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL2_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL2_AMT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oMemberfee2"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oMemberfee3"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oMemberfee4"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oMemberfee1_2">
				<Contents>
					<colinfo id="CNM" size="256" summ="default" type="STRING"/>
					<colinfo id="CFMEMBERGUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="CCOURSECD" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB1_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="SUNAB1_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL2_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="HWANBUL2_AMT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape Bottom="176" Height="136" Id="Shape2" Left="388" LineColor="user15" Right="796" TabOrder="19" Top="40" Type="Rectangle" Width="408"></Shape>
		<Shape Bottom="176" Height="136" Id="Shape0" Left="4" LineColor="user15" Right="384" TabOrder="6" Top="40" Type="Rectangle" Width="380"></Shape>
		<Shape Bottom="29" Height="28" Id="shpBtnBox" Left="444" LineColor="user14" Right="796" TabOrder="5" Top="1" Type="Rectangle" Width="352"></Shape>
		<Div BKColor="user0" Height="28" Id="divWorkFormTitle" OnLoadCompleted="Form_OnLoadCompleted" Style="sty_Form" TabOrder="4" TabStop="FALSE" Text="Div0" Url="COM::frmCOM0100SWorkFormTitle.xml" Width="384">
			<Contents></Contents>
		</Div>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnToExcel" ImageID="BTN_COM_EXCEL" Left="534" OnClick="lfn_localExcel" Style="sty_Button" TabOrder="1" ToolTipText="엑셀로&#32;저장" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrintScreen" ImageID="BTN_COM_SCREEN" Left="621" OnClick="lfn_PrintScreen" Style="sty_Button" TabOrder="2" ToolTipText="화면&#32;출력" Top="4" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnEnd" ImageID="BTN_COM_END" Left="708" OnClick="lfn_End" Style="sty_Button" TabOrder="3" ToolTipText="닫기" Top="4" Width="85"></Button>
		<Static Align="Center" Height="20" Id="lbJubsu" Left="20" Style="sty_LabelGruopBox" TabOrder="7" Text="조회&#32;정보" Top="32" VAlign="Middle" Width="96"></Static>
		<Shape Bottom="584" Height="396" Id="Shape1" Left="4" LineColor="user15" Right="796" TabOrder="8" Top="188" Type="Rectangle" Width="792"></Shape>
		<Grid AutoFit="TRUE" BindDataset="ds_ioElecApprConnection" BkColor2="default" BoldHead="true" Bottom="580" Enable="true" EndLineColor="default" Height="364" Id="gdElecAppr" InputPanel="FALSE" Left="8" LineColor="default" MinWidth="100" OnCellDBLClick="gdElecAppr_OnCellDblClick" Right="792" TabOrder="9" TabStop="true" Top="216" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="784">
			<contents>
				<format id="Default">
					<columns>
						<col width="41"/>
						<col width="223"/>
						<col width="113"/>
						<col width="71"/>
						<col width="82"/>
						<col width="80"/>
						<col width="67"/>
						<col width="80"/>
					</columns>
					<head>
						<cell col="0" display="text" text="순번"/>
						<cell col="1" combodataset="ds_ioAccount" display="text" text="수납기간"/>
						<cell col="2" display="text" text="처리부서"/>
						<cell col="3" display="text" text="직위"/>
						<cell col="4" display="text" text="결재자"/>
						<cell col="5" display="text" text="결재일자"/>
						<cell col="6" display="text" text="결재유형"/>
						<cell col="7" display="text" text="결재상태"/>
					</head>
					<body>
						<cell align="center" col="0" colid="ROWNUM" display="text"/>
						<cell align="center" col="1" colid="PROCDATE" display="text"/>
						<cell align="center" col="2" colid="RE_PC_DEPARTMENT" display="text"/>
						<cell align="center" col="3" colid="RE_PC_POSITION" display="text"/>
						<cell align="center" col="4" colid="RE_APPROVER_NAME" display="text"/>
						<cell align="center" col="5" colid="RE_APPROVER_DATE" display="text"/>
						<cell align="center" col="6" colid="RE_APPROVER_KIND" display="text"/>
						<cell align="center" col="7" colid="RE_APPROVER_STATUS" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Radio Border="Flat" CodeColumn="CD" ColumnCount="4" DataColumn="DATA" Height="20" Id="radOrder" INDEX="0" InnerDataset="ds_ioGubun" Left="72" LeftMargin="4" OnChanged="radOrder_OnChanged" OnKeyDown="gfn_EnterNextFocus" RightMargin="4" Style="sty_Radio" TabOrder="10" Top="77" UserData="S" Width="308"></Radio>
		<Static Align="Center" Height="20" Id="Static3" Left="8" Style="sty_Label" TabOrder="11" Text="처리구분" Top="77" VAlign="Middle" Width="60"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnCancel" ImageID="BTN_COM_INIT" Left="447" OnClick="lfn_Cancel" Style="sty_Button" TabOrder="12" ToolTipText="입력&#32;초기화" Top="4" Width="85"></Button>
		<Radio Border="Flat" CodeColumn="CD" ColumnCount="3" DataColumn="DATA" Height="50" Id="radGubun" INDEX="0" InnerDataset="ds_ioSunap" Left="72" LeftMargin="4" OnKeyDown="gfn_EnterNextFocus" RightMargin="4" Style="sty_Radio" TabOrder="13" Top="100" UserData="S" Width="308"></Radio>
		<Static Align="Center" Height="20" Id="Static0" Left="8" Style="sty_Label" TabOrder="14" Text="수납구분" Top="101" VAlign="Middle" Width="60"></Static>
		<Static Align="Center" Height="20" Id="Static1" Left="8" Style="sty_Label" TabOrder="15" Text="수납일자" Top="152" VAlign="Middle" Width="60"></Static>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" HeaderFont="돋음,10,Bold" Height="20" Id="calStartDate" Left="72" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="17" Top="152" UserData="S:수납일자" WeeksFont="돋음,9" Width="100"></Calendar>
		<Static Align="Center" Height="20" Id="Static12" Left="172" Style="sty_Text" TabOrder="16" Text="~" Top="152" VAlign="Middle" Width="20"></Static>
		<Calendar Border="Flat" Dateformat="yyyy-MM-dd" DayFont="돋음,9" DaySelect="Auto" EditAlign="CENTER" HeaderFont="돋음,10,Bold" Height="20" Id="calEndDate" Left="192" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" SaturdayTextColor="blue" SelectedDayFont="돋음,9,Bold" Style="sty_Calendar" SundayTextColor="red" TabOrder="18" Top="152" UserData="S:수납일자" WeeksFont="돋음,9" Width="100"></Calendar>
		<Static Align="Center" Height="20" Id="Static2" Left="404" Style="sty_LabelGruopBox" TabOrder="20" Text="전자결제연동" Top="32" VAlign="Middle" Width="96"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnPrint" ImageID="BTN_COM_PRINT" Left="296" OnClick="btnCreateListTotaling_OnClick" Style="sty_Button" TabOrder="21" ToolTipText="출력" Top="151" Width="85"></Button>
		<Static Align="Center" Height="20" Id="Static4" Left="20" Style="sty_LabelGruopBox" TabOrder="22" Text="조회&#32;정보" Top="180" VAlign="Middle" Width="96"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="btnSelect" ImageID="BTN_TEXT_07" Left="688" OnClick="btnSelect_OnClick" Style="sty_Button" TabOrder="23" Text="진행현황&#32;재조회" ToolTipText="선택" Top="192" Transparent="TRUE" Width="106"></Button>
		<Static Height="40" Id="lbTextBlue" Left="392" Style="sty_TextBlue" TabOrder="24" Text="&#32;전자결재&#32;연동&#32;시&#32;첨부파일(해당일자의&#32;수납내역&#32;리스트[PDF파일])" Top="56" VAlign="Middle" Width="400"></Static>
		<Button BKColor="user17" ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Font="굴림,10,Bold" Height="20" Id="btnCreateList" Left="408" OnClick="btnCreateList_OnClick" Style="sty_Button" TabOrder="25" Text="수납내역&#32;리스트&#32;생성(전자결재&#32;첨부용)" Top="128" Width="384"></Button>
		<Button BKColor="user17" ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Font="굴림,10,Bold" Height="20" Id="btnProcElecApv" Left="408" OnClick="btnProcElecApv_OnClick" Style="sty_Button" TabOrder="26" Text="전자결재&#32;연동&#32;처리(기안)" Top="152" Width="384"></Button>
		<Static Align="Center" Height="20" Id="lbText" Left="388" Style="sty_Text" TabOrder="27" Text="1)" Top="128" VAlign="Middle" Width="20"></Static>
		<Static Align="Center" Height="20" Id="Static5" Left="388" Style="sty_Text" TabOrder="28" Text="2)" Top="152" VAlign="Middle" Width="20"></Static>
		<Static Align="Center" Height="20" Id="lbJibu" Left="8" Style="sty_Label" TabOrder="30" Text="지부" Top="54" VAlign="Middle" Width="60"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="DATA" Height="20" Id="cbxJibu" INDEX="0" InnerDataset="ds_ioJibu" Left="71" OnFocus="gfn_ComponentOnFocus" OnKeyDown="gfn_EnterNextFocus" OnKillFocus="gfn_ComponentOnKillFocus" ResetIndex="FIRST" Search="NOTFILTERED" Style="sty_Combo" TabOrder="29" Top="53" UserData="I:지부" Width="104"></Combo>
		<Static Height="24" Id="Static6" Left="396" Style="sty_TextBlue" TabOrder="31" Text="&#10;을&#32;미리&#32;생성해&#32;놓으신&#32;후&#32;전자결재&#32;연동처리(기안)&#32;시에&#32;리스트를" Top="76" VAlign="Middle" Width="400"></Static>
		<Static Height="28" Id="Static7" Left="396" Style="sty_TextBlue" TabOrder="32" Text="첨부하시기&#32;바랍니다." Top="100" VAlign="Middle" Width="400"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="22" Id="Button0" ImageID="BTN_COM_PRINT" Left="-80" OnClick="btnCreateListTotaling_part1_OnClick" Style="sty_Button" TabOrder="33" ToolTipText="출력" Top="192" Width="85"></Button>
		<Static Height="17" Id="lbSMS" Left="394" TabOrder="34" Text="※&#32;더블클릭&#32;시&#32;결재문서를&#32;보실&#32;수&#32;있습니다." Top="199" Width="270"></Static>
	</Form>
	<Script><![CDATA[/*
 * 프로그램명 : frmcust2080MDailyFeeReportGateway.xml
 * 설명 : 일별 회비/교육비 수납현황(전자결제연동)
 * 작성일 : 2009.12.09
 * 작성자 : 이창희
 */

#include "LIB::cust.js"; // 공통업무 관련

function Form_OnLoadCompleted(obj)
{
	gfn_Form_OnLoadCompleted(obj); // 공통 폼 로딩 이벤트 처리
	
    // 폼 환경설정
    ls_SystemGubun = gs_SystemGubun;
    ls_SystemMenuId = gs_SystemMenuId;
    var ls_FormId = split(sFormUrl, "::");
    ls_FormId = split(ls_FormId[1], ".");
    obj.Title = sFormTitle + "(" + ls_FormId[0] + ")";

    gfn_MakeRequiredInputMark(this); // 필수 입력란을 설정한다.

    ms_FormAuth = gfn_GetFormAuth(this); // 권한을 조회한다.
    if (ms_FormAuth == "W") { // 권한에 따른 버튼 설정
        lfn_SetFormAuth(true); // 저장 권한
    } else if (ms_FormAuth == "R") {
        lfn_SetFormAuth(false); // 읽기 권한
    } else {
        gfn_Alert(MSGI00080);
        close();
    }

	//gfn_SearchAllJibu(cbxJibu, "Y", "선택"); // 지부 코드 조회
    gfn_SearchJibu(cbxJibu, "Y", "선택"); // 지부 코드 조회    
    
    calStartDate.Value = left(GetDate(), 8);
    calEndDate.Value = left(GetDate(), 8);    
}

//공통처리
//===================================================================
/*
 * 기능 : 버튼 활성/비활성시킨다.
 * parameter : bStatus - 활성/비활성여부(true:활성, false:비활성)
 * return : 없음
 */
function lfn_SetFormAuth(bStatus) {
    btnSelect.Enable = bStatus;    
    btnCreateList.Enable = bStatus;
    btnProcElecApv.Enable = bStatus;
}

/* 사용자 이벤트 함수 */
function btnMutilSort_OnClick(obj)
{
	gfn_GridMultiSort(gdElecAppr, 0); // 멀티 정렬을 실행한다.
}

function Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
    // to do
    gfn_Form_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam); // 공통 키 이벤트 처리
}

function Form_OnSize(obj,nCx,nCy,nState)
{
    if (gs_IsResizingForm == "Y") {
        gdElecAppr.Height = nCy - gdElecAppr.Top - 4;
        gdElecAppr.Width = nCx - gdElecAppr.Left - 4;
    }
}
//====================================================================

//조회

function btnSelect_OnClick(obj)
{
    if (!gfn_FormValidate(this)) { // 입력 Validation Check
        return false;
    }

    ds_ioElecApprConnection.ClearData(); // 데이타셋 초기화
	
    tit_clearActionInfo();
	tit_addSearchActionInfo("cust:searchCust2080ElecApprConnection", false);
	// 서버 호출 
	
	tit_callService(
		""
		,""
		,""	// inDs
		,"ds_ioElecApprConnection=ds_oElecApprConnection"	// outDs
		,"JIBU=" + quote(SubStr (cbxJibu.value , 1, 2 ))    // args 
            + " rpStartDate=" + quote(calStartDate.Text)
            + " rpEndDate=" + quote(calEndDate.Text)
		,"lfn_AfterSearchElecAppr"
		,false
	);	
}

function lfn_AfterSearchElecAppr(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    gfn_SearchMessage(gdElecAppr); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
};





//수납내역 리스트 레포트용 1.전체현황, 2.회비현황, 3.교육비현황, 4.상세현황  날짜 집계 포함
function btnCreateListTotaling_OnClick(obj)
{	
	
	if (!gfn_FormValidate(this)) { // 입력 Validation Check
        return false;
    }
    
	lfn_Serch_AllCost();       // 전체
	lfn_Serch_MembershipFee(); // 회비
	lfn_Serch_EducationCost(); // 교육비
   
    //레포트 호출 
 //                ,"ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee3"
 
     gfn_CallReportPopup("frmcust2080R01ElectronicApprovalDetail.rex"
                ,"ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee3"
                      , "JIBU=" + quote(cbxJibu.Text)                
                + "^STARTDATE=" + quote(calStartDate.Value)
                + "^ENDDATE=" + quote(calEndDate.Value)
                + "^ORDER_GUBUN=" + quote(radOrder.Text)                               
                + "^sParam_TitleFull=" + quote("일별 회비_교육비 수납현황(전자결재연동)_종합")                                      
                ,""
                ,true);

      

}

//수납내역 리스트 레포트용 1.전체현황, 2.회비현황, 3.교육비현황, 4.상세현황 날짜 집계 미포함
function btnCreateList_OnClick(obj)
{	
	if (!gfn_FormValidate(this)) { // 입력 Validation Check
        return false;
    }
	//lfn_Serch_AllCost();       // 전체
	lfn_Serch_MembershipFee(); // 회비
	lfn_Serch_EducationCost(); // 교육비
   
    //레포트 호출 
 //                ,"ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee3"
 
     gfn_CallReportPopup("frmcust2080R02ElectronicApprovalDetail.rex"
                ,"ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee3"
                      , "JIBU=" + quote(cbxJibu.Text)            
            + "^STARTDATE=" + quote(calStartDate.Value)
            + "^ENDDATE=" + quote(calEndDate.Value)
            + "^sParam_TitleFull= " + quote("일별 회비_교육비 수납현황(전자결재연동)")            
            ,""
            ,true);// 서브레포트 사용 여부 Null/NotNull
}

/*
 *  회비 교육비 전체 쿼리 
*/
function lfn_Serch_AllCost()
{
    ds_oMemberfee1.ClearData(); // 데이터셋 초기화            	 
    tit_clearActionInfo();
    tit_AddCSVSearchActionInfo("cust:searchCust2080Memberfee1", false); //회비/교육비 날짜전체집계(날짜 시작일 ~날짜 종료일)      
 
    tit_callService(
        ""
        ,""
        ,""// inDs
		,"ds_oMemberfee1=ds_oMemberfee1"  // outDs
        ,"JIBU=" + quote(cbxJibu.value)
            + " rpStartDate=" + quote(calStartDate.Value) // 날짜 시작
            + " rpEndDate=" + quote(calEndDate.Value)	  // 날짜 끝 
            + " ORDER_GUBUN=" + quote(radOrder.Value)      //처리구분
            + " SUNAB_GUBUN=" + quote(radGubun.Value)      //수납구분 (결제방법) args
        ,"lfn_AfterSearchElecAppr_aa"
        ,false
        ,""
        ,true        
    );
}

/*
 *  회비 교육비 전체 쿼리 (종합 제외 회비/교육비만 전자결재연동 위함)
*/
function lfn_Serch_AllCost_2()
{
    ds_oMemberfee1.ClearData(); // 데이터셋 초기화            	 
    tit_clearActionInfo();
    tit_AddCSVSearchActionInfo("cust:searchCust2080Memberfee1_2", false); //회비/교육비 날짜전체집계(날짜 시작일 ~날짜 종료일)      
 
    tit_callService(
        ""
        ,""
        ,""// inDs
		,"ds_oMemberfee1_2=ds_oMemberfee1_2"  // outDs
        ,"JIBU=" + quote(cbxJibu.value)
            + " rpStartDate=" + quote(calStartDate.Value) // 날짜 시작
            + " rpEndDate=" + quote(calEndDate.Value)	  // 날짜 끝 
            + " ORDER_GUBUN=" + quote(radOrder.Value)      //처리구분
            + " SUNAB_GUBUN=" + quote(radGubun.Value)      //수납구분 (결제방법) args
        ,"lfn_AfterSearchElecAppr_aa"
        ,false
        ,""
        ,true        
    );
}

/*
 *  회비 교육비 쿼리 
*/
function lfn_Serch_MembershipFee()
{
    ds_oMemberfee2.ClearData(); // 데이터셋 초기화        	 
    tit_clearActionInfo();
    tit_AddCSVSearchActionInfo("cust:searchCust2080Memberfee2", false); //회비/교육비 날짜전체집계(날짜별 집계)     
 
        tit_callService(
        ""
        ,""
        ,""// inDs
		,"ds_oMemberfee2=ds_oMemberfee2"  // outDs
        ,"JIBU=" + quote(cbxJibu.value)
            + " rpStartDate=" + quote(calStartDate.Value) // 날짜 시작
            + " rpEndDate=" + quote(calEndDate.Value)	  // 날짜 끝 
            + " ORDER_GUBUN=" + quote(radOrder.Value)      //처리구분
            + " SUNAB_GUBUN=" + quote(radGubun.Value)      //수납구분 (결제방법) args
        ,"lfn_AfterSearchElecAppr_aa"
        ,false
        ,""
        ,true
        
    );
}

/*
 *  회비 교육비 상세 쿼리 
*/
function lfn_Serch_EducationCost()
{
    ds_oMemberfee3.ClearData(); // 데이터셋 초기화        	 
    tit_clearActionInfo();
    tit_AddCSVSearchActionInfo("cust:searchCust2080Memberfee3", false);        

    tit_callService(
        ""
        ,""
        ,""// inDs
		,"ds_oMemberfee3=ds_oMemberfee3"  // outDs
        ,"JIBU=" + quote(cbxJibu.value)
            + " rpStartDate=" + quote(calStartDate.Value) // 날짜 시작
            + " rpEndDate=" + quote(calEndDate.Value)	  // 날짜 끝 
            + " ORDER_GUBUN=" + quote(radOrder.Value)      //처리구분
            + " SUNAB_GUBUN=" + quote(radGubun.Value)      //수납구분 (결제방법) args
        ,"lfn_AfterSearchElecAppr_aa"
        ,false
        ,""
        ,true
        
    );
}
function lfn_AfterSearchElecAppr_aa(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
   // gfn_SearchMessage(gdElecAppr); // 조회 메세지를 처리하고 그리드의 정렬 헤드 마크를 제거한다.
};


//======================================================================================================
/*--------------------------------------------------------*
 *  엑셀  버튼 선택 시                                    *
 *--------------------------------------------------------*/
function lfn_localExcel(obj)
{  
    if (ds_ioElecApprConnection.GetRowCount() < 1) {
        gfn_Alert("출력할 데이터가 존재하지 않습니다.");
        return false;
    }
	lfn_Excel(obj);
}

//엑셀인쇄 끝-----------------------------------------------------------------------------------
//======================================================================================================


function radOrder_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(radOrder.Value=='0') {
        
	}
}

/*
 * 전자결재 연동을 위한 조회 후 추가 그리고 웹페이지 이동
*/
function btnProcElecApv_OnClick(obj)
{
   if (!gfn_FormValidate(this)) { // 입력 Validation Check
       return false;
   }
   
   btnProcElecApv.Enable = false;
   if(!Confirm("전자결재 연동 처리를 하시겠습니까?")){  //
        return false;
        btnProcElecApv.Enable = true;
    }
    
    lfn_Serch_AllCost_2();            // 회비 교육비 전체 쿼리 결제 연동 insert 위한 정보조회
     
    if (ds_oMemberfee1_2.count == 0) {
        alert("조회 결과가 없습니다.");
        btnProcElecApv.Enable = true;
        return false;
    }

	var vMemCnt = 0;
	var vBiMemCnt = 0;
    // 조회 데이터를 바꿈 (insert 되게 함) 
    for(i = 0; i < ds_oMemberfee1_2.RowCount(); i++) {
        if (ds_oMemberfee1_2.GetColumn(i, "SEL") == 0) {           
           ds_oMemberfee1_2.SetColumn(i, "SEL", "1"); 
                  
        } 
        
        if (ds_oMemberfee1_2.GetColumn(i, "CFMEMBERGUBUN") = "회비") {
			vMemCnt = vMemCnt + 1;
        } else if (ds_oMemberfee1_2.GetColumn(i, "CFMEMBERGUBUN") = "교육비")  {
			vBiMemCnt = vBiMemCnt + 1;
        }
    }
    
    var vinsertrow = 0;
    if (vMemCnt == 0) {
		vinsertrow = ds_oMemberfee1_2.RowCount();
		ds_oMemberfee1_2.InsertRow(vinsertrow);
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CNM", " ");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CFMEMBERGUBUN", "회비");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CFMEMBERGUBUN_CD", "1");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CCOURSECD", "");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB_AMT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB1_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB1_AMT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL_AMT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL2_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL2_AMT", "0");
    }
    
    if (vBiMemCnt == 0) {
		vinsertrow = ds_oMemberfee1_2.RowCount();
		ds_oMemberfee1_2.InsertRow(vinsertrow);
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CNM", " ");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CFMEMBERGUBUN", "교육비");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CFMEMBERGUBUN_CD", "2");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"CCOURSECD", "");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB_AMT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB1_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"SUNAB1_AMT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL_AMT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL2_CNT", "0");
		ds_oMemberfee1_2.SetColumn(vinsertrow,"HWANBUL2_AMT", "0");
    
    }
    
	// 연동 시스템에 자료 넣기	
	tit_clearActionInfo();
	tit_AddSingleActionInfo("cust:deleteCust2080ElecApprMISFEES", "", 0, "");	// 기존 가비지 데이터 삭제 EKPDEV.MISFEES
    tit_AddMultiActionInfo(	
        "cust:insertCust2080Memberfee1"	// insert  		
        , ""	// update  
        , ""	// delete
        , ""	// flag column 명
        , ""	// key sql id
        , 0	// key 증가 값
        , "" 
        , 0 
        , "N"	// 실행타입
    );
    // 서버 호출 
    tit_callService(
        ""
        ,""
        ,"ds_iInsertMemberfee1=ds_oMemberfee1_2:U"/// inDs		
        ,""	// outDs
        , "JIBU_A=" + quote(cbxJibu.value)
          + " JUBUNM_A=" + quote(cbxJibu.text) // 지부명
          + " rpStartDate=" + quote(calStartDate.Value) // 날짜 시작
          + " rpEndDate=" + quote(calEndDate.Value)	  // 날짜 끝 
          + " ORDER_GUBUN=" + quote(radOrder.Value)      //처리구분
          + " SUNAB_GUBUN=" + quote(radGubun.Value)      //수납구분 (결제방법) args            
        ,"lfn_AfterSaveElecAppr"
        ,false
    );  
}

/*
 * 웹페이지 호출
*/
function lfn_AfterSaveElecAppr(nErrorCode, strErrorMsg) {
    if (nErrorCode != 0) { // 트랜잭션 에러를 처리한다.
        gfn_ErrorMsg(nErrorCode, strErrorMsg);
        return;
    }
    
    btnProcElecApv.Enable = true;
    
   // gfn_SaveMessage(); // 저장 메세지를 처리한다.
   // lfn_Search(); // 조회
    
    var vGubun = "";   // 웹페이지 연동시 구분값(매개변수)  
    //////////    
    // 2자리[10:전체,2?:수납,30:폐기,40:환불])						 
    //  : (2?:수납[?는 0:전체,1:은납(#),2:직납(*),3:지로(G),4:카드(I),5:현금영수증(T)],6:가상계좌,30:폐기,40:환불)

    if(radOrder.Value == '0') {  // 수납
         
        if(radGubun.Value == '10') {  // 현금직납
           vGubun = "22";
        } else if(radGubun.Value == '14') {  // 현금은납
           vGubun = "21";
        } else if(radGubun.Value == '17') {  // 지로
           vGubun = "23";
       } else if(radGubun.Value == '11') {  // 카드
           vGubun = "24";
        } else if(radGubun.Value == '12') {  // 현금영수증
           vGubun = "25";
        } else if(radGubun.Value == '13') {  // 가상계좌
           vGubun = '26';
        } else {    // 전체
           vGubun = "20";
     //      
        }
         } else if(radOrder.Value == '1') {  // 환불
       vGubun = "40";
    } else if(radOrder.Value == '2') {  // 폐기
       vGubun = "30";
    } else if(radOrder.Value == '3') {  // 전체
       vGubun = "10";
    }

    //////////
    btnProcElecApv.Enable = true;
    ExecBrowser("http://172.19.1.1/ekp/mis_index.jsp?uid=" + gds_oUserInfo.GetColumn(0, "PPERSONNM") + 
                                           "&employeeNumber=" + gds_oUserInfo.GetColumn(0, "PSABUN") +
                                           "&GYMGNO=" + mid(calStartDate.Value, 0,8) + mid(calEndDate.Value, 0,8) + 
                                           mid(gds_oUserInfo.GetColumn(0, "PDEPTCD"), 1, 2) + vGubun + "&MTSTYPE=1");

}










/*
* 상세내역 빼고 레포트 출력 
*/
function btnCreateListTotaling_part1_OnClick(obj)
{
	if (!gfn_FormValidate(this)) { // 입력 Validation Check
        return false;
    }
    
	lfn_Serch_AllCost();       // 전체
	lfn_Serch_MembershipFee(); // 회비
	//lfn_Serch_EducationCost(); // 교육비
   
    //레포트 호출 
 //                ,"ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee3"
 
     gfn_CallReportPopup("frmcust2080R01ElectronicApprovalDetail.rex"
                ,"ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee1||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee2||ds_oMemberfee3"
                      , "JIBU=" + quote(cbxJibu.Text)                
                + "^STARTDATE=" + quote(calStartDate.Value)
                + "^ENDDATE=" + quote(calEndDate.Value)
                + "^ORDER_GUBUN=" + quote(radOrder.Text)                               
                + "^sParam_TitleFull=" + quote("일별 회비_교육비 수납현황(전자결재연동)_종합")                                      
                ,""
                ,true);

      
}

// 결재문서 보기
function gdElecAppr_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
		if(!gfn_isNull(ds_ioElecApprConnection.GetColumn(nRow, "RE_ALI_DOC_ID"))) {
	
			// 위촉결재문서 보기
			ExecBrowser("http://172.19.1.1/ekp/mis_index.jsp?uid=" + gds_oUserInfo.GetColumn(0, "PPERSONNM") + 		
												   "&employeeNumber=" + gds_oUserInfo.GetColumn(0, "PSABUN") +		
												   "&GYMGNO=" + ds_ioElecApprConnection.GetColumn(nRow, "RE_ALI_DOC_ID") + "&MTSTYPE=10");
												   		}


}
]]></Script>
</Window>